<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>2024年12月29日-qt学习</title>
    <link href="/2024/12/29/2024%E5%B9%B412%E6%9C%8829%E6%97%A5-qt%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/12/29/2024%E5%B9%B412%E6%9C%8829%E6%97%A5-qt%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>使用qtcreator写了一个简单的qt程序。记录一下。</p><h2 id="程序整体的结构"><a href="#程序整体的结构" class="headerlink" title="程序整体的结构"></a>程序整体的结构</h2><p>在我的程序中，一个窗口，对应一个类，对应一个命名空间，继承QWidget或者QMainWindow类。类中有信号（signals）和槽（slots），按照我的理解：槽是实际执行任务的方法，信号是能跨窗口触发槽的方法。</p><p>我的程序主要有mainWindow和starPromptWindow两个窗口，在mainwindow类中实例化了一个m_starPromptWindow，用于触发信号从而使用槽。</p><h3 id="信号和槽"><a href="#信号和槽" class="headerlink" title="信号和槽"></a>信号和槽</h3><p>例如，如果我要点击starPromptWindow的一个按钮，要改变mainWindow的一个控件内容，那我应该在starPromptWindow中定义一个信号，还要有一个触发信号的方法，在mainWindow中应该有一个目标方法来改变控件内容。我应当在mainWindow中连接这个信号和目标方法，因为我在mainWindow中实例化了一个starPromptWindow对象m_starPromptWindow。</p><p>总之就是：</p><ul><li>starPromptWindow：<ul><li>按钮</li><li>信号</li><li>发出信号的方法<ul><li>与按钮连接</li></ul></li></ul></li><li>mainWindow：<ul><li>实例化一个starPromptWindow</li><li>连接信号与目标方法</li><li>目标方法（槽）<ul><li>操作mainWindow中的控件</li></ul></li></ul></li></ul><p>如果我反过来，要点击mainWindow中的按钮，控制starPromptWindow中的控件，那我同样应该使用信号。但是不能像这样直接调换地位：</p><ul><li>starPromptWindow：<ul><li>实例化一个mainWindow</li><li>连接信号与目标方法</li><li>目标方法（槽）<ul><li>操作starPromptWindow中的控件</li></ul></li></ul></li><li>mainWindow：<ul><li>按钮</li><li>信号</li><li>发出信号的方法<ul><li>与按钮连接</li></ul></li></ul></li></ul><p>这是错误的（大概）。按理来说应该这么做：</p><ul><li>starPromptWindow：<ul><li>信号</li><li>发出信号的方法<ul><li>与mainWindow中的按钮连接</li><li>连接在mainWindow中设置</li></ul></li><li>一个private槽<ul><li>用于控制starPromptWindow中的控件</li></ul></li></ul></li><li>mainWindow：<ul><li>实例化一个starPromptWindow</li><li>按钮</li><li>连接按钮与starPromptWindow的信号</li></ul></li></ul><p>不过事实上也可以不通过信号，直接使用starPromptWindow中的public槽：</p><ul><li>starPromptWindow：<ul><li>一个public槽<ul><li>用于控制starPromptWindow中的控件</li></ul></li></ul></li><li>mainWindow：<ul><li>实例化一个starPromptWindow</li><li>连接到starPromptWindow的public槽</li></ul></li></ul><p>总而言之，通过信号和槽，就能间接地通过一个窗口的方法和另一个窗口的控件交互了。</p><h2 id="窗口头文件"><a href="#窗口头文件" class="headerlink" title="窗口头文件"></a>窗口头文件</h2><p>以mainWindow为例：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MAINWINDOW_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAINWINDOW_H</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;starPromptWindow.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QMainWindow&gt;</span></span><br><br>namespace Ui &#123;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span>;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span> :</span> public QMainWindow<br>&#123;<br>    Q_OBJECT<br><br>signals:<br><span class="hljs-comment">// ......</span><br><br>public slots:<br><span class="hljs-comment">// ......</span><br><br>private slots:<br><span class="hljs-comment">// ......</span><br><br>public:<br><span class="hljs-comment">// ......</span><br><br>private:<br>    Ui::MainWindow *ui;<br>    starPromptWindow *m_starPromptWindow;  <span class="hljs-comment">// StarPromptWindow 的实例</span><br><span class="hljs-comment">// ......</span><br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><br>按照qt（或者说是qtcreator）标准写法写的类定义，声明成员。</p><h2 id="cpp程序"><a href="#cpp程序" class="headerlink" title="cpp程序"></a>cpp程序</h2><p>以mainWindow为例：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mainwindow.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;ui_mainwindow.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;starPromptWindow.h&quot;</span></span><br><br>MainWindow::<span class="hljs-built_in">MainWindow</span>(QWidget *parent):<br><span class="hljs-built_in">QMainWindow</span>(parent), <br><span class="hljs-built_in">ui</span>(<span class="hljs-keyword">new</span> Ui::MainWindow), <br><span class="hljs-built_in">m_starPromptWindow</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">starPromptWindow</span>(<span class="hljs-keyword">this</span>))<br>&#123;<br>    ui-&gt;<span class="hljs-built_in">setupUi</span>(<span class="hljs-keyword">this</span>);<br><span class="hljs-comment">// ......</span><br>&#125;<br><br>MainWindow::~<span class="hljs-built_in">MainWindow</span>()<br>&#123;<br>    <span class="hljs-keyword">delete</span> ui;<br>    <span class="hljs-keyword">delete</span> m_starPromptWindow;<br>&#125;<br></code></pre></td></tr></table></figure><br>实现功能的部分。</p><p>其中，~MainWindow()函数是退出窗口时执行的动作，这个方法在类定义的时候声明了。</p><p>不过事实上，要更改窗口关闭时的行为，我是重写了closeEvent。例如，我不希望starPromptWindow退出的时候彻底退出，我希望只是隐藏，同时保存prompt，于是我重写了closeEvent：<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">void starPromptWindow::<span class="hljs-built_in">closeEvent</span>(QCloseEvent *event) &#123;<br>    this-&gt;<span class="hljs-built_in">hide</span>();<br>    <span class="hljs-built_in">saveStarPrompt</span>();<br>    event-&gt;<span class="hljs-built_in">ignore</span>();  <span class="hljs-comment">// 忽略关闭事件，防止窗口被销毁</span><br>&#125;<br></code></pre></td></tr></table></figure><br>对应的，要在头文件类定义中说明你重写了这个方法：<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">closeEvent</span>(<span class="hljs-params">QCloseEvent *<span class="hljs-keyword">event</span></span>) <span class="hljs-keyword">override</span></span>;<br></code></pre></td></tr></table></figure></p><h2 id="主要功能："><a href="#主要功能：" class="headerlink" title="主要功能："></a>主要功能：</h2><h3 id="绘图："><a href="#绘图：" class="headerlink" title="绘图："></a>绘图：</h3><p>通过发送请求完成。请求的内容存储在ApiData.json中。</p><ol><li>图片预览</li></ol><p>通过生成并打开一个QDialog类型的、继承了mainWindow的imageDialog实现。在其中插入一个QLabel类型的imageLabel变量，通过setPixmap(QPixmap::fromImage(scaledImage))设置内容，然后layout-&gt;addWidget(imageLabel)将其插入QVBoxLayout型的layout，最后通过imageDialog-&gt;setLayout(layout)设置layout。</p><ul><li>值得注意的是，QDialog有一个性质名为模态，model，需要通过imageDialog-&gt;setModal(false)设置为flase，否则只能聚焦在最后一个打开的QDialog上。</li><li>值得注意的是，如果不执行imageDialog-&gt;setAttribute(Qt::WA_DeleteOnClose)，imageDialog占用的内存不会释放，导致占用节节高。</li></ul><ol><li>图片和参数保存</li></ol><p>图片有现成的类型QImage，QImage有现成的方法save()；文件有QFile，可以通过文本流QTextStream写入：</p><p>（QFile变量名为jsonFile）<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">if (jsonFile.open(QIODevice::WriteOnly)) &#123;<br>QTextStream <span class="hljs-built_in">out</span>(&amp;jsonFile);<br>out &lt;&lt; <span class="hljs-built_in">QJsonDocument</span>(jsonObj)<span class="hljs-selector-class">.toJson</span>();<br>jsonFile<span class="hljs-selector-class">.close</span>();<br>&#125;<br></code></pre></td></tr></table></figure></p><ol><li>“上一次输入的prompt”将被自动记录，并在下一次启动时填写</li></ol><p>同上读写json文件。</p><p>没有使用数据库是因为不方便直接编辑。</p><ol><li>收藏prompt，查看与管理收藏的prompt</li></ol><p>使用了starPromptWindow窗口完成。读写文件同上。和主窗口的交互详见信号量部分。</p><h2 id="次要功能"><a href="#次要功能" class="headerlink" title="次要功能:"></a>次要功能:</h2><ol><li>网络错误时会弹出提示框</li></ol><p>使用了我自己写的专门的类ErrorDialog（继承了QDialog）。qt有专门的错误提示框QErrorMessage，用起来很方便，不过我不太喜欢ui布局所以自己写了。</p><ol><li>clear按钮可以快速清屏右边的日志</li></ol><p>直接将按钮连接到ui-&gt;outputTextEdit-&gt;clear函数</p><ol><li>alt + s 是绘制的快捷键</li></ol><p>先创建快捷方式，然后连接。就像这样<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">QShortcut *shortcutDraw = new QShortcut(<span class="hljs-name">QKeySequence</span>(<span class="hljs-name">Qt</span>:<span class="hljs-symbol">:ALT</span> | Qt:<span class="hljs-symbol">:Key_S</span>), this)<span class="hljs-comment">;</span><br>connect(<span class="hljs-name">shortcutDraw</span>, <span class="hljs-symbol">&amp;QShortcut</span>:<span class="hljs-symbol">:activated</span>, ui-&gt;sendRequestButton, <span class="hljs-symbol">&amp;QPushButton</span>:<span class="hljs-symbol">:click</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></p><ol><li>ctrl + s 是保存tag的快捷键（如果不手动保存的话，画完一张图后也会自动保存）</li></ol><p>同理<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">QShortcut *shortcutSaveHistory = new QShortcut(<span class="hljs-name">QKeySequence</span>(<span class="hljs-name">Qt</span>:<span class="hljs-symbol">:CTRL</span> | Qt:<span class="hljs-symbol">:Key_S</span>), this)<span class="hljs-comment">;</span><br>connect(<span class="hljs-name">ui-&gt;ClearButton</span>, <span class="hljs-symbol">&amp;QPushButton</span>:<span class="hljs-symbol">:clicked</span>, this, <span class="hljs-symbol">&amp;MainWindow</span>:<span class="hljs-symbol">:onClearButtonClicked</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></p><ol><li>响应式布局</li></ol><p>最麻烦的一集</p><p>使用qtcreator的可视化编辑器折腾了好半天，继承QWidget的情况下，怎么都会挤成一坨。后来改成了继承MainWindow类才好。</p><p>starPromptWindow的初始化函数如下：<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">void starPromptWindow::init<span class="hljs-constructor">StarPrompts()</span>&#123;<br>    this-&gt;set<span class="hljs-constructor">WindowTitle(<span class="hljs-string">&quot;Star Prompts&quot;</span>)</span>;<br>    this-&gt;resize(<span class="hljs-number">600</span>, <span class="hljs-number">600</span>);<br>    QJsonObject json = read<span class="hljs-constructor">StarPrompts()</span>;<br>    tabWidget = <span class="hljs-keyword">new</span> <span class="hljs-constructor">QTabWidget(<span class="hljs-params">this</span>)</span>;<br>    QVBoxLayout *mainLayout = <span class="hljs-keyword">new</span> <span class="hljs-constructor">QVBoxLayout(<span class="hljs-params">this</span>)</span>;<br>    mainLayout-&gt;add<span class="hljs-constructor">Widget(<span class="hljs-params">tabWidget</span>)</span>;<br><br>    <span class="hljs-comment">// 遍历 JSON 对象，为每个键创建 Tab 页面</span><br>    <span class="hljs-keyword">for</span> (QString key : json.keys<span class="hljs-literal">()</span>) &#123;<br>        QJsonObject item = json<span class="hljs-literal">[<span class="hljs-identifier">key</span>]</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">Object()</span>;<br>        add<span class="hljs-constructor">TabForStarPrompts(<span class="hljs-params">item</span>[<span class="hljs-string">&quot;prompt&quot;</span>].<span class="hljs-params">toString</span>()</span>, item<span class="hljs-literal">[&quot;<span class="hljs-identifier">negativePrompt</span>&quot;]</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>, key, tabWidget);<br>    &#125;<br><br>    <span class="hljs-comment">// 会挤成一团</span><br>    <span class="hljs-comment">// setLayout(mainLayout);</span><br>    <span class="hljs-comment">// 会挤成一团</span><br>    <span class="hljs-comment">// this-&gt;setLayout(mainLayout);</span><br>    ui-&gt;layoutWidget-&gt;set<span class="hljs-constructor">Layout(<span class="hljs-params">mainLayout</span>)</span>;<br>    this-&gt;set<span class="hljs-constructor">Attribute(Qt::WA_DeleteOnClose)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><br>注意这里layout用的是QVBoxLayout，是具体的垂直布局，即使只有一个子控件，而不是基类QLayout（QLayout似乎并不能直接拿来用）。</p><p>setLayout(mainLayout) 和 this-&gt;setLayout(mainLayout) 都会使得控件挤成一团。不理解为什么</p><h2 id="main函数"><a href="#main函数" class="headerlink" title="main函数"></a>main函数</h2><p>首先实例化一个QApplication，然后实例化主窗口。</p><p>starPromptWindow不需要在这里实例化因为在mainWindow中实例化了。<br><figure class="highlight plaintext"><figcaption><span>"mainwindow.h"</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs #include">#include &quot;starPromptWindow.h&quot;<br>#include &lt;QApplication&gt;<br><br>int main(int argc, char *argv[])<br>&#123;<br>    QApplication a(argc, argv);<br>    MainWindow w;<br>    w.setWindowIcon(QIcon(&quot;./icon.ico&quot;));<br>    w.show();<br>    return a.exec();<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>qt说难不难，主要是麻烦。窗口之间交互依赖信号和槽，在谁里实例化谁要搞明白。而且可读性不太强。之前写过pyqt，最大区别大概是connect用法不同？</p><p>qt是把A的动作A1和某窗口（一般是this）的目标方法连接，pyqt是A的成员A1的方法connect直接连接目标方法。何况cpp大量使用指针，导致读的时候需要留个心眼看是直接传递的值还是传递了指针。</p><p>写完之后一看，思路还挺清晰的。也可能是因为我的程序比较小，规模大了也可能会比较混沌也说不定</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Glow-TTS阅读</title>
    <link href="/2024/10/16/Glow-TTS%E9%98%85%E8%AF%BB/"/>
    <url>/2024/10/16/Glow-TTS%E9%98%85%E8%AF%BB/</url>
    
    <content type="html"><![CDATA[<p>Glow-TTS，前置科技点是 tacotron2，tacotron2 的前置科技点是 Waveglow。waveglow 是完全基于流模型的，可以认为tacotron2和glow-tts都是基于它改进而来。</p><p>tacotron2 利用 waveglow 实现了更好的效果，但是没有并行，也没有单调对齐（需要手动来对齐，或者需要一个自回归TTS模型作为外部对齐器，例如 FastSpeech）。glow-tts做的就是这部分工作，引入了单调对齐搜索（Monotonic Alignment Search，MAS），MAS搜索文本和语音的潜在表示之间最可能的单调对齐关系。</p><p>效果就是更快了，快了很多；而且还能多说话人。</p><p>tacotron2 和 waveglow 都是英伟达家的。pytorch 提供了范例，快速使用 tacotron2。<br><a href="https://pytorch.org/hub/nvidia_deeplearningexamples_tacotron2/">链接</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>每天一点小知识</title>
    <link href="/2024/10/08/%E6%AF%8F%E5%A4%A9%E4%B8%80%E7%82%B9%E5%B0%8F%E7%9F%A5%E8%AF%86/"/>
    <url>/2024/10/08/%E6%AF%8F%E5%A4%A9%E4%B8%80%E7%82%B9%E5%B0%8F%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<p>骷髅王.jpg</p><h2 id="查看Windows命令对应的可执行文件路径"><a href="#查看Windows命令对应的可执行文件路径" class="headerlink" title="查看Windows命令对应的可执行文件路径"></a>查看Windows命令对应的可执行文件路径</h2><ol><li>where（cmd）</li><li>Get-Command（对于powershell而言）</li><li>which（类unix shell，例如git bash）</li><li>reg（直接查询注册表）</li></ol><h3 id="查文件拓展名关联程序"><a href="#查文件拓展名关联程序" class="headerlink" title="查文件拓展名关联程序"></a>查文件拓展名关联程序</h3><ol><li>assoc</li><li>ftype</li></ol><h2 id="如何将linux命令打印的文本整体右移？"><a href="#如何将linux命令打印的文本整体右移？" class="headerlink" title="如何将linux命令打印的文本整体右移？"></a>如何将linux命令打印的文本整体右移？</h2><pre><code class="hljs">通过管道符和某些命令来处理输出的文本......</code></pre><ol><li>使用sed</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;wspdwzh&quot;</span> | sed <span class="hljs-string">&#x27;s/^/          /&#x27;</span><br></code></pre></td></tr></table></figure><p>2.使用awk</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;wspdwzh&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print &quot;          &quot; $0&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>3.使用bash语法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;wspdwzh&quot;</span> | <span class="hljs-keyword">while</span> IFS= <span class="hljs-built_in">read</span> -r line; <span class="hljs-keyword">do</span> <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%10s\n&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$line</span>&quot;</span>; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>4.使用column</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;wspdwzh&quot;</span> | column -t -s $<span class="hljs-string">&#x27;\t&#x27;</span> -o <span class="hljs-string">&quot;          &quot;</span><br></code></pre></td></tr></table></figure><p>5.使用cut</p><p>这个和我想象中不太一样，是限制每行输出的字符范围。比如说，如果我要第3个字符：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;wspdwzh&quot;</span> | <span class="hljs-built_in">cut</span> -c 3<br></code></pre></td></tr></table></figure><p>看了一圈，最好用的还是awk。虽然这只是它庞大功能中的一个邪门用法。</p><p><a href="https://cn.linux-console.net/?p=2019">awk用法</a></p><h2 id="MOTD-message-of-the-day"><a href="#MOTD-message-of-the-day" class="headerlink" title="MOTD: message of the day"></a>MOTD: message of the day</h2><p>即linux启动时显示的那一大堆东西。一般来说每天显示一次，如果要关掉这个消息，可以创建/home/{你的用户名}/.hushlogin这么一个隐藏文件。空文件即可。</p><p>一般来说，显示的是 /etc/motd 这个文件或者 /usr/share/base-files/motd。可以通过特殊的语法更改输出的内容。但这个文件只能显示静态内容，因此有一些 .sh 文件来显示动态内容。</p><p>似乎可以通过 /usr/bin/landscape-sysinfo 和 run-parts /etc/update-motd.d 显示特定的系统信息。</p><h2 id="wsl小知识"><a href="#wsl小知识" class="headerlink" title="wsl小知识"></a>wsl小知识</h2><p>登录时加载的是 .bash_profile 而不是 .bashrc。但是你可以将“source ${HOME}/.bashrc” 加到 .bash_profile。</p><p>vscode 是 code 而不是 vscode。</p><p>可以直接打开GUI程序。例如rhythmbox。</p><p>wsl默认没法使用Windows声卡，但是可以安装PulseAudio来使用Windows声卡。可以使用apt安装。配置文件在/etc/pulse。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>nga机器人后续计划</title>
    <link href="/2024/08/24/nga%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%90%8E%E7%BB%AD%E8%AE%A1%E5%88%92/"/>
    <url>/2024/08/24/nga%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%90%8E%E7%BB%AD%E8%AE%A1%E5%88%92/</url>
    
    <content type="html"><![CDATA[<p>目前基本稳定运行了，后续计划：</p><h2 id="后台运行"><a href="#后台运行" class="headerlink" title="后台运行"></a>后台运行</h2><p>字面意思地挂在后台运行。</p><h2 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h2><p>黑框框毕竟还是不好看，操作也不方便，更不直观。</p><p>语言用的是python。我是比较熟悉Tkinter、pyqt之类图形库的，这俩用起来也能比较简单地得到想要的效果。</p><p>如果移植到C++，会比较费事情（毕竟现成的代码用不了，两个语言的特性还是有差别）；何况我不会c++。</p><h2 id="插件化？"><a href="#插件化？" class="headerlink" title="插件化？"></a>插件化？</h2><p>或许可以做成现成框架的某个插件，好处是省下了搓GUI之类的问题，有了图形界面；可以稳定运行，也可以随时更新。</p><p>（只是想想而已）</p><h1 id=""><a href="#" class="headerlink" title="#"></a>#</h1>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>nga机器人重写</title>
    <link href="/2024/07/13/nga%E6%9C%BA%E5%99%A8%E4%BA%BA%E9%87%8D%E5%86%99/"/>
    <url>/2024/07/13/nga%E6%9C%BA%E5%99%A8%E4%BA%BA%E9%87%8D%E5%86%99/</url>
    
    <content type="html"><![CDATA[<h2 id="大体思路"><a href="#大体思路" class="headerlink" title="大体思路"></a>大体思路</h2><p>使用一个 Poster 对象处理数据、请求等问题。</p><p>Potser 类中，需要创建两个 session（来自于 request库），用于管理 cookie。两个 session 分别是和 nga 的、和 bilibili 的（数据源）。最大好处是 header、cookie等重复信息不需要重复了，可以通过 session 自动管理。</p><p>站点、cookie、api key之类的可以放在环境变量中，也可以放在文件中。差别不大。</p><p>处理逻辑部分应该是可以沿用之前的，不需要更改，只是把发送请求的方式修改一下。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>qwen2微调与使用过程</title>
    <link href="/2024/07/06/qwen2%E5%BE%AE%E8%B0%83%E4%B8%8E%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B/"/>
    <url>/2024/07/06/qwen2%E5%BE%AE%E8%B0%83%E4%B8%8E%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="lora微调"><a href="#lora微调" class="headerlink" title="lora微调"></a>lora微调</h2><p>参考 <a href="https://blog.csdn.net/SoulmateY/article/details/139564504">文章</a> 进行微调，得到 .pt 和 .pth 等文件（checkpoint）。</p><p>部分代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Transformers加载模型权重</span><br>tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;./qwen/Qwen2-0___5B-Instruct/&quot;</span>, use_fast=<span class="hljs-literal">False</span>, trust_remote_code=<span class="hljs-literal">True</span>)<br>model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;./qwen/Qwen2-0___5B-Instruct/&quot;</span>, device_map=&#123;<span class="hljs-string">&quot;&quot;</span>: <span class="hljs-number">0</span>&#125;, torch_dtype=torch.bfloat16, max_memory=&#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;4GB&quot;</span>&#125;)<br>model.enable_input_require_grads()  <span class="hljs-comment"># 开启梯度检查点时，要执行该方法</span><br><br>train_dataset_path = <span class="hljs-string">&quot;Muice-Dataset/train.jsonl&quot;</span><br><br><span class="hljs-comment"># 得到训练集</span><br>train_df = pd.read_json(train_dataset_path, lines=<span class="hljs-literal">True</span>)<br>train_ds = Dataset.from_pandas(train_df)<br>train_dataset = train_ds.<span class="hljs-built_in">map</span>(process_func, remove_columns=train_ds.column_names)<br><br>config = LoraConfig(<br>    <span class="hljs-comment"># ...</span><br>)<br><br>model = get_peft_model(model, config)<br><br>args = TrainingArguments(<br>    <span class="hljs-comment"># ...</span><br>)<br><br>swanlab_callback = SwanLabCallback(<br>    <span class="hljs-comment"># ...</span><br>    config=&#123;<br>   <br>        <span class="hljs-string">&quot;model&quot;</span>: <span class="hljs-string">&quot;qwen/Qwen2_05B_Instruct&quot;</span>,<br>        <span class="hljs-string">&quot;dataset&quot;</span>: <span class="hljs-string">&quot;huangjintao/Muice-Dataset&quot;</span>,<br>    &#125;<br>)<br><br>trainer = Trainer(<br>    model=model,<br>    args=args,<br>    train_dataset=train_dataset,<br>    data_collator=DataCollatorForSeq2Seq(tokenizer=tokenizer, padding=<span class="hljs-literal">True</span>),<br>    callbacks=[swanlab_callback],<br>)<br><br>trainer.train()<br>trainer.save_model(<span class="hljs-string">&quot;./trained&quot;</span>)  <span class="hljs-comment"># 这将保存模型权重到指定目录</span><br>tokenizer.save_pretrained(<span class="hljs-string">&quot;./trained&quot;</span>)  <span class="hljs-comment"># 确保和模型权重保存在同一目录</span><br>model.config.save_pretrained(<span class="hljs-string">&quot;./trained&quot;</span>)<br><br>swanlab.finish()<br><br></code></pre></td></tr></table></figure><p>首先加载 tokenizer，model，然后设置trainer想要的部分参数（如 config，TrainingArguments），使用 train 方法开始训练，训练结束后保存模型 和 tokenizer。</p><h2 id="与底模合并"><a href="#与底模合并" class="headerlink" title="与底模合并"></a>与底模合并</h2><p>参考 <a href="https://blog.csdn.net/spiderwower/article/details/138755776">文章</a>，使用其中的 merge.py 合并，得到safetensor及其附属文件。</p><p>部分代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">base = AutoModelForCausalLM.from_pretrained(model_path, torch_dtype=torch.bfloat16)<br>base_tokenizer = AutoTokenizer.from_pretrained(model_path)<br>lora_model = PeftModel.from_pretrained(<br>    base,<br>    lora_path,<br>    torch_dtype=torch.float16,<br>    config=config<br>)<br>model = lora_model.merge_and_unload()<br>model.save_pretrained(output_path)<br>base_tokenizer.save_pretrained(output_path)<br></code></pre></td></tr></table></figure><p>首先，加载底模 和 训练得到的对应lora（checkpoint文件），然后使用 merge_and_unload 方法 进行合并。</p><p>合并得到的是 safetensor 文件。</p><h2 id="合并为-bin文件"><a href="#合并为-bin文件" class="headerlink" title="合并为.bin文件"></a>合并为.bin文件</h2><p>使用 llama.cpp 中的 convert-legacy-llama.py 进行合并。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python ./examples/<span class="hljs-built_in">convert-legacy</span><span class="hljs-literal">-llama</span>.py G:\Git\qwen<span class="hljs-literal">-tmp-1</span>\merged\merged<span class="hljs-literal">-2</span> <span class="hljs-literal">--outtype</span> f16 <span class="hljs-literal">--outfile</span> G:\Git\qwen<span class="hljs-literal">-tmp-1</span>\merged\merged<span class="hljs-literal">-2</span>.bin <span class="hljs-literal">--vocab-type</span> bpe <span class="hljs-literal">--pad-vocab</span> <br></code></pre></td></tr></table></figure><p>注意最后的两个参数：—vocab-type bpe 和 —pad-vocab。</p><p>如果不添加前者，可能会出现：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">FileNotFoundError: Could not find a tokenizer matching any of [<span class="hljs-string">&#x27;spm&#x27;</span>, <span class="hljs-string">&#x27;hfft&#x27;</span>]<br></code></pre></td></tr></table></figure><p>如果不添加后者，可能会出现尺寸不符：<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ValueError: Vocab size mismatch (model has <span class="hljs-number">151936</span>, but G:\Git\qwen<span class="hljs-literal">-tmp-1</span>\merged\merged<span class="hljs-literal">-2</span>\vocab.json has <span class="hljs-number">151646</span>). Add the <span class="hljs-literal">--pad-vocab</span> option and <span class="hljs-keyword">try</span> again.<br></code></pre></td></tr></table></figure></p><h3 id="但是对于-qwen-来说"><a href="#但是对于-qwen-来说" class="headerlink" title="但是对于 qwen 来说"></a>但是对于 qwen 来说</h3><p>需要使用 convert-hf-to-gguf.py 而不是 convert-legacy-llama.py。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python ./<span class="hljs-built_in">convert-hf</span><span class="hljs-literal">-to-gguf</span>.py G:\Git\qwen<span class="hljs-literal">-tmp-1</span>\merged\merged<span class="hljs-literal">-3</span> <span class="hljs-literal">--outtype</span> f16 <span class="hljs-literal">--outfile</span> G:\Git\qwen<span class="hljs-literal">-tmp-1</span>\merged\merged<span class="hljs-literal">-3-3</span>.bin<br></code></pre></td></tr></table></figure><p>这个时候，就不需要后面的参数了。</p><p>后续部分照常。</p><h2 id="bin-文件量化"><a href="#bin-文件量化" class="headerlink" title=".bin 文件量化"></a>.bin 文件量化</h2><p>依然是使用 llama.cpp。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">./bin/llama<span class="hljs-literal">-quantize</span>.exe G:\Git\qwen<span class="hljs-literal">-tmp-1</span>\merged\merged<span class="hljs-literal">-2</span>.bin q5_k_m<br></code></pre></td></tr></table></figure><p>有多种量化方式可以选择。量化后，得到 .gguf 文件。当然，也可以使用 COPY， 不进行量化，只是单纯的拷贝到 gguf 文件。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Allowed quantization types:<br>   <span class="hljs-number">2</span>  or  Q4_0    :  <span class="hljs-number">4.34</span>G, +<span class="hljs-number">0.4685</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>   <span class="hljs-number">3</span>  or  Q4_1    :  <span class="hljs-number">4.78</span>G, +<span class="hljs-number">0.4511</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>   <span class="hljs-number">8</span>  or  Q5_0    :  <span class="hljs-number">5.21</span>G, +<span class="hljs-number">0.1316</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>   <span class="hljs-number">9</span>  or  Q5_1    :  <span class="hljs-number">5.65</span>G, +<span class="hljs-number">0.1062</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">19</span>  or  IQ2_XXS :  <span class="hljs-number">2.06</span> bpw quantization<br>  <span class="hljs-number">20</span>  or  IQ2_XS  :  <span class="hljs-number">2.31</span> bpw quantization<br>  <span class="hljs-number">28</span>  or  IQ2_S   :  <span class="hljs-number">2.5</span>  bpw quantization<br>  <span class="hljs-number">29</span>  or  IQ2_M   :  <span class="hljs-number">2.7</span>  bpw quantization<br>  <span class="hljs-number">24</span>  or  IQ1_S   :  <span class="hljs-number">1.56</span> bpw quantization<br>  <span class="hljs-number">31</span>  or  IQ1_M   :  <span class="hljs-number">1.75</span> bpw quantization<br>  <span class="hljs-number">10</span>  or  Q2_K    :  <span class="hljs-number">2.96</span>G, +<span class="hljs-number">3.5199</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">21</span>  or  Q2_K_S  :  <span class="hljs-number">2.96</span>G, +<span class="hljs-number">3.1836</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">23</span>  or  IQ3_XXS :  <span class="hljs-number">3.06</span> bpw quantization<br>  <span class="hljs-number">26</span>  or  IQ3_S   :  <span class="hljs-number">3.44</span> bpw quantization<br>  <span class="hljs-number">27</span>  or  IQ3_M   :  <span class="hljs-number">3.66</span> bpw quantization mix<br>  <span class="hljs-number">12</span>  or  Q3_K    : alias <span class="hljs-keyword">for</span> Q3_K_M<br>  <span class="hljs-number">22</span>  or  IQ3_XS  :  <span class="hljs-number">3.3</span> bpw quantization<br>  <span class="hljs-number">11</span>  or  Q3_K_S  :  <span class="hljs-number">3.41</span>G, +<span class="hljs-number">1.6321</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">12</span>  or  Q3_K_M  :  <span class="hljs-number">3.74</span>G, +<span class="hljs-number">0.6569</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">13</span>  or  Q3_K_L  :  <span class="hljs-number">4.03</span>G, +<span class="hljs-number">0.5562</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">25</span>  or  IQ4_NL  :  <span class="hljs-number">4.50</span> bpw non<span class="hljs-literal">-linear</span> quantization<br>  <span class="hljs-number">30</span>  or  IQ4_XS  :  <span class="hljs-number">4.25</span> bpw non<span class="hljs-literal">-linear</span> quantization<br>  <span class="hljs-number">15</span>  or  Q4_K    : alias <span class="hljs-keyword">for</span> Q4_K_M<br>  <span class="hljs-number">14</span>  or  Q4_K_S  :  <span class="hljs-number">4.37</span>G, +<span class="hljs-number">0.2689</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">15</span>  or  Q4_K_M  :  <span class="hljs-number">4.58</span>G, +<span class="hljs-number">0.1754</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">17</span>  or  Q5_K    : alias <span class="hljs-keyword">for</span> Q5_K_M<br>  <span class="hljs-number">16</span>  or  Q5_K_S  :  <span class="hljs-number">5.21</span>G, +<span class="hljs-number">0.1049</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">17</span>  or  Q5_K_M  :  <span class="hljs-number">5.33</span>G, +<span class="hljs-number">0.0569</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>  <span class="hljs-number">18</span>  or  Q6_K    :  <span class="hljs-number">6.14</span>G, +<span class="hljs-number">0.0217</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>   <span class="hljs-number">7</span>  or  Q8_0    :  <span class="hljs-number">7.96</span>G, +<span class="hljs-number">0.0026</span> ppl <span class="hljs-selector-tag">@</span> Llama<span class="hljs-literal">-3-8B</span><br>   <span class="hljs-number">1</span>  or  F16     : <span class="hljs-number">14.00</span>G, +<span class="hljs-number">0.0020</span> ppl <span class="hljs-selector-tag">@</span> Mistral<span class="hljs-literal">-7B</span><br>  <span class="hljs-number">32</span>  or  BF16    : <span class="hljs-number">14.00</span>G, <span class="hljs-literal">-0</span>.<span class="hljs-number">0050</span> ppl <span class="hljs-selector-tag">@</span> Mistral<span class="hljs-literal">-7B</span><br>   <span class="hljs-number">0</span>  or  F32     : <span class="hljs-number">26.00</span>G              <span class="hljs-selector-tag">@</span> <span class="hljs-number">7</span>B<br>          <span class="hljs-built_in">COPY</span>    : only <span class="hljs-built_in">copy</span> tensors, no quantizing<br></code></pre></td></tr></table></figure><p>阿里官方发布的微调模型使用的是 Q4_0 量化。</p><h2 id="在-ollama-中使用"><a href="#在-ollama-中使用" class="headerlink" title="在 ollama 中使用"></a>在 ollama 中使用</h2><p>使用 <code>ollama create &lt;modelname&gt; -f &lt;modelfile&gt;</code></p><p>其中，modelname是自己指定，在 ollama run后面跟的那个名字；modelfile默认是当前目录下的 Modelfile 文件，内容应该为 <code>FROM &lt;gguf文件路径&gt;</code>，当然也可以通过 -f 参数指定。</p><p>然后就可以和其他模型一样使用了，使用<code>ollama run</code>或者通过 api 使用。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如果只是单纯想要训练一个lora并合并，这个过程并不复杂，不涉及模型内部层的修改。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024年5月8日-日志</title>
    <link href="/2024/05/08/2024%E5%B9%B45%E6%9C%888%E6%97%A5-%E6%97%A5%E5%BF%97/"/>
    <url>/2024/05/08/2024%E5%B9%B45%E6%9C%888%E6%97%A5-%E6%97%A5%E5%BF%97/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024年5月5日-matlab</title>
    <link href="/2024/05/05/2024%E5%B9%B45%E6%9C%885%E6%97%A5-matlab/"/>
    <url>/2024/05/05/2024%E5%B9%B45%E6%9C%885%E6%97%A5-matlab/</url>
    
    <content type="html"><![CDATA[<p>正在编写matlab程序，以实现哈夫曼编码</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul><li>第一步，降序排列符号</li><li>第二步，将0和1分别分配给概率最小的两个码元</li><li>第三步，将概率最小的这两个码元进行概率相加<ul><li>然后重复第一步到第三步，直到数组长度变为1</li><li>以上过程中，0和1记录在code矩阵中，code是一个N-1×N的矩阵，</li></ul></li><li>第四步，从上往下读取编码后的结果，将离散的0和1串联成为01序列</li></ul><p>其中，一到四步在循环内完成。</p><h3 id="同时对两个数组进行排序"><a href="#同时对两个数组进行排序" class="headerlink" title="同时对两个数组进行排序"></a>同时对两个数组进行排序</h3><p><code>[p_SD,reflect(i,1:M)] = sort(p_SD,&#39;descend&#39;);</code> </p><p>这一句的意思是对 p_SD、reflect的第i行的1～M位进行排序，顺序是按照p_SD的大小降序。matlab的代码在直观性上很抽象。虽然确实很强大。</p><p>要求长度一样即可。</p><p>注意对于矩阵的一行排序的时候，其他行不会被改变。</p><h3 id="参考代码思路梳理"><a href="#参考代码思路梳理" class="headerlink" title="参考代码思路梳理"></a>参考代码思路梳理</h3><p>参考代码来自<a href="https://blog.csdn.net/weixin_46258766/article/details/117607050">https://blog.csdn.net/weixin_46258766/article/details/117607050</a></p><p>原本的全部代码：<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-comment">%% 实验四：哈夫曼编码仿真实现</span><br>clear all<br>clc<br><span class="hljs-comment">% 用户输入符号概率</span><br>p = input(<span class="hljs-string">&#x27;请输入离散信源概率分布，例如[0.5,0.5]：\n&#x27;</span>);<br>N = <span class="hljs-built_in">length</span>(p);<br><br><span class="hljs-comment">% 将概率排序并获得单步码字排序</span><br>code = strings(N<span class="hljs-number">-1</span>,N);<span class="hljs-comment">% 初始化单步过程的码字</span><br>reflect = <span class="hljs-built_in">zeros</span>(N<span class="hljs-number">-1</span>,N);<span class="hljs-comment">% 初始化位置对应向量</span><br>p_SD = p;<span class="hljs-comment">% p_SD为每次得到的概率排序数组</span><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span>:N<span class="hljs-number">-1</span>           <span class="hljs-comment">% i表示排序后第几个符号</span><br>    M = <span class="hljs-built_in">length</span>(p_SD);<br>    [p_SD,reflect(<span class="hljs-built_in">i</span>,<span class="hljs-number">1</span>:M)] = <span class="hljs-built_in">sort</span>(p_SD,<span class="hljs-string">&#x27;descend&#x27;</span>);<span class="hljs-comment">% 将概率从大到小进行排序</span><br>    code(<span class="hljs-built_in">i</span>,M) = <span class="hljs-string">&#x27;1&#x27;</span>;<span class="hljs-comment">% 概率最小的是1</span><br>    code(<span class="hljs-built_in">i</span>,M<span class="hljs-number">-1</span>) = <span class="hljs-string">&#x27;0&#x27;</span>;<span class="hljs-comment">% 概率第二小的暂且定义为0</span><br>    p_SD(M<span class="hljs-number">-1</span>) = p_SD(M<span class="hljs-number">-1</span>)+p_SD(M);<span class="hljs-comment">% 将最后两个概率相加</span><br>    p_SD(M)=[];<br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">% 根据位置对应向量和单步过程的码字计算对应码字</span><br>CODE = strings(<span class="hljs-number">1</span>,N); <span class="hljs-comment">% 初始化对应码字</span><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span>:N<br>    column = <span class="hljs-built_in">i</span>;<br>    <span class="hljs-keyword">for</span> m=<span class="hljs-number">1</span>:N<span class="hljs-number">-1</span><br>        [row,column] = <span class="hljs-built_in">find</span>(reflect(m,:)==column);<br>        CODE(<span class="hljs-number">1</span>,<span class="hljs-built_in">i</span>) = strcat(CODE(<span class="hljs-number">1</span>,<span class="hljs-built_in">i</span>),code(m,column));<br>        <span class="hljs-comment">% 将最小的两个概率映射成一个</span><br>        <span class="hljs-keyword">if</span> column==N+<span class="hljs-number">1</span>-m<br>            column = column<span class="hljs-number">-1</span>;<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br>CODE = reverse(CODE);<br><br><span class="hljs-comment">% 计算平均码长</span><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span>:N<br>    L(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">size</span>(char(CODE(<span class="hljs-number">1</span>,<span class="hljs-built_in">i</span>)),<span class="hljs-number">2</span>);<br><span class="hljs-keyword">end</span><br>L_ave = sum(L.*p);      <br>H = sum(-p.*<span class="hljs-built_in">log2</span>(p));   <span class="hljs-comment">% 计算信源信息熵</span><br>yita = H/L_ave;         <span class="hljs-comment">% 计算编码效率</span><br><br><span class="hljs-comment">% 展示输出码字、平均码长和编码效率</span><br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;信号符号  &#x27;</span>,num2str(<span class="hljs-number">1</span>:N)]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;对应概率  &#x27;</span>,num2str(p)]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;对应码字  &#x27;</span>,CODE]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;平均码长&#x27;</span>,num2str(L_ave)]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;编码效率&#x27;</span>,num2str(yita)]);<br></code></pre></td></tr></table></figure><br><strong>第一段，准备：</strong></p><p>初始化用到的向量，矩阵，还有概率数组。<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs matlab">clear all<br>clc<br><span class="hljs-comment">% 用户输入符号概率</span><br>p = input(<span class="hljs-string">&#x27;请输入离散信源概率分布，例如[0.5,0.5]：\n&#x27;</span>);<br>N = <span class="hljs-built_in">length</span>(p);<br><br><span class="hljs-comment">% 将概率排序并获得单步码字排序</span><br>code = strings(N<span class="hljs-number">-1</span>,N);<span class="hljs-comment">% 初始化单步过程的码字</span><br>reflect = <span class="hljs-built_in">zeros</span>(N<span class="hljs-number">-1</span>,N);<span class="hljs-comment">% 初始化位置对应向量</span><br>p_SD = p;<span class="hljs-comment">% p_SD为每次得到的概率排序数组</span><br></code></pre></td></tr></table></figure></p><p><strong>第一个循环：</strong></p><ol><li>排序：同时排序p_SD和reflect的第i行</li><li>对code进行赋值</li><li>概率相加，最后一位消除</li></ol><p>总之p_SD始终是从大到小的概率降序，在排序过程中，reflect会记录每一次循环中的排序结果。reflect和code都是N-1×N大小的矩阵，每一行对应循环中的一轮。<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span>:N<span class="hljs-number">-1</span>           <span class="hljs-comment">% i表示排序后第几个符号</span><br>    M = <span class="hljs-built_in">length</span>(p_SD);<br>    [p_SD,reflect(<span class="hljs-built_in">i</span>,<span class="hljs-number">1</span>:M)] = <span class="hljs-built_in">sort</span>(p_SD,<span class="hljs-string">&#x27;descend&#x27;</span>);<span class="hljs-comment">% 将概率从大到小进行排序</span><br>    code(<span class="hljs-built_in">i</span>,M) = <span class="hljs-string">&#x27;1&#x27;</span>;<span class="hljs-comment">% 概率最小的是1</span><br>    code(<span class="hljs-built_in">i</span>,M<span class="hljs-number">-1</span>) = <span class="hljs-string">&#x27;0&#x27;</span>;<span class="hljs-comment">% 概率第二小的暂且定义为0</span><br>    p_SD(M<span class="hljs-number">-1</span>) = p_SD(M<span class="hljs-number">-1</span>)+p_SD(M);<span class="hljs-comment">% 将最后两个概率相加</span><br>    p_SD(M)=[];<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><br><strong>第二个循环：</strong></p><p>将之前得到的code、reflect合并成为CODE。</p><p>m 对应行，i 对应列（的末尾）。i 也可以说是对应 CODE 的每一个元素，或者说是每一个码字。</p><p>中间的一层循环是对于每一行进行扫描，首先找到 reflect 的这一行中数值与 column 相同的那一列，然后根据找到的这个数据的位置，找到 code 里面对应的数据（0 或者 1），连接在 CODE 对应位置数据的尾端。</p><p>如果 column == N+1-m，也就是找到的数据位置在右边的那个对角线上，那么往左挪一格。</p><p>用文字说明起来可能很抽象。</p><p>总之就是 (m,column) 这个坐标的移动是二者的先后移动。呈现在图形上就是锯齿状的移动。每一行上，只有右对角线和左对角线上面的数据是有意义的，记录着 0 和 1。<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-comment">% 根据位置对应向量和单步过程的码字计算对应码字</span><br>CODE = strings(<span class="hljs-number">1</span>,N); <span class="hljs-comment">% 初始化对应码字</span><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span>:N<br>    column = <span class="hljs-built_in">i</span>;<br>    <span class="hljs-keyword">for</span> m=<span class="hljs-number">1</span>:N<span class="hljs-number">-1</span><br>        [row,column] = <span class="hljs-built_in">find</span>(reflect(m,:)==column);<br>        CODE(<span class="hljs-number">1</span>,<span class="hljs-built_in">i</span>) = strcat(CODE(<span class="hljs-number">1</span>,<span class="hljs-built_in">i</span>),code(m,column));<br>        <span class="hljs-comment">% 将最小的两个概率映射成一个</span><br>        <span class="hljs-keyword">if</span> column==N+<span class="hljs-number">1</span>-m<br>            column = column<span class="hljs-number">-1</span>;<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br>CODE = reverse(CODE);<br></code></pre></td></tr></table></figure><br>数据处理：<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-comment">% 计算平均码长</span><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span>:N<br>    L(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">size</span>(char(CODE(<span class="hljs-number">1</span>,<span class="hljs-built_in">i</span>)),<span class="hljs-number">2</span>);<br><span class="hljs-keyword">end</span><br>L_ave = sum(L.*p);      <br>H = sum(-p.*<span class="hljs-built_in">log2</span>(p));   <span class="hljs-comment">% 计算信源信息熵</span><br>yita = H/L_ave;         <span class="hljs-comment">% 计算编码效率</span><br></code></pre></td></tr></table></figure><br>展示：<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><br><span class="hljs-comment">% 展示输出码字、平均码长和编码效率</span><br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;信号符号  &#x27;</span>,num2str(<span class="hljs-number">1</span>:N)]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;对应概率  &#x27;</span>,num2str(p)]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;对应码字  &#x27;</span>,CODE]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;平均码长&#x27;</span>,num2str(L_ave)]);<br><span class="hljs-built_in">disp</span>([<span class="hljs-string">&#x27;编码效率&#x27;</span>,num2str(yita)]);<br></code></pre></td></tr></table></figure></p><h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>在第一轮循环中，直接记录 CODE。</p><p>即，CODE 和 table_data 等宽，table_data 第一行为码字，第二行为概率，第三行为12345的顺序。每一轮循环中，顺序的最后两个被分别赋予 0 和 1。注意不是数组的最后两个，而是table_data第三行的最小的两个。也就是 N-i（对应1） 和 N-i-1（对应0）。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024年4月19日</title>
    <link href="/2024/04/19/2024%E5%B9%B44%E6%9C%8819%E6%97%A5/"/>
    <url>/2024/04/19/2024%E5%B9%B44%E6%9C%8819%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>香橙派 zero2 使用的全志 H616 架构为 ARMv8，而不是 v7。安装 nomachine 成功之后会提示：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs applescript">(Reading database ... <span class="hljs-number">84977</span> files <span class="hljs-keyword">and</span> directories currently installed.)<br>Preparing <span class="hljs-keyword">to</span> unpack nomachine_8<span class="hljs-number">.11</span><span class="hljs-number">.3</span>_3_arm64.deb ...<br>Unpacking nomachine (<span class="hljs-number">8.11</span><span class="hljs-number">.3</span><span class="hljs-number">-3</span>) <span class="hljs-keyword">over</span> (<span class="hljs-number">8.11</span><span class="hljs-number">.3</span><span class="hljs-number">-3</span>) ...<br>Setting up nomachine (<span class="hljs-number">8.11</span><span class="hljs-number">.3</span><span class="hljs-number">-3</span>) ...<br>NX&gt; <span class="hljs-number">700</span> Starting installation <span class="hljs-keyword">at</span>: Fri, <span class="hljs-number">19</span> Apr <span class="hljs-number">2024</span> <span class="hljs-number">18</span>:<span class="hljs-number">16</span>:<span class="hljs-number">16.</span><br>NX&gt; <span class="hljs-number">700</span> Using installation profile: Ubuntu.<br>NX&gt; <span class="hljs-number">700</span> Installation <span class="hljs-built_in">log</span> <span class="hljs-keyword">is</span>: /usr/NX/var/<span class="hljs-built_in">log</span>/nxinstall.<span class="hljs-built_in">log</span>.<br>NX&gt; <span class="hljs-number">700</span> Installing nxrunner <span class="hljs-built_in">version</span>: <span class="hljs-number">8.11</span><span class="hljs-number">.3</span>.<br>NX&gt; <span class="hljs-number">700</span> Installing nxplayer <span class="hljs-built_in">version</span>: <span class="hljs-number">8.11</span><span class="hljs-number">.3</span>.<br>NX&gt; <span class="hljs-number">700</span> Installing nxnode <span class="hljs-built_in">version</span>: <span class="hljs-number">8.11</span><span class="hljs-number">.3</span>.<br>NX&gt; <span class="hljs-number">700</span> Installing nxserver <span class="hljs-built_in">version</span>: <span class="hljs-number">8.11</span><span class="hljs-number">.3</span>.<br>NX&gt; <span class="hljs-number">700</span> Installation completed <span class="hljs-keyword">at</span>: Fri, <span class="hljs-number">19</span> Apr <span class="hljs-number">2024</span> <span class="hljs-number">18</span>:<span class="hljs-number">17</span>:<span class="hljs-number">19.</span><br>NX&gt; <span class="hljs-number">700</span> NoMachine was configured <span class="hljs-keyword">to</span> <span class="hljs-built_in">run</span> <span class="hljs-keyword">the</span> following services:<br>NX&gt; <span class="hljs-number">700</span> NX service <span class="hljs-keyword">on</span> port: <span class="hljs-number">4000</span><br></code></pre></td></tr></table></figure><p>而且需要注意，要想安装 nomachine，系统版本应该是桌面版本（而不是服务器版本）。不过，如果是服务器版本也问题不大，nomachine 会自动安装桌面。</p><p>和 vnc 相比，好处是可以自动启动并使用pc扫描4000端口，从而实现一样的效果；还有就是不需要操心vncserver的状态，或者端口啥的，默认状态就挺好</p><p>坏处大概是不能指定桌面（例如，我安装的xfce就不能使用）</p><p>注意 xfce 的远程桌面运行对应的进程/服务是 dbus 还有 vncserver，其中vncserver 需要手动启用一下（或者放在 bashrc 里面开机自启动）</p><p>可以用tigervnc，也可以用Windows的远程桌面，有时候两个都能用有时候其中一个不能用。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">vncserver</span> -localhost yes :<span class="hljs-number">1</span><br><span class="hljs-comment"># 启动，注意不要加上 -localhost yes，加了之后会拒绝除了本地之外的其他请求。</span><br><br><span class="hljs-attribute">vncserver</span> -kill :<span class="hljs-number">1</span><br><span class="hljs-comment"># 停止</span><br><br><span class="hljs-attribute">vncpasswd</span><br><span class="hljs-comment"># 改密码</span><br></code></pre></td></tr></table></figure><h2 id="spi显示"><a href="#spi显示" class="headerlink" title="spi显示"></a>spi显示</h2><p>dev中的fb0和fb1：framebuffer，一段内存，作为显示的缓存，在官方文档给出的指令 <code>fbi-vt 1-noverbose-d /dev/fb1 /boot/boot.bmp</code> 作为显示图片的方式。</p><p>未完待续</p><h2 id="交错战线机器人"><a href="#交错战线机器人" class="headerlink" title="交错战线机器人"></a>交错战线机器人</h2><p>遇到了b站转发动态、长文的情况，如果是转发动态，那么旧版程序只能搬运动态本身，搬运不了转发的动态；如果是长文，从动态里只能浏览部分文本，格式会被强行压缩。</p><h3 id="转发动态"><a href="#转发动态" class="headerlink" title="转发动态"></a>转发动态</h3><p>动态正文是 “modules”，转发的动态是 “orig”。因此，在处理数据的时候，只需要判断是否具有 “orig”，如果有，按照一样的方式解析即可。</p><p>其中，“orig” 底下有着和原本动态一模一样的结构，也就是说[“modules”] 可以被直接替换为 [“orig”][“modules”]用同样的方式解析，因为结构是完全一样的。</p><p>很顺利地解决了。</p><p>顺利到难以置信。居然只调试了三次……</p><h3 id="长文"><a href="#长文" class="headerlink" title="长文"></a>长文</h3><p>我想要一个获取 cv（专栏文章）全文的方法。</p><p>我发觉其中和 “desc” 并列有一个 “id”，如果是专栏文章，那么 “id” 就等同于 “cv” 后面的数字。例如，id，33838995，对应 cv33838995。这样就不需要正则表达式提取 cv 号码了。</p><p>不过这个 id 并不是动态id，动态id是前面那个第一层的 id_str</p><p>如果通过 id_str 和 <a href="https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/get_dynamic_detail?dynamic_id=920925182538809433">https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/get_dynamic_detail?dynamic_id=920925182538809433</a> 获取到的动态，那依旧是被裁剪过的，并不是我想要的全文。</p><p><a href="https://api.bilibili.com/x/article/viewinfo?id=33838995">https://api.bilibili.com/x/article/viewinfo?id=33838995</a> 也仅仅是专栏基本信息，不包括内容。</p><p>看了一圈，b站把这个权限封死了，需要申请 <a href="https://openhome.bilibili.com/doc/4/b14b77b6-8889-8c8b-2e83-17c5a4c550fb">https://openhome.bilibili.com/doc/4/b14b77b6-8889-8c8b-2e83-17c5a4c550fb</a></p><p>而且还需要被查询的用户本人授权，捏麻的。</p><p>nga 有人在和我做一样的事情 <a href="https://ngabbs.com/read.php?tid=19914874">https://ngabbs.com/read.php?tid=19914874</a> 而且是版务，五年之前就开始了。</p><p>谢谢你，陌生人。 <a href="https://github.com/sjn4048/KingOfGloryTools/tree/master/html-md2nga">https://github.com/sjn4048/KingOfGloryTools/tree/master/html-md2nga</a></p><h3 id="长文-1"><a href="#长文-1" class="headerlink" title="长文"></a>长文</h3><p>之后还是没有用上 html2nga，自己写了转换的逻辑</p><p>大概就是先拉网页，找到正文就成功了一半。正文每一行是 <code>&lt;p&gt;</code>，图片在 <code>figure</code> 里面。和之前的逻辑基本一样，甚至还要简单很多很多。</p><p>浏览网页的文章是不需要授权的，赢。</p><p>另外，我判断如果上一行是空行，那么就加粗加大字号。很草率，但我没想到更好的判断标题的办法。</p><p>就这样吧。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024年4月12日</title>
    <link href="/2024/04/12/2024%E5%B9%B44%E6%9C%8812%E6%97%A5-%E6%B3%B0%E5%B1%B1%E6%B4%BE/"/>
    <url>/2024/04/12/2024%E5%B9%B44%E6%9C%8812%E6%97%A5-%E6%B3%B0%E5%B1%B1%E6%B4%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="泰山派"><a href="#泰山派" class="headerlink" title="泰山派"></a>泰山派</h2><p>启动环节出了问题，启动到两秒的时候会报错重启，不断重复。以为是系统没有安装好，重新烧写了两次，还是这样子。</p><p>事实证明是不能使用电脑左边的 usb 口，而是需要右边的。应该是电压/电流问题。电压诱骗小板我没有使用。</p><h2 id="计划（应用）"><a href="#计划（应用）" class="headerlink" title="计划（应用）"></a>计划（应用）</h2><p>我计划在上面部署一个小型的神经网络，api 用 rk 官方给出的 c++ api，程序使用 vits（tts模型）移植到 c++ 平台上。当然，已经有人完成了代码的编写，但是我希望通过自行移植学习并熟悉 c++ 的开发流程和 vits 本身。完成之后，对比我自己写的和已有的代码，加深我对于 c++ 的理解。</p><p>vits 本身及其衍生项目资料，有人做了整理：<a href="https://zhuanlan.zhihu.com/p/474601997">https://zhuanlan.zhihu.com/p/474601997</a></p><p>vits，带GAN的变分推理自编码器语音推理，实质上是一种比较成熟的思想，结合了注意力、归一化流、对抗网络实现的一个端到端语音相关项目，不光能用在tts领域，也可以做出翻唱变声之类的效果。vits 衍生模型可以说已经不局限于 vits 本身，有很多地方引入了其他的结构（例如，改变流模型的wavenet，变成cnn可以实时推理，变成transformer可以效果更好）。</p><p>tts模型能被压缩到很迷你的水准：原作者训练的模型只有14M，经过改进的 so-vits-svc-5.0 只有 202M，相对于动辄几个G十几个G的大模型而言可太小了。对于性能严重不足的 1G 版本泰山派（我暂时不想魔改），模型的大小和推理速度很重要。</p><p><a href="https://github.com/PlayVoice/so-vits-svc-5.0">https://github.com/PlayVoice/so-vits-svc-5.0</a></p><p>不部署 yolo5 是因为我没摄像头，搞不起来。摄像头得加钱。板子上面预留了一个 MIPI-CSI 摄像头口子，如果有摄像头那确实可以很方便地加上去。但是 1080p 的要六七十块，肉疼。（宣传说专门用于树莓派的更贵，一个摄像头顶俩泰山派）</p><p>便宜一点的也有，800万像素，三十多，加运费四十多。</p><p>看到有一家包邮 35 的，800万像素。不得不说免运费在买这种小东西上优势巨大。</p><p>有一个 25 包邮的笔记本电脑用摄像头，1080p，但是是usb口出来。</p><p>顺带一提，这板子也没有 3.5mm 孔，需要扩展板，但是有一个咪头，可以用廉价的咪头话筒/扬声器。官方提供了一个现成的音频小板，有麦有扬声器，是咪头。自己买元器件来焊少说要个两三块，省钱了。</p><p>更新：使用 aplay -l 寻找音频输出口的时候，会提示没有声卡（也就是不认这个设备），使用 arecord -l 同理。</p><p>另外，yolo 可以是只识别单张图片，不需要视频串流输入。</p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>官方提供了 python 和 c 的sdk：<a href="https://github.com/airockchip/rknn-toolkit2">https://github.com/airockchip/rknn-toolkit2</a></p><p>和例程：<a href="https://github.com/airockchip/rknn_model_zoo">https://github.com/airockchip/rknn_model_zoo</a></p><p>官方文档：<a href="https://t.rock-chips.com/wiki/CN/tb-rk3588x/">https://t.rock-chips.com/wiki/CN/tb-rk3588x/</a> 但是是3588版本，不过也能参考。</p><p>提供的镜像中有 rknpu2，但是版本较低。</p><h2 id="zoo-提供的-example"><a href="#zoo-提供的-example" class="headerlink" title="zoo 提供的 example"></a>zoo 提供的 example</h2><p>文字处理部分，使用了 Lite Transformer，用于嵌入式设备（低算力）的 Transformer。极限情况下能将 transformer 模型规模降低 18 倍（太抽象了）。</p><p><a href="https://arxiv.org/abs/2004.11886">https://arxiv.org/abs/2004.11886</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>初试C++</title>
    <link href="/2024/04/11/%E5%88%9D%E8%AF%95C/"/>
    <url>/2024/04/11/%E5%88%9D%E8%AF%95C/</url>
    
    <content type="html"><![CDATA[<p>想要将一个小型的神经网络移植到嵌入式平台，对性能和实时性要求较高，于是开始学 C++。</p><p>python 可以实现部分小型网络（例如 yolo5）的部署，但是针对未经优化的网络，python 还是太慢了些。</p><h2 id="visual-studio-环境配置"><a href="#visual-studio-环境配置" class="headerlink" title="visual studio 环境配置"></a>visual studio 环境配置</h2><p>先把需要使用的 libtorch 导入。编辑 CMakeLists.txt：</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024年3月30日交错战线机器人</title>
    <link href="/2024/03/30/2024%E5%B9%B43%E6%9C%8830%E6%97%A5%E4%BA%A4%E9%94%99%E6%88%98%E7%BA%BF%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
    <url>/2024/03/30/2024%E5%B9%B43%E6%9C%8830%E6%97%A5%E4%BA%A4%E9%94%99%E6%88%98%E7%BA%BF%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
    
    <content type="html"><![CDATA[<p>之前忘记加上附件类型的判断了。</p><p>我需要的附件类型只有两个，一个是静态图片，一个是动态图片。视频传不了，音频不会有。</p><p>而我需要保证的是传上去、正确的传上去。 nga 的附件发送需要提供附件名称、附件类型：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">attachment_file1_url_utf8_name</span> = <span class="hljs-string">&quot;image_gif%2egif&quot;</span><br><span class="hljs-attr">Content_Type</span> = <span class="hljs-string">&#x27;image/gif&#x27;</span><br></code></pre></td></tr></table></figure><p>很简单。</p><p>不过，除了请求体里面需要修改，还需要在文件列表中进行修改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">files</span>=[<br>        (<span class="hljs-string">&#x27;attachment_file1&#x27;</span>,(filename, img, Content_Type))<br>        ]<br></code></pre></td></tr></table></figure><p>nga 的静态图片有 4M 大小上限，而动态图 gif 文件没有。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>读VITS代码</title>
    <link href="/2024/03/29/%E8%AF%BBVITS%E4%BB%A3%E7%A0%81/"/>
    <url>/2024/03/29/%E8%AF%BBVITS%E4%BB%A3%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<p>总之就是读一下 vits（原论文标题：Conditional Variational Autoencoder with Adversarial Learning for End-to-End Text-to-Speech）。vits， “Variational Inference with adversarial learning for end-to-end Text-to-Speech”，一个变分推理、对抗学习、端到端的 TTS 方法。论文团队给出了他们的示例代码。</p><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>工程包含的文件：</p><ul><li><p>attentions.py：关于自注意力机制的部分，定义了 transformer 的结构。</p><ul><li>Encoder 类<ul><li>定义了参数和 forward 方法</li></ul></li><li>Decoder 类<ul><li>定义了参数和 forward 方法</li></ul></li><li>MultiHeadAttention 类<ul><li>定义了参数，forward 方法，attention 方法，_matmul_with_relative_values 方法，_matmul_with_relative_keys 方法，_get_relative_embeddings 方法，_relative_position_to_absolute_position 方法，_absolute_position_to_relative_position 方法，_attention_bias_proximal 方法</li></ul></li><li>FFN（前馈神经网络） 类<ul><li>定义了参数，forward 方法，_causal_padding 方法，_same_padding 方法。</li></ul></li></ul></li><li><p>commons.py：公用的一些常用方法</p><ul><li>定义了 init_weights 方法</li><li>定义了 get_padding 方法</li><li>定义了 convert_pad_shape 方法</li><li>定义了 intersperse 方法</li><li>kl_divergence 方法</li><li>rand_gumbel 方法</li><li>rand_gumbel_like 方法</li><li>slice_segments 方法</li><li>rand_slice_segments 方法</li><li>get_timing_signal_1d 方法</li><li>add_timing_signal_1d 方法</li><li>cat_timing_signal_1d 方法</li><li>subsequent_mask 方法</li><li>fused_add_tanh_sigmoid_multiply 方法：使用 @torch.jit.script 装饰</li><li>convert_pad_shape 方法</li><li>shift_1d 方法</li><li>sequence_mask 方法</li><li>generate_path 方法</li><li>clip<em>grad_value</em> 方法</li></ul></li><li><p>data_utils.py</p><ul><li>定义了 TextAudioLoader 类<ul><li>切分训练的时候使用的音频、文本</li></ul></li><li>定义了 TextAudioCollate 类<ul><li>批量整理文本、音频</li></ul></li><li>定义了多说话者版本 TextAudioSpeakerLoader 类<ul><li>类似 TextAudioLoader 但是是多说话者版本</li></ul></li><li>定义了 TextAudioSpeakerCollate 类<ul><li>类似 TextAudioCollate，但是是多说话者版本</li></ul></li><li>定义了 DistributedBucketSampler 类<ul><li>储存桶相关</li></ul></li></ul></li><li><p>losses.py：损失函数相关</p><ul><li>feature_loss 方法<ul><li>计算特征图（fmap）之间的差异</li></ul></li><li>discriminator_loss 方法<ul><li>计算判别器（Discriminator）的损失</li></ul></li><li>generator_loss 方法<ul><li>计算生成器（Generator）的损失</li></ul></li><li>kl_loss 方法<ul><li>计算KL散度损失，用于变分自编码器(VAE)</li></ul></li></ul></li><li><p>mel_processing.py：梅尔频谱处理</p><ul><li>dynamic_range_compression_torch 方法<ul><li>动态范围压缩，乘 C、裁剪、然后取对数</li></ul></li><li>dynamic_range_decompression_torch 方法<ul><li>动态范围解压缩，和动态范围压缩互补</li></ul></li><li>spectral_normalize_torch 方法<ul><li>对幅度谱进行动态范围压缩，就是调用 dynamic_range_compression_torch 方法</li></ul></li><li>spectral_de_normalize_torch 方法<ul><li>同上，只是调用了一下 dynamic_range_decompression_torch 方法</li></ul></li><li>spectrogram_torch 方法<ul><li>作用：<ul><li>计算音频信号 y 的短时傅立叶变换（STFT）谱。</li></ul></li><li>参数：<ul><li>FFT点数 n_fft</li><li>采样率 sampling_rate</li><li>帧移 hop_size</li><li>窗长度 win_size</li><li>是否在时间轴上居中 center</li></ul></li><li>先对输入信号做反射填充，然后应用 Hann 窗函数进行窗口化处理，最后计算 STFT 并取模平方根得到幅度谱。</li></ul></li><li>spec_to_mel_torch 方法<ul><li>作用：<ul><li>将频域谱 spec 转换为 Mel 频谱。</li></ul></li><li>使用全局变量 mel_basis 存储预先计算好的梅尔滤波器组矩阵，如果矩阵不存在，则会基于给定的参数计算并转换为当前设备和数据类型。</li><li>将幅度谱与梅尔滤波器组矩阵进行矩阵乘法，然后对结果进行动态范围压缩。</li></ul></li><li>mel_spectrogram_torch 方法<ul><li>完整流程的 Mel 频谱计算函数，包含了从原始音频信号到 Mel 频谱的全部步骤。</li><li>包括了对输入信号的检查（确保其在 [-1, 1] 范围内），计算 STFT 幅度谱，转换为 Mel 频谱并进行动态范围压缩。 </li></ul></li></ul></li><li><p>models.py</p><ul><li>模型主体结构。</li><li>每一个类是模型的一个（或者一种）组件，核心是 forward 方法。</li><li>StochasticDurationPredictor 类<ul><li>随机时长预测器，论文里提到的主要创新点，使用了正态流。接收 gin_channels 参数进行调整。</li><li>forward 方法</li></ul></li><li>DurationPredictor 类<ul><li>时长预测器，简化版本的 StochasticDurationPredictor，不支持条件输入，没有正态流。</li></ul></li><li>TextEncoder 类<ul><li>继承自 torch.nn.Module，并且使用了 attentions 的 Encoder 制作成员（上面的随机时长预测器和下面几个类也用到了 torch.nn.Module，但是没有使用 attentions）</li><li>forward 方法：<ol><li>将文本输入通过嵌入层来获得初始的嵌入表示</li><li>将这些嵌入表示转换为适合自注意力机制的格式（三维张量，维度为批次大小、隐藏通道数和序列长度）</li><li>使用自注意力机制和卷积层来处理这些嵌入表示</li><li>通过投影层输出最终的编码表示</li></ol></li><li>ResidualCouplingBlock 类<ul><li>残差耦合块</li><li>其中的流变换根据 reverse 参数决定是正向还是反向，执行正向流变换的时候，输入数据会依次通过每个流变换层。每个流变换层都会更新数据，并通过残差连接将变换后的数据与原始数据相结合，这有助于避免梯度消失问题</li><li>流部分和 StochasticDurationPredictor 是一样的</li></ul></li><li>PosteriorEncoder 类<ul><li>后验分布编码器</li><li>在给定观测数据（如语音信号）的条件下，对潜在变量（如声谱特征）的分布进行建模</li><li>换言之就是，将观测到的语音信号编码为潜在空间的分布，使得模型能够捕捉到语音信号的复杂性和多样性，并在生成过程中保持这些特性</li><li>forward 方法：</li></ul><ol><li>将输入数据通过预处理卷积层来获得初始的编码表示</li><li>将这些编码表示通过扩张卷积层进行进一步的处理，扩张卷积层通过扩张率来增加感受野，捕捉更长范围内的依赖关系</li><li>通过投影卷积层输出均值和对数方差、输出可以用于后续的生成过程，如重参数化技巧，以生成新的样本。</li></ol></li><li>Generator 类<ul><li>从潜在空间生成频谱</li><li>forward 方法：</li></ul><ol><li>输入数据首先通过 conv_pre 进行处理（是一个一维的卷积核，Conv1d）</li><li>数据依次通过 ups 中的上采样层和 resblocks 中的残差块。在每一步上采样过程中，数据的分辨率逐渐增加，同时通过残差连接保持了信息的流动</li><li>通过 conv_post 生成最终的输出，这可以是语音波形或其他类型的音频特征</li></ol><ul><li>remove_weight_norm 方法：<ul><li>移除所有卷积层中的权重归一化（weight normalization）</li><li>可能是测试使用的？</li></ul></li></ul></li><li>DiscriminatorP 类<ul><li>GANs 的一部分，辨别器。</li><li>适合周期信号，P 指的是 Periodic，周期的（我猜的）</li><li>此处可以参考 HiFi-GAN 模型<ul><li>论文解读 <a href="https://yuan1615.github.io/2022/01/21/HiFi-GAN/">https://yuan1615.github.io/2022/01/21/HiFi-GAN/</a></li><li>论文翻译 <a href="https://blog.csdn.net/Blackoutdragon/article/details/131766625">https://blog.csdn.net/Blackoutdragon/article/details/131766625</a></li></ul></li><li>DiscriminatorS 类<ul><li>同上， GANs 的一部分，辨别器。</li><li>适合非周期信号（文本，图像），S 指的是 Sequential，序列的（我猜的）</li></ul></li><li>MultiPeriodDiscriminator 类<ul><li>多周期辨别器，使用了上面两种辨别器：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">discs = [DiscriminatorS(use_spectral_norm=use_spectral_norm)]<br>discs = discs + [DiscriminatorP(i, use_spectral_norm=use_spectral_norm) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> periods]<br></code></pre></td></tr></table></figure></li></ul></li><li>综合二者的能力</li></ul></li><li>SynthesizerTrn 类<ul><li>用于训练的合成器，较为复杂，使用了上面定义的一系列模块：<ul><li><strong>enc_p</strong>: PosteriorEncoder，文本编码器，用于将文本转换为嵌入表示。它使用一个自注意力编码器来处理文本输入。</li><li><strong>dec</strong>: Generator，生成器，用于从嵌入表示生成语音信号。包含一系列上采样层和残差块，用于生成高质量的语音波形。</li><li><strong>enc_q</strong>: TextEncoder，后验编码器，用于编码声谱特征。使用卷积层和扩张卷积来处理声谱数据。</li><li><strong>flow</strong>: ResidualCouplingBlock，残差耦合块，用于数据的流动和变换。它包含一系列残差耦合层，用于学习声谱数据的复杂分布。</li><li><strong>dp</strong>: StochasticDurationPredictor，持续时间预测器，用于预测语音信号的持续时间<ul><li>根据 use_sdp 参数的值，它会初始化为 StochasticDurationPredictor 或 DurationPredictor。</li></ul></li><li><strong>emb_g</strong>: 一个 nn.Embedding，说话者嵌入层，用于条件生成不同说话者的语音<ul><li>如果 n_speakers 大于0，这个层会被初始化。</li></ul></li></ul></li><li>forward 方法：<ol><li><strong>文本编码</strong>: 使用 enc_p（文本编码器）对文本输入 x 进行编码，得到文本的嵌入表示。同时，使用 x_lengths 来创建一个掩码，以便在后续步骤中忽略填充的部分。</li><li><strong>声谱编码</strong>: 使用 enc_q（后验编码器）对目标声谱特征 y 进行编码，得到声谱的嵌入表示。同时，如果提供了说话者ID sid，则使用 emb_g（说话者嵌入层）来获取说话者嵌入，并将其加入到声谱编码中。</li><li><strong>持续时间预测</strong>: 如果模型使用随机持续时间预测器（use_sdp 为 True），则调用 dp（持续时间预测器）来预测语音信号的持续时间。否则，使用 DurationPredictor 来预测（节约成本）。</li><li><strong>生成路径计算</strong>: 计算生成语音的路径。这通常涉及到计算负对数似然（negative log-likelihood）和注意力机制，以便在生成过程中对齐文本和声谱特征。</li><li><strong>生成语音波形</strong>: 使用 dec（生成器）来生成语音波形。生成器接收文本嵌入表示和声谱嵌入表示作为输入，并输出最终的语音波形。</li><li><strong>输出</strong>: forward 方法的输出包括生成的语音波形、持续时间预测损失、注意力权重、生成的声谱片段的ID、输入文本和声谱的掩码，以及原始的嵌入表示。</li></ol><ul><li>输出内容：<ul><li><strong>o</strong>: 生成的语音波形。</li><li><strong>l_length</strong>: 持续时间预测损失。</li><li><strong>attn</strong>: 注意力权重，用于显示文本和声谱特征之间的对齐情况。</li><li><strong>ids_slice</strong>: 生成的声谱片段的ID。</li><li><strong>x_mask</strong>, <strong>y_mask</strong>: 输入文本和声谱的掩码，用于在后续处理中忽略填充的部分。</li><li><strong>(z, z_p, m_p, logs_p, m_q, logs_q)</strong>: 原始的嵌入表示和相关的统计信息，这些信息可以用于进一步的分析和调试。</li></ul></li></ul></li><li>infer 方法<ul><li>训练结束之后，用于推理的方法</li></ul><ol><li><strong>文本编码</strong>: 与 forward 方法类似，infer 方法首先使用文本编码器 enc_p 对输入文本 x 进行编码，得到文本的嵌入表示。</li><li><strong>声谱编码</strong>: 如果提供了说话者ID sid，则使用说话者嵌入层 emb_g 来获取说话者嵌入，并将其加入到声谱编码中。</li><li><strong>持续时间预测</strong>: 根据模型是否使用随机持续时间预测器（use_sdp 参数），调用相应的持续时间预测器 dp 来预测语音信号的持续时间。</li><li><strong>生成语音波形</strong>: 使用生成器 dec 来生成语音波形。在推理模式下，生成器会根据文本嵌入表示和预测的持续时间生成连续的语音波形。</li><li><strong>注意力权重计算</strong>: 通过计算注意力权重，可以了解模型是如何在生成语音时关注输入文本的不同部分的。</li><li><strong>输出</strong>: infer 方法的输出通常包括生成的语音波形、注意力权重和其他可能的中间结果，如声谱特征的嵌入表示。</li></ol></li><li>voice_conversion 方法<ul><li>用于执行说话者转换</li><li>接收源说话者的语音信号和目标说话者的标识符作为输入，然后生成具有目标说话者特征的语音信号</li><li>参数：<ul><li><strong>y</strong>: 源说话者的语音信号，通常是一个三维张量，形状为 [batch_size, spec_length, spec_channels]。</li><li><strong>y_lengths</strong>: 源语音信号的长度，用于指示每个样本中的非填充声谱的长度。</li><li><strong>sid_src</strong>: 源说话者的标识符。</li><li><strong>sid_tgt</strong>: 目标说话者的标识符。、</li></ul></li><li>过程：<ul><li><strong>说话者嵌入获取</strong>: 使用 emb_g（说话者嵌入层）根据源说话者和目标说话者的标识符获取相应的说话者嵌入。这些嵌入将用于调整生成的语音，使其具有目标说话者的特征。</li><li><strong>源语音编码</strong>: 使用 enc_q（后验编码器）对源说话者的语音信号 y 进行编码，得到声谱的嵌入表示。</li><li><strong>说话者转换</strong>: 通过 flow（残差耦合块）和可能的其他变换层，将源说话者的嵌入表示转换为目标说话者的嵌入表示。这个过程可能涉及到使用说话者嵌入来调整声谱特征，以便模仿目标说话者的声音。</li><li><strong>生成目标语音</strong>: 使用 dec（生成器）根据转换后的嵌入表示生成目标说话者的语音信号。生成器会根据调整后的声谱特征生成连续的语音波形。</li><li><strong>输出</strong>: voice_conversion 方法的输出是转换后的语音信号，它应该具有目标说话者的声音特征，同时保持原始文本的内容不变。</li></ul></li><li>输出：<ul><li><strong>o_hat</strong>: 转换后的目标说话者的语音信号。</li><li><strong>y_mask</strong>: 目标语音信号的掩码，用于在后续处理中忽略填充的部分。</li><li><strong>(z, z_p, z_hat)</strong>: 原始的嵌入表示和相关的统计信息，这些信息可以用于进一步的分析和调试。</li></ul></li></ul></li></ul></li></ul></li></ul></li><li>modules.py<ul><li>LayerNorm 类<ul><li>归一化层</li></ul></li><li>ConvReluNorm 类<ul><li>attention 里的一个结构</li></ul></li><li>DDSConv 类<ul><li>带空洞卷积（Dilated Convolution）和深度可分离卷积（Depth-Separable Convolution）的模块</li></ul></li><li>WN 类<ul><li>权重归一化（Weight Normalization）</li></ul></li><li>ResBlock1 类 和 ResBlock2 类<ul><li>残差块（Residual Block），用于构建更深的网络结构</li></ul></li><li>Log 类<ul><li>对输入数据 x 取对数的操作</li><li>用于变分自编码器（VAE）中的变分下界</li></ul></li><li>Flip 类<ul><li>翻转输入/取消翻转（取决于 reverse 是 True 还是 False）</li></ul></li><li>ElementwiseAffine 类<ul><li>逐元素的仿射变换</li></ul></li><li>ResidualCouplingLayer 类<ul><li>残差耦合层</li><li>用于流模型（Flow Model）中的变分推断</li></ul></li><li>ConvFlow 类<ul><li>基于卷积的流模型</li><li>用于生成模型或者变分推断</li></ul></li><li></li></ul></li><li>preprocess.py<ul><li>作为主函数时：<ul><li>向命令行添加参数</li><li>从指定的文件列表中读取文件路径和文本</li><li>使用指定的文本清理器清理文本</li><li>将清理后的文本写入新的文件列表</li></ul></li><li>总之就是字面意思的预处理</li></ul></li><li>train.py<ul><li>main 函数<ul><li>断言检查：<ul><li>使用 assert torch.cuda.is_available() 确保当前环境可以使用CUDA，因为脚本设计为仅在GPU上运行。</li></ul></li><li>获取GPU数量：<ul><li>通过 torch.cuda.device_count() 获取系统中可用的GPU数量，并将其存储在变量 n_gpus 中。</li></ul></li><li>设置环境变量：<ul><li>设置环境变量 MASTER_ADDR 和 MASTER_PORT，这些变量用于分布式训练中的进程间通信</li><li>MASTER_ADDR 被设置为 ‘localhost’，MASTER_PORT 被设置为 ‘80000’。</li></ul></li><li>获取超参数：<ul><li>调用 utils.get_hparams() 函数获取超参数设置</li><li>超参数通常包括：<ul><li>学习率</li><li>批次大小</li><li>训练周期数</li></ul></li></ul></li><li>启动分布式训练：<ul><li>使用 mp.spawn（mp 是 torch 的 multiprocessing） 函数启动多个训练进程，调用 run 函数<ul><li>nprocs：要启动的进程数</li></ul></li></ul></li></ul></li><li>run 函数<ul><li>在 main 中被 mp.spawn 调用</li><li>函数参数：<ul><li>rank：当前进程的排名（ID），在分布式训练中用于区分不同的进程。</li><li>n_gpus：系统中可用的GPU数量。</li><li>hps：包含超参数的对象，这些超参数定义了模型的训练和数据配置。</li></ul></li><li>判断当前进程（rank）的排名是否是0（是主进程），如果是的话：<ul><li>初始化日志记录器：<ul><li>调用 utils.get_logger 方法初始化日志记录器，并记录超参数 hps 的信息。这有助于监控训练过程并记录重要信息。</li></ul></li><li>检查Git哈希：<ul><li>调用 utils.check_git_hash 方法来验证代码的一致性，确保训练过程中使用的代码版本与预期的版本相符</li><li>一般我使用的时候需要注释掉</li></ul></li><li>创建TensorBoard SummaryWriter：<ul><li>创建两个 SummaryWriter 对象，一个用于记录训练过程中的信息（writer），另一个用于记录评估过程中的信息（writer_eval）。</li></ul></li></ul></li><li>初始化分布式训练环境：<ul><li>调用 dist.init_process_group 方法初始化分布式训练环境。设置后端为 ‘nccl’，初始化方法为 ‘env://‘，世界大小（world size）为 n_gpus，当前进程的排名为 rank。</li></ul></li><li>设置随机种子：<ul><li>使用 torch.manual_seed 方法设置随机种子，以确保训练的可重复性。随机种子使用超参数中的 hps.train.seed 值。</li></ul></li><li>设置当前使用的GPU</li><li>加载训练数据：<ul><li>使用 TextAudioLoader 类加载训练数据</li><li>创建 DistributedBucketSampler 对象，用于在分布式训练中对数据进行采样</li><li>创建 DataLoader 对象，用于加载训练数据。</li></ul></li><li>判断当前进程（rank）的排名是否是0（是主进程），如果是的话：<ul><li>加载评估数据</li><li>创建评估数据的 DataLoader 对象。</li></ul></li><li>模型：<ul><li>使用 SynthesizerTrn 类构建生成器模型 net_g</li><li>使用 MultiPeriodDiscriminator 类构建鉴别器模型 net_d</li></ul></li><li>优化器：<ul><li>使用 torch.optim.AdamW 创建生成器优化器 optim_g、鉴别器优化器 optim_d</li><li>使用 DDP（Distributed Data Parallel）包装生成器和鉴别器模型，以支持分布式训练。</li></ul></li><li>加载检查点（checkpoint）：<ul><li>从检查点文件中加载生成器和鉴别器的状态<ul><li>如果加载失败，则将全局步数 global_step 和当前周期 epoch_str 设置为初始值。</li></ul></li></ul></li><li>设置学习率调度器：<ul><li>使用 torch.optim.lr_scheduler.ExponentialLR 创建学习率调度器</li><li>设置学习率衰减率。</li></ul></li><li>训练和评估循环：（for epoch in …）<ul><li>遍历超参数定义的训练周期 hps.train.epochs<ul><li>在每个周期中，执行训练和评估过程<ul><li>如果当前进程的排名为0，则调用 train_and_evaluate 函数进行训练和评估，并记录日志和TensorBoard信息</li><li>否则，只执行训练过程。</li></ul></li></ul></li><li>更新学习率调度器：<ul><li>在每个周期结束时，更新生成器和鉴别器的学习率调度器。<ul><li>即 调用 scheduler_g.step() 和 scheduler_d.step()</li></ul></li></ul></li></ul></li></ul></li><li>train_and_evaluate 函数<ul><li>函数参数：<ul><li>rank: 当前进程的排名（ID），用于分布式训练中的标识。</li><li>epoch: 当前的训练周期。</li><li>hps: 超参数设置，包含了模型训练和数据配置的所有重要参数。</li><li>nets: 一个包含生成器（net_g）和鉴别器（net_d）的列表。</li><li>optims: 一个包含生成器和鉴别器优化器的列表。</li><li>schedulers: 一个包含生成器和鉴别器学习率调度器的列表。</li><li>scaler: 梯度缩放器，用于混合精度训练中梯度的缩放。</li><li>loaders: 一个包含训练和评估数据加载器的列表。</li><li>logger: 日志记录器，用于记录训练过程中的信息。</li><li>writers: 一个包含TensorBoard的SummaryWriter对象的列表，用于记录训练和评估过程中的信息。</li></ul></li><li>函数内部：<ul><li>将nets、optims、schedulers中的生成器和鉴别器分别赋值给net_g、optim_g、scheduler_g和net_d、optim_d、scheduler_d。</li><li>如果writers不为None，则将写入器赋值给writer和writer_eval。</li><li>调用train_loader.batch_sampler.set_epoch(epoch)设置当前的训练周期，这对于某些采样器（如DistributedBucketSampler）来说是必要的，因为它们可能需要根据周期进行调整。</li><li>定义全局变量global_step，用于跟踪训练步数。</li><li>将生成器和鉴别器设置为训练模式（net_g.train()和net_d.train()）。</li><li>遍历训练数据加载器train_loader中的每个批次。<ul><li>将批次数据移动到对应的GPU上。</li><li>使用autocast上下文管理器进行混合精度训练，如果启用了混合精度训练。</li><li>调用生成器net_g生成预测值y_hat，并计算损失。</li><li>将真实音频的频谱转换为Mel频谱y_mel。</li><li>计算鉴别器的损失loss_disc，并执行反向传播和优化器步骤。</li><li>计算生成器的损失loss_gen_all，并执行反向传播和优化器步骤。</li><li>如果当前进程是主进程（rank == 0），则记录日志和TensorBoard信息。</li></ul></li><li>如果当前进程是主进程，检查是否到达了评估间隔，如果是，则调用evaluate函数进行评估，并保存检查点。</li><li>向控制台打印全局训练步数global_step。</li></ul></li></ul></li><li>evaluate 函数<ul><li>函数参数：<ul><li>hps：包含超参数的对象，这些超参数定义了模型的训练和数据配置。</li><li>generator：训练好的生成器模型，用于生成语音。</li><li>eval_loader：评估数据的加载器，它提供了评估数据集的批量数据。</li><li>writer_eval：用于评估数据的TensorBoard SummaryWriter对象，用于记录评估过程中的信息。</li></ul></li><li>设置模型为评估模式：<ul><li>调用 generator.eval() 将模型设置为评估模式。这是必要的，因为在评估模式下，模型会关闭dropout和批量归一化等只在训练时使用的层。</li></ul></li><li>禁用梯度计算：<ul><li>使用 torch.no_grad() 上下文管理器来禁用梯度计算。这有助于减少内存消耗，并加速评估过程，因为在评估时不需要计算梯度。</li></ul></li><li>遍历评估数据加载器：<ul><li>通过 for 循环遍历 eval_loader 中的每个批次的数据。</li><li>将批次数据移动到GPU上（这里假设使用的是第一个GPU，即 cuda(0)）。</li></ul></li><li>处理单个样本：<ul><li>从评估批次中提取单个样本数据（这通常是通过切片操作完成的），因为评估函数可能设计为只处理单个样本。</li><li>调用 generator.module.infer 方法（注意这里使用了 .module，这可能是因为模型被包装在 nn.DataParallel 或 nn.parallel.DistributedDataParallel 中）来生成语音。</li><li>计算生成的语音的长度。</li></ul></li><li>转换频谱为Mel频谱：<ul><li>使用 spec_to_mel_torch 函数将真实和生成的频谱图转换为Mel频谱图。Mel频谱图是一种表示音频数据的常用方式，它更接近于人类对频率的感知。</li></ul></li><li>记录评估结果：<ul><li>如果当前进程的排名为0（主进程），则使用 utils.summarize 函数记录评估结果。这包括生成的Mel频谱图、音频样本以及其他可能的统计信息。</li><li>将生成的Mel频谱图和音频样本添加到 image_dict 和 audio_dict 字典中，这些字典随后被传递给 utils.summarize 函数。</li><li>如果是训练的第一步（global_step == 0），则还包括真实样本的Mel频谱图和音频样本以供参考。</li></ul></li><li>恢复模型训练模式：<ul><li>在评估结束后，调用 generator.train() 将模型恢复到训练模式。</li></ul></li></ul></li></ul></li><li>train_ms.py<ul><li>多说话者训练，ms 意思是 multi-speaker</li><li>总之就是多了一些多说话人相关的设置，对应的类也被换成了多说话人需要的类</li><li>除此之外，还使用了 GradScaler 来进行梯度缩放</li><li>因为我是懒狗所以直接交给 chatgpt 帮我对比了</li><li>数据加载器和处理：<ul><li>第一段代码中使用了TextAudioLoader和DistributedBucketSampler来加载和处理文本和音频数据。</li><li>第二段代码中使用了TextAudioSpeakerLoader，这表明它可能在处理与说话者相关的数据，这可能是一个多说话者的TTS模型。</li></ul></li><li>模型结构：<ul><li>第一段代码中的模型定义较为简洁，没有提及说话者的数量。</li><li>第二段代码中的SynthesizerTrn模型在初始化时考虑了n_speakers参数，这意味着模型可能包含说话者嵌入或有说话者适应的功能。</li></ul></li><li>评估函数：<ul><li>第一段代码中的evaluate函数没有提供详细的实现，而第二段代码中的evaluate函数实现了对单个样本的评估，并生成了Mel频谱图和音频样本的可视化。</li><li>第二段代码中的评估还考虑了说话者（speakers参数），并且在评估时使用了generator.module.infer方法，这表明评估过程中可能使用了说话者特定的信息。</li></ul></li><li>训练循环：<ul><li>第一段代码中的train_and_evaluate函数实现了训练和评估的循环，但在代码片段中没有提供完整的实现。</li><li>第二段代码中的train_and_evaluate函数提供了完整的实现，包括前向传播、损失计算、反向传播和优化器步骤，以及日志记录和评估过程。</li></ul></li><li>梯度缩放：<ul><li>第二段代码中使用了GradScaler来进行梯度缩放，这在混合精度训练中非常有用，可以防止梯度值过大导致的数值不稳定问题。</li><li>第一段代码中没有明确提及梯度缩放。</li></ul></li><li>学习率调度器：<ul><li>两段代码都使用了指数衰减的学习率调度器，但是第二段代码中提供了更详细的实现。</li></ul></li><li>保存检查点：<ul><li>第二段代码中在每个epoch结束时保存了生成器和鉴别器的检查点，而第一段代码中没有明确提及检查点的保存。</li></ul></li><li>代码结构：<ul><li>两段代码都遵循了类似的结构，包括初始化、模型定义、训练循环和评估过程。</li><li>第二段代码提供了更多的细节，包括模型的具体参数、评估过程和训练循环中的日志记录。</li></ul></li></ul></li><li>transforms.py</li><li>utils.py</li></ul><h2 id="流模型"><a href="#流模型" class="headerlink" title="流模型"></a>流模型</h2><p>在程序里，ResidualCouplingBlock（残差耦合块）类和 StochasticDurationPredictor（随机时长预测器）就是使用了流模型。</p><p>流变换（Flow Transformation）是流模型（Flow-based Model）中的一个核心概念，它指的是一系列可逆的变换过程，用于将一个复杂的概率分布转换为一个更简单（通常是高斯）的概率分布，或者反过来，将一个简单的概率分布转换为一个复杂的目标分布。这些变换过程是可逆的，意味着可以从一个分布直接转换到另一个分布，并且可以精确计算转换过程中的雅各比行列式（Jacobian determinant），这对于概率密度函数的计算至关重要。</p><p>简而言之就是概率界的傅立叶变换，把一个复杂的、通用的概率模型（对应到傅立叶变换里就是一个复杂的函数）分解为标准的简单分布，例如高斯分布（对应傅立叶变换的正余弦函数），过程可逆，变换之后更加容易处理（因为都是基本分布/函数了）。</p><p><strong>流变换的特点：</strong></p><ul><li>可逆性: <ul><li>流变换的一个显著特点是它的双向可逆性。这意味着变换不仅可以从分布A转换到分布B，还可以从分布B转换回分布A。这种可逆性使得流模型在理论上可以精确地计算概率密度，并且可以用于生成模型，通过逆变换生成新的样本。</li></ul></li><li>精确计算: <ul><li>在传统的生成模型中，如生成对抗网络（GANs）或变分自编码器（VAEs），通常需要通过近似方法来估计概率密度。而流模型通过流变换，可以直接计算概率密度，这在理论上提供了更精确的估计。</li></ul></li><li>雅各比行列式: <ul><li>流变换过程中的雅各比行列式是关键，因为它涉及到变换的尺度和方向的变化。在流模型中，通过设计特定的变换结构（如耦合层），可以简化雅各比行列式的计算，使其在实际应用中变得可行。</li></ul></li></ul><p><strong>流变换的发展：</strong></p><ol><li>NICE:<br>最初的流变换模型NICE（Non-linear Independent Components Estimation）实现了从任意分布到高斯分布的可逆变换。</li><li>RealNVP:<br>后续的RealNVP（Real-Valued Non-Volume Preserving）模型进一步扩展了流变换的能力，实现了从任意分布到条件非高斯分布的可逆变换。</li><li>GLOW:<br>最新的GLOW（Generative Flow with Invertible 1x1 Convolutions）模型通过引入1x1卷积，实现了从任意分布到任意其他分布的可逆变换，这使得GLOW能够处理更复杂的分布，如图像数据。</li></ol><p><strong>流变换的应用：</strong><br>流变换在生成模型中的应用非常广泛，特别是在需要精确概率估计的场景中。例如，在语音合成、图像生成、药物设计等领域，流模型可以通过流变换来生成高质量的样本，并且可以精确地计算样本的概率密度。</p><p>可以参考 <a href="https://gwylab.com/note-flow_based_model.html">https://gwylab.com/note-flow_based_model.html</a> 和 <a href="https://www.bilibili.com/video/BV1E441137wE">https://www.bilibili.com/video/BV1E441137wE</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024年3月18日</title>
    <link href="/2024/03/18/2024%E5%B9%B43%E6%9C%8818%E6%97%A5/"/>
    <url>/2024/03/18/2024%E5%B9%B43%E6%9C%8818%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>今天试着完善交错战线机器人，两个目标：</p><ol><li>通过星火大模型 API ，补全空白标题</li><li>上传图片并使用</li></ol><h2 id="补全空白标题"><a href="#补全空白标题" class="headerlink" title="补全空白标题"></a>补全空白标题</h2><p>使用讯飞星火提供的官方 API 例程即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_title</span>(<span class="hljs-params">content=<span class="hljs-string">&quot;&quot;</span></span>):<br>    text.clear<br>    question = getText(<span class="hljs-string">&quot;user&quot;</span>, content)<br>    SparkApi.answer = <span class="hljs-string">&quot;&quot;</span><br>    SparkApi.main(appid, api_key, api_secret, Spark_url, domain, question)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(SparkApi.answer)<br></code></pre></td></tr></table></figure><p>content 为 “向大模型提问的内容”，在这个情况下，则为 “请你为以下内容想一个标题”；这个函数会返回一段文本，即答案，即给出的标题。</p><h2 id="上传文件-图片"><a href="#上传文件-图片" class="headerlink" title="上传文件/图片"></a>上传文件/图片</h2><p>我如果要通过 python 上传图片，一是需要注意在上传之前需要发送一个 OPTIONS 请求，二是上传后不会返回任何内容，包括图片 url。</p><p>查看了原js，使用的是 XHR（XMLHttpRequest）提交数据。</p><p>可以使用 Object.keys() 得到一个 Object 对象的键，例如，对于 变量 asd，可以使用 <code>Object.keys(asd)</code> 得到键，但注意不是通过 <code>asd.keys()</code>。</p><p>在原本的js中，构造了一个 <code>postfunc.thumbBinCache</code> 方便生成图片代码，其中第七个键是完整大小的图片代码。</p><p>对于函数 <code>postfunc.add1Attach = function (opt, time, attach,checkSum,url,isimg,thumb,utf8oname,tid,pid,aid)</code>，有以下注释：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加一个上传好的附件</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; opt  bit选项 &amp;1不复用当前上传elm</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; time  时间戳(毫秒)</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; attach 附件服务器返回的attach字符串</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; checkSum 附件服务器返回的checkSum字符串</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; url 路径 mon_\d+开头</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; isimg 是否是图片</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; thumb thumb值 bit</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; utf8oname </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; tid </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; pid </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; aid </span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>我一直在纳闷 url 参数从何而来。</p><p>url 参数被保存在 <code>y.data.url</code>，其中 y 是 <code>window.script_muti_get_var_store</code>，即 nga 的网页版页面数据。可以向控制台输入 <code>window.script_muti_get_var_store.data.url</code> 查询 url。</p><p>（但是少了个 ./，需要自己加上去）</p><p>那么，问题来了，应该如何在没有编辑页面的 python 程序中获取到 url？</p><p>根据 api 文档（二哥写的），返回的数据一种形式就是开头有个 <code>window.script_muti_get_var_store =</code>，得到的数据就这些个格式，但内容肯定是不同的。</p><p>但是发帖后获取的返回数据中，有已上传附件、已上传附件验证码（auth）。</p><h3 id="地精文档"><a href="#地精文档" class="headerlink" title="地精文档"></a>地精文档</h3><p>之前没注意到，光顾着自己尝试了。实际上二哥有详细描述应该如何上传附件。见 <a href="https://g.nga.cn/read.php?tid=6406100">https://g.nga.cn/read.php?tid=6406100</a> 的 6.1 和 6.2 节。</p><p>值得注意的是，文档是挺久之前写的，实际情况可能有变化。但也可能没变化，只是我搞错了，误以为没有返回数据。</p><p>文档中的描述是：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">使用<span class="hljs-built_in">post</span>(enctype=multipart/form-data)方法将如下数据上传至 <span class="hljs-number">6.1</span> 中提到的数据中的附件上传地址，上传成功后服务器会返回数据。<br><br>将attachments连接至发帖表单的attachments参数末尾(如有多个附件用\t分隔)<br>将attachments_check连接至发帖表单的attachments_check参数末尾 (如有多个附件用\t分隔)<br></code></pre></td></tr></table></figure><p>而发贴的时候，应当附带 <code>attachments</code> 附件、<code>attachments_check</code> 附件验证码。</p><p>我猜测 6.1 中的附件上传地址指的是一个 url，例如 <code>http://img8.nga.cn/attach.php</code> 之类的。</p><h3 id="试了一下"><a href="#试了一下" class="headerlink" title="试了一下"></a>试了一下</h3><p>fid=823，nga 的上线游戏讨论区。</p><p>我向 <code>https://ngabbs.com/post.php?fid=823&amp;__output=1</code> 发送请求，返回的数据如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br><span class="hljs-string">&quot;data&quot;</span>: &#123;<br><span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;new&quot;</span>,<br><span class="hljs-string">&quot;__T&quot;</span>: &#123;<br><span class="hljs-string">&quot;topic_misc_var&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;fid&quot;</span>: <span class="hljs-number">823</span>,<br><span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;【字符串】&quot;</span>,<br><span class="hljs-string">&quot;if_moderator&quot;</span>: <span class="hljs-number">0</span>,<br><span class="hljs-string">&quot;cost_info&quot;</span>: <span class="hljs-string">&quot;匿名主题50银币 匿名回复1银币 贴条回复1银币 投票10银币 版主免费 付费会员免费(每月限量)&quot;</span>,<br><span class="hljs-string">&quot;tid&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-string">&quot;__CU&quot;</span>: &#123;<br><span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-number">65112288</span>,<br><span class="hljs-string">&quot;group_bit&quot;</span>: <span class="hljs-number">98528</span>,<br><span class="hljs-string">&quot;admincheck&quot;</span>: <span class="hljs-number">0</span>,<br><span class="hljs-string">&quot;rvrc&quot;</span>: <span class="hljs-number">10</span><br>&#125;,<br><span class="hljs-string">&quot;__GLOBAL&quot;</span>: &#123;<br><span class="hljs-string">&quot;_ATTACH_BASE_VIEW&quot;</span>: <span class="hljs-string">&quot;img.nga.178.com/attachments&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;__F&quot;</span>: &#123;<br><span class="hljs-string">&quot;bit_data&quot;</span>: <span class="hljs-number">167772160</span>,<br><span class="hljs-string">&quot;fid&quot;</span>: <span class="hljs-number">823</span>,<br><span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;上线游戏讨论区&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;attach_url&quot;</span>: <span class="hljs-string">&quot;https://img8.nga.cn/attach.php&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;encode&quot;</span>: <span class="hljs-string">&quot;gbk&quot;</span>,<br><span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-number">1710754883</span>,<br><span class="hljs-string">&quot;debug&quot;</span>: <span class="hljs-literal">null</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>得到的结果中， <code>&quot;attach_url&quot;: &quot;https://img8.nga.cn/attach.php&quot;</code> 意思就是我要向这边上传文件，<code>&quot;auth&quot;: &quot;【字符串】&quot;,</code> 就是我需要附带的附件验证码，否则会被视为违规请求。需要的就是这个。</p><p>注意这是需要登录的（废话）。发送请求和其他基本一样，带上 Cookie 即可。</p><h3 id="又试了一下"><a href="#又试了一下" class="headerlink" title="又试了一下"></a>又试了一下</h3><p>在网页段上传文件时，会发送这么一个 POST 请求：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">window.script_muti_get_var_store = <span class="hljs-punctuation">&#123;</span><br>data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>attachments<span class="hljs-punctuation">:</span> &#x27;aid~mvQ2t<span class="hljs-number">-64</span>jz~ext~webp~url_utf8_org_name~RJ01078257%<span class="hljs-number">5</span>fimg%<span class="hljs-number">5</span>fmain%<span class="hljs-number">2</span>ewebp~path~mon_202403/<span class="hljs-number">18</span>~url_dscp~~size~<span class="hljs-number">28538</span>~name~mvQ2t<span class="hljs-number">-64</span>jzKsT1kSfk-bo.webp~tmp_file~./temp_attachments/mvQ2t<span class="hljs-number">-64</span>jz.webp.tmp~tmp_shoot~./temp_attachments/mvQ2t<span class="hljs-number">-64</span>jz.webp.tmp~tmp_shoot_size~<span class="hljs-number">28538</span>~tmp_shoot_ext~webp~isimg~<span class="hljs-number">1</span>~w~<span class="hljs-number">560</span>~h~<span class="hljs-number">420</span>~thumb~<span class="hljs-number">56</span>&#x27;<span class="hljs-punctuation">,</span><br>attachments_check<span class="hljs-punctuation">:</span> &#x27;e7f78df7942303341cfc34c0947d092a&#x27;<span class="hljs-punctuation">,</span><br>url<span class="hljs-punctuation">:</span> &#x27;mon_202403/<span class="hljs-number">18</span>/mvQ2t<span class="hljs-number">-64</span>jzKsT1kSfk-bo.webp&#x27;<span class="hljs-punctuation">,</span><br>isImg<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">1</span>&#x27;<span class="hljs-punctuation">,</span><br>thumb<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">56</span>&#x27;<br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>很显然，这是 javascript 生成的表单数据。也就是说，正常流程中发送数据，不会向服务器请求得到附件的 url，反之，是本地生成 url，再发送给服务器。</p><p>那么问题来了，本地是如何生成附件 url 的？</p><p>按照我的理解，应该是上传文件-图片服务器响应-返回数据中提取对应 url，但我并没有看到相应的响应。</p><h3 id="总之就是又试了一次"><a href="#总之就是又试了一次" class="headerlink" title="总之就是又试了一次"></a>总之就是又试了一次</h3><p>使用 postman 制造一个请求，成功上传了，并且返回了有效数据：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">window.script_muti_get_var_store = <span class="hljs-punctuation">&#123;</span><br>data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>attachments<span class="hljs-punctuation">:</span> &#x27;aid~mvQ2t<span class="hljs-number">-3</span>za5~ext~jpg~url_utf8_org_name~image.png~path~mon_202403/<span class="hljs-number">18</span>~url_dscp~~size~<span class="hljs-number">124647</span>~name~mvQ2t<span class="hljs-number">-3</span>za5ZcT3cSlc-w0.jpg~tmp_file~./temp_attachments/mvQ2t<span class="hljs-number">-3</span>za5.jpg.tmp~w~<span class="hljs-number">768</span>~h~<span class="hljs-number">1152</span>~tmp_shoot~./temp_attachments/mvQ2t<span class="hljs-number">-3</span>za5.jpg.tmp~tmp_shoot_size~<span class="hljs-number">124647</span>~tmp_shoot_ext~jpg~isimg~<span class="hljs-number">1</span>~thumb~<span class="hljs-number">120</span>&#x27;<span class="hljs-punctuation">,</span><br>attachments_check<span class="hljs-punctuation">:</span> &#x27;c745093860ce606f3fe12c0c3b66e638&#x27;<span class="hljs-punctuation">,</span><br>url<span class="hljs-punctuation">:</span> &#x27;mon_202403/<span class="hljs-number">18</span>/mvQ2t<span class="hljs-number">-3</span>za5ZcT3cSlc-w0.jpg&#x27;<span class="hljs-punctuation">,</span><br>isImg<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">1</span>&#x27;<span class="hljs-punctuation">,</span><br>thumb<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">120</span>&#x27;<br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>是的，正是之前那些；我理解有误，但无误；这些数据不是本地提交的，是远端发来的。</p><h3 id="破案了"><a href="#破案了" class="headerlink" title="破案了"></a>破案了</h3><p>在最终提交 post 的时候，需要在 attachments 添加对应的 attachments，而不是 attachments_check，或者 url</p><p>这是单张图片提交的情况：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">action</span>: reply<br><span class="hljs-attribute">fid</span>: <span class="hljs-number">275</span><br><span class="hljs-attribute">tid</span>: <span class="hljs-number">38719308</span><br><span class="hljs-attribute">post_content</span>: <span class="hljs-meta"></span><br><span class="hljs-meta">[img]./mon_202403/18/7nQ2t-de3sZlT3cSlc-w0.jpg[/img]</span><br><span class="hljs-attribute">attachments</span>: aid~<span class="hljs-number">7</span>nQ2t-de3s~ext~jpg~url_utf8_org_name~<span class="hljs-number">00737</span>%<span class="hljs-number">2</span>d2622116886%<span class="hljs-number">2</span>dfeaturelessMix%<span class="hljs-number">5</span>fv30202312%<span class="hljs-number">2</span>epng~path~mon_202403/<span class="hljs-number">18</span>~url_dscp~~size~<span class="hljs-number">218093</span>~name~<span class="hljs-number">7</span>nQ2t-de3sZlT3cSlc-w0.jpg~tmp_file~./temp_attachments/<span class="hljs-number">7</span>nQ2t-de3s.jpg.tmp~w~<span class="hljs-number">768</span>~h~<span class="hljs-number">1152</span>~tmp_shoot~./temp_attachments/<span class="hljs-number">7</span>nQ2t-de3s.jpg.tmp~tmp_shoot_size~<span class="hljs-number">124647</span>~tmp_shoot_ext~jpg~isimg~<span class="hljs-number">1</span>~thumb~<span class="hljs-number">120</span><br><span class="hljs-attribute">attachments_check</span>: fd9a4034fe53664a801d79a2dbd9f5c4<br><span class="hljs-attribute">nojump</span>: <span class="hljs-number">1</span><br><span class="hljs-attribute">lite</span>: htmljs<br><span class="hljs-attribute">step</span>: <span class="hljs-number">2</span><br><br></code></pre></td></tr></table></figure><br>这是同时提交两张图片的情况：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">action</span>: reply<br><span class="hljs-attribute">fid</span>: <span class="hljs-number">275</span><br><span class="hljs-attribute">tid</span>: <span class="hljs-number">38719308</span><br><span class="hljs-attribute">post_content</span>: <span class="hljs-meta"></span><br><span class="hljs-meta">[img]./mon_202403/18/7nQ2t-529pZlT3cSlc-w0.jpg[/img]</span><span class="hljs-meta"></span><br><span class="hljs-meta">[img]./mon_202403/18/7nQ2t-7v3oZlT3cSlc-w0.jpg[/img]</span><br><span class="hljs-attribute">attachments</span>: aid~<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">529</span>p~ext~jpg~url_utf8_org_name~<span class="hljs-number">00737</span>%<span class="hljs-number">2</span>d2622116886%<span class="hljs-number">2</span>dfeaturelessMix%<span class="hljs-number">5</span>fv30202312%<span class="hljs-number">2</span>epng~path~mon_202403/<span class="hljs-number">18</span>~url_dscp~~size~<span class="hljs-number">218093</span>~name~<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">529</span>pZlT3cSlc-w0.jpg~tmp_file~./temp_attachments/<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">529</span>p.jpg.tmp~w~<span class="hljs-number">768</span>~h~<span class="hljs-number">1152</span>~tmp_shoot~./temp_attachments/<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">529</span>p.jpg.tmp~tmp_shoot_size~<span class="hljs-number">124647</span>~tmp_shoot_ext~jpg~isimg~<span class="hljs-number">1</span>~thumb~<span class="hljs-number">120</span>aid~<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">7</span>v3o~ext~jpg~url_utf8_org_name~<span class="hljs-number">00737</span>%<span class="hljs-number">2</span>d2622116886%<span class="hljs-number">2</span>dfeaturelessMix%<span class="hljs-number">5</span>fv30202312%<span class="hljs-number">2</span>epng~path~mon_202403/<span class="hljs-number">18</span>~url_dscp~~size~<span class="hljs-number">218093</span>~name~<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">7</span>v3oZlT3cSlc-w0.jpg~tmp_file~./temp_attachments/<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">7</span>v3o.jpg.tmp~w~<span class="hljs-number">768</span>~h~<span class="hljs-number">1152</span>~tmp_shoot~./temp_attachments/<span class="hljs-number">7</span>nQ2t-<span class="hljs-number">7</span>v3o.jpg.tmp~tmp_shoot_size~<span class="hljs-number">124647</span>~tmp_shoot_ext~jpg~isimg~<span class="hljs-number">1</span>~thumb~<span class="hljs-number">120</span><br><span class="hljs-attribute">attachments_check</span>: <span class="hljs-number">11</span>e98d076d3a6793a4128a1ac62baa51c593cf08e0b0e1765b727342fcf3f7de<br><span class="hljs-attribute">nojump</span>: <span class="hljs-number">1</span><br><span class="hljs-attribute">lite</span>: htmljs<br><span class="hljs-attribute">step</span>: <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>可以看到 图片的 attachments 之间并没有使用分号啊逗号啊什么的隔开，只是换行和空格。</p><p><strong>2024-03-19 更正</strong>：应该是使用 \t 进行分割，而不是使用回车或者空格，这在文档里面写出来了。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>完成了，不复杂的一套流程。</p><p>整体来说：</p><ol><li>调用 data_dict_get() 函数，从 api 获取 bilibili 的动态信息，筛选没有转发过的。在 github action 可以表现为每五分钟检测上一个五分钟内的新动态（由于github action每个月份额有限，改成半小时）</li><li>从调到的字典数据中获取 data_list，即存放动态内容数据的列表</li><li>考虑到半小时内可能会有多条动态，而 nga 会有 10 秒发帖时间间隔，使用一个循环依次发送帖子（绝大多数情况下只有一个）</li><li>对于每一个的动态，根据时间戳判断是否是已经发送过；也可以将文件保存到本地，对比新旧文件的差别，判断哪些动态没有被发送过</li><li>调用 generate_post(data)，其中 data 是单条动态的数据。</li><li>根据 api 回传的信息结构，分析出网页直观看到的内容、tag、图片、视频，并转化为 nga 对应的 bbscode。<ol><li>标题使用讯飞星火的 api 进行生成（因为原动态总是不写标题）</li><li>图片使用 upload_img() 上传，这个函数接受的参数是一个列表，里面记录每张图的网址，因为一条动态可以有很多图片。使用 upload_one_img() 上传单个图片，使用 post_img() 上传图片，回传生成的图片 url、attachments、attachments_check</li><li>视频使用 flash=video 标签，不过不同客户端有的可能看不到。</li><li>一大问题是，有的动态是专栏文章的缩略，只会有一小段内容，然后是 “展开”，对应一个全新的页面。这种情况下的转发我还没弄明白应该怎么做。</li></ol></li><li>结束之后，根据发送的帖子数量输出对应的内容。</li></ol><p>二哥的代码、文档其实写得很清晰，井井有条。拜他所赐，我这个半吊子也能大致理解上传图片所需要的东西。遇见过的几个问题全是可以通过看文档快速解决的。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2024年2月26日</title>
    <link href="/2024/02/26/2024%E5%B9%B42%E6%9C%8826%E6%97%A5/"/>
    <url>/2024/02/26/2024%E5%B9%B42%E6%9C%8826%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>又开学了。时间真快。</p><p>需要开始准备考研的基础复习了：数学，英语，专业课；四门课里面只有政治可以晚一点开始。</p><hr><h3 id="实习"><a href="#实习" class="headerlink" title="实习"></a>实习</h3><p>我认为我需要、且必需实习经历。</p><p>学校安排的那个实验课一样的实习不算。</p><p>一来是需要是成都本地：实习需要三个月以上，我希望能协调时间，不耽误学业。</p><p>二是它得要我。最现实的问题。这就涉及到我的专业水平、厂商要求门槛、以及是否对口。</p><p>投递简历的话，大厂或许成功概率比较低，小厂也可以考虑。</p><p>大厂目前正在考虑：</p><ul><li><a href="https://jobs.bytedance.com/campus/position?keywords=&amp;category=&amp;location=CT_22&amp;project=&amp;type=3&amp;job_hot_flag=&amp;current=1&amp;limit=10&amp;functionCategory=&amp;tag=">字节跳动</a>：成都有不少岗位，正在考虑。</li><li><a href="https://talent.alibaba.com/?lang=zh">阿里巴巴集团</a>：集中于北京、杭州，成都的极少（例如，钉钉只有一个“线上服务运营”岗位在成都）。<a href="https://talent.taotian.com/campus/position-list?campusType=talentPlan&amp;lang=zh">淘宝招聘链接</a></li><li>腾讯：在成都有，但是希望渺茫。按照我这个水平来说的话。</li><li><a href="https://campus.jd.com/home#/jobs?to=internship&amp;type=internship">京东</a>：按照 <a href="https://www.zhihu.com/question/640513578">https://www.zhihu.com/question/640513578</a> 的回答，京东也是一个选项。不过，文中的专业方向虽然是电子信息，但本人是大数据方向，学习了java，数据库等等知识。</li><li>vivo：发了招聘通知，但是在成都本地没有岗位，且是计算机/互联网方向，不考虑。</li><li>御坂网络：之前发布过招聘通知，计算机后端方向，一是不对口二是已经过期，不考虑。</li></ul><hr><h3 id="招聘相关"><a href="#招聘相关" class="headerlink" title="招聘相关"></a>招聘相关</h3><p>举个例子，十四所的全部都是要求硕士及以上，来校招也是招本科生读研、招研究生和博士生工作。</p><p>学历低的本科生社招很难办，如果实在想要本科就业，只能通过校招进入企业。（秋招，春招两个批次，挨不上那就做好失去应届生资格的准备吧）</p><p>调剂研究所同样很困难：按照研途考研的说法，他们统计的调剂成功率只有10%上下，经过他们安排、策划调剂成功的也堪堪30%上下，堪比考研上岸比例。</p><hr><h3 id="电子信息工程就业相关"><a href="#电子信息工程就业相关" class="headerlink" title="电子信息工程就业相关"></a>电子信息工程就业相关</h3><hr>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>转发机器人思路</title>
    <link href="/2024/01/17/%E4%BA%A4%E9%94%99%E6%88%98%E7%BA%BF%E7%9B%B8%E5%85%B3/"/>
    <url>/2024/01/17/%E4%BA%A4%E9%94%99%E6%88%98%E7%BA%BF%E7%9B%B8%E5%85%B3/</url>
    
    <content type="html"><![CDATA[<h2 id="定时发饼"><a href="#定时发饼" class="headerlink" title="定时发饼"></a>定时发饼</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>继承之前方舟饼搬运思路，使用<code>github</code>的<code>workflow</code>实现免费的定时执行<code>python</code>程序；程序功能如下：</p><ul><li>通过api获取官方动态，原始形式为json</li><li>进行筛选：<ul><li>不需要已经搬运过的动态</li><li>不需要动态抽奖动态</li></ul></li><li>论坛帖子发布：<ul><li>设置action为new</li><li>设置对应fid（上线游戏讨论区）、stid（交错战线板块）。</li></ul></li><li>更新 “ 已发布 ” 动态列表</li></ul><h3 id="在github的action部署"><a href="#在github的action部署" class="headerlink" title="在github的action部署"></a>在github的action部署</h3><p>注意requests库并不是python自带的、urllib和json是自带的；如果在requirements中写上了已经自带的库，那么会出现错误</p><p>注意隐私（Cookie）的保护</p><p>注意定时执行是按照UTC（国际标准时间）来的，换算成北京时间需要增加8小时</p><h3 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h3><p>在此之前，“ 已发布 ” 动态列表是直接存储原始json文件。如果改为 “ 最后动态时间 ”，则可以大幅减少所需操作量。但是，仍然需要对仓库具有访问、修改的权限。</p><p>api获取的时间为时间戳，即形如1422979200000形式的int数据，可以较为方便的存储、对比。</p><p>当然，也可以使用目前时间戳和获取到的时间戳进行对比，判断是否是“上一次获取”之后的新动态。这样可以规避push操作。</p><p>api中获取的时间戳为pub_ts，精确到秒。在modules底下的module_author底下的avatar底下。</p><h3 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h3><p>“ 已发布 ” 动态列表的更新：</p><ul><li>是使用了github action，而不是在本地或服务器上运行，因此要想更改文件（存有json或者时间戳），需要有访问并更改本仓库内容的权限。</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>nginx反代服务器的部署</title>
    <link href="/2023/10/18/nginx%E5%8F%8D%E4%BB%A3%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/10/18/nginx%E5%8F%8D%E4%BB%A3%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<p>django 的 runserver 仅仅是用于测试，正式部署还是需要正经的服务器软件，例如 apache，nginx。如果不正式部署，服务可能会不稳定，且无法通过 80、443 等端口通信，而且处理并发问题和异常处理也可能会出问题。另外，静态文件也是需要交给服务器软件掌管，django 并没有提供可靠的相应的组件。总之就是，专业的事情，还是要交给专业的软件完成。</p><h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><p>我选择的是 nginx，配合 uwsgi 作为中转，正式部署我 django 的程序。</p><p>三者形成一个链条结构，django 的信息被 uwsgi 接受，通过特定端口转发；通过这个特定端口，nginx 会接受 uwsgi 的信息，配合静态文件进行渲染网页的等操作，并向 80 或 443 传递最终的响应。</p><h2 id="django-的配置"><a href="#django-的配置" class="headerlink" title="django 的配置"></a>django 的配置</h2><p>和我之前所述项目一样，django 起到一个简化前后端编写的作用，实际 python 代码量并不多，但能起到大量 php 代码才能起到的作用。</p><p>首先就是收集静态文件， django collectstatic。这条指令会将所有需要的静态文件收集到一个文件夹下，即 settings.py 文件中，的 STATIC_ROOT 变量。注意，这里只能用 STATIC_ROOT 而不是 STATICFILE_DIRS 变量，当然如果手动收集，那其实无所谓。</p><h2 id="uwsgi-的配置"><a href="#uwsgi-的配置" class="headerlink" title="uwsgi 的配置"></a>uwsgi 的配置</h2><p>创建一个简单的 ini 配置文件，配置中转端口、并发数。</p><h2 id="nginx-的配置"><a href="#nginx-的配置" class="headerlink" title="nginx 的配置"></a>nginx 的配置</h2><p>很重要的一点是，默认的配置文件由两部分，一部分是外层，在 /etc/nginx/ 下，是 nginx.conf；另一部分是内层，在 /etc/nginx/sites_enabled/ 下。</p><p>外层中，可以设置 nginx 用户，如果权限不够，在查找静态文件的时候会报 403 错误，这个问题着实困扰了我很久很久！！</p><p>内层就是进行一些琐碎的配置，但不多，也就一百行以内。比如说端口，静态文件位置，比如说 ssl 会用到的证书存放位置，这些。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>很简单的一个小项目，但是被我死磕了一周，捏麻的。</p><p>话说我个硬件人怎么会跑来搞服务器部署？？？</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>语音测评网站项目总结</title>
    <link href="/2023/09/20/%E8%AF%AD%E9%9F%B3%E6%B5%8B%E8%AF%84%E7%BD%91%E7%AB%99%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
    <url>/2023/09/20/%E8%AF%AD%E9%9F%B3%E6%B5%8B%E8%AF%84%E7%BD%91%E7%AB%99%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>整体使用 django，配合 mysql 搭建的数据库、单独运行的测评打分模型，放在同一台服务器上跑。</p><h1 id="django-前后端"><a href="#django-前后端" class="headerlink" title="django 前后端"></a>django 前后端</h1><p>django 有 app 的概念，一个 app 里不同文件需要配置。主要是 admin, urls, models, views。而项目的文件在 app 之间共享，需要配置的工程文件有 settings, urls。</p><p>另外，还有 statics 静态文件，templates 网页模板等。</p><h2 id="setting-的配置"><a href="#setting-的配置" class="headerlink" title="setting 的配置"></a>setting 的配置</h2><p>我使用了 ssl 来使用 https，否则会因为浏览器安全设置，无法上传音频。</p><p>要想使用 https，需要购买 ssl 证书，并和域名绑定，可以跟随阿里云的教程一步一步来。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># SECURITY安全设置 - 支持http时建议开启</span><br><span class="hljs-attr">SECURE_PROXY_SSL_HEADER</span> = (<span class="hljs-string">&quot;HTTP_X_FORWARDED_PROTO&quot;</span>, <span class="hljs-string">&quot;https&quot;</span>)<br><span class="hljs-attr">SECURE_SSL_REDIRECT</span> = <span class="hljs-literal">True</span> <span class="hljs-comment"># 将所有非SSL请求永久重定向到SSL</span><br><span class="hljs-attr">SESSION_COOKIE_SECURE</span> = <span class="hljs-literal">True</span> <span class="hljs-comment"># 仅通过https传输cookie</span><br><span class="hljs-attr">CSRF_COOKIE_SECURE</span> = <span class="hljs-literal">True</span> <span class="hljs-comment"># 仅通过https传输cookie</span><br><span class="hljs-attr">SECURE_HSTS_INCLUDE_SUBDOMAINS</span> = <span class="hljs-literal">True</span> <span class="hljs-comment"># 严格要求使用https协议传输</span><br><span class="hljs-attr">SECURE_HSTS_PRELOAD</span> = <span class="hljs-literal">True</span> <span class="hljs-comment"># HSTS为</span><br><span class="hljs-attr">SECURE_HSTS_SECONDS</span> = <span class="hljs-number">60</span><br><span class="hljs-attr">SECURE_CONTENT_TYPE_NOSNIFF</span> = <span class="hljs-literal">True</span> <span class="hljs-comment"># 防止浏览器猜测资产的内容类型</span><br></code></pre></td></tr></table></figure><p>我使用了 django 提供的登录管理（因为我懒的一匹不想管那些细节）。</p><p>要想使用，需要在 templates 中给出对应模板（我后面会细说）。AUTHENTICATION_BACKENDS 是设置需要使用的验证后端。</p><p>AUTH_USER_MODEL 是用于存储学生身份信息的数据库，和models中的类对应。</p><p>AUTH_PASSWORD_VALIDATORS 用于验证修改密码的时候，密码的强度，如果太弱了就会被要求重新输入。</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">LOGIN_REDIRECT_URL = &#x27;/profile/&#x27; <span class="hljs-comment"># 给出登录成功之后的跳转目标</span><br>LOGIN_URL = &#x27;&#x27; <span class="hljs-comment"># 如果不设置这个，登录时会跳转到accounts/login/?next=/去,操</span><br><br><br>AUTHENTICATION_BACKENDS =[<br>    &#x27;rest_framework.authentication.TokenAuthentication&#x27;,<br>    &#x27;django.contrib.auth.backends.AllowAllUsersModelBackend&#x27;,<br>]<br><br>REST_FRAMEWORK = &#123;<br>    &#x27;<span class="hljs-attribute">DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [<br>        &#x27;rest_framework<span class="hljs-variable">.authentication</span><span class="hljs-variable">.BasicAuthentication</span>&#x27;,<br>        &#x27;rest_framework<span class="hljs-variable">.authentication</span><span class="hljs-variable">.SessionAuthentication</span>&#x27;,<br>        &#x27;rest_framework<span class="hljs-variable">.authentication</span><span class="hljs-variable">.TokenAuthentication</span>&#x27;,<br>        &#x27;rest_framework_simplejwt<span class="hljs-variable">.authentication</span><span class="hljs-variable">.JWTAuthentication</span>&#x27;,<br><br>    ],<br>    &#x27;DEFAULT_PAGINATION_CLASS&#x27;: &#x27;rest_framework<span class="hljs-variable">.pagination</span><span class="hljs-variable">.PageNumberPagination</span>&#x27;,<br>    &#x27;PAGE_SIZE&#x27;: 2<br><br>&#125;<br><br><br>AUTH_USER_MODEL = &#x27;project_app<span class="hljs-variable">.stu_info</span>&#x27;<br><br>AUTH_PASSWORD_VALIDATORS = [<br>    &#123;<br>        &quot;NAME&quot;: &quot;django<span class="hljs-variable">.contrib</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.password_validation</span><span class="hljs-variable">.UserAttributeSimilarityValidator</span>&quot;,<br>    &#125;,<br>    &#123;&quot;NAME&quot;: &quot;django<span class="hljs-variable">.contrib</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.password_validation</span><span class="hljs-variable">.MinimumLengthValidator</span>&quot;, &#125;,<br>    &#123;&quot;NAME&quot;: &quot;django<span class="hljs-variable">.contrib</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.password_validation</span><span class="hljs-variable">.CommonPasswordValidator</span>&quot;, &#125;,<br>    &#123;&quot;NAME&quot;: &quot;django<span class="hljs-variable">.contrib</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.password_validation</span><span class="hljs-variable">.NumericPasswordValidator</span>&quot;, &#125;,<br>]<br></code></pre></td></tr></table></figure><p>DEBUG 模式的开关，DEBUG 模式下，很多地方与正式环境不同，例如最让我头痛的静态文件。DEBUG模式下，程序会自己寻找静态文件自己用，但是正式环境不会。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># SECURITY WARNING: don&#x27;t run with debug turned on in production!</span><br><span class="hljs-attr">DEBUG</span> = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure></p><p>允许从哪一个host访问。例如，如果域名是 114514.com，那么需要在这里设置 ALLOWED_HOSTS = [‘114514.com’]<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">ALLOWED_HOSTS</span> = [ ]<br></code></pre></td></tr></table></figure></p><p>INSTALLED_APPS 配置已安装的 app，包括你写的，也包括django给出、需要使用的。<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs clean"># Application <span class="hljs-keyword">definition</span><br><br>INSTALLED_APPS = [<br>    <span class="hljs-string">&quot;project_app&quot;</span>,<br>    # <span class="hljs-string">&#x27;project_app.ProjectNLPAppConfig&#x27;</span>,<br>    <span class="hljs-string">&quot;django.contrib.admin&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.auth&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.contenttypes&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.sessions&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.messages&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.staticfiles&quot;</span>,  # 用于管理静态文件<br>    <span class="hljs-string">&quot;django.contrib.sites&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.redirects&quot;</span>,<br>    <span class="hljs-string">&quot;sslserver&quot;</span>,<br>    <span class="hljs-string">&#x27;rest_framework&#x27;</span>,<br>]<br></code></pre></td></tr></table></figure></p><p>如果不设置 SITE_ID，可能会产生 502 错误。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">SITE_ID</span> = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p><p>所谓中间件，中间件是 Django 请求/响应处理的钩子框架。它是一个轻量级的、低级的“插件”系统，用于全局改变 Django 的输入或输出。</p><p>每个中间件组件负责做一些特定的功能。例如，Django 包含一个中间件组件 AuthenticationMiddleware，它使用会话将用户与请求关联起来。</p><p>他的文档解释了中间件是如何工作的，如何激活中间件，以及如何编写自己的中间件。Django 具有一些内置的中间件，你可以直接使用。它们被记录在 built-in middleware reference 中。</p><p>————来自 django 官方文档。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">MIDDLEWARE</span> = [<br>    <span class="hljs-string">&quot;django.middleware.security.SecurityMiddleware&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.sessions.middleware.SessionMiddleware&quot;</span>,<br>    <span class="hljs-string">&quot;django.middleware.common.CommonMiddleware&quot;</span>,<br>    <span class="hljs-string">&quot;django.middleware.csrf.CsrfViewMiddleware&quot;</span>,<br>    <span class="hljs-comment"># &quot;django.middleware.csrf.CsrfResponseMiddleware&quot;,</span><br>    <span class="hljs-string">&quot;django.contrib.auth.middleware.AuthenticationMiddleware&quot;</span>,<br>    <span class="hljs-string">&quot;django.contrib.messages.middleware.MessageMiddleware&quot;</span>,<br>    <span class="hljs-string">&quot;django.middleware.clickjacking.XFrameOptionsMiddleware&quot;</span>,<br>]<br></code></pre></td></tr></table></figure></p><p>字面含义，是否每次请求都更新一次session，设置session使用的引擎。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">SESSION_SAVE_EVERY_REQUEST</span> = <span class="hljs-literal">True</span><br><br><span class="hljs-attr">SESSION_ENGINE</span> = <span class="hljs-string">&#x27;django.contrib.sessions.backends.signed_cookies&#x27;</span> <span class="hljs-comment"># 引擎,加密</span><br></code></pre></td></tr></table></figure></p><p>对网页模板的一些配置，会自动生成。<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs clean"># 模板<br>TEMPLATES = [<br>    &#123;<br>        <span class="hljs-string">&quot;BACKEND&quot;</span>: <span class="hljs-string">&quot;django.template.backends.django.DjangoTemplates&quot;</span>,<br>        <span class="hljs-string">&quot;DIRS&quot;</span>: [<br>            os.path.join(BASE_DIR, <span class="hljs-string">&#x27;templates&#x27;</span>),<br>                 ],<br>        <span class="hljs-string">&quot;APP_DIRS&quot;</span>: <span class="hljs-literal">True</span>,<br>        <span class="hljs-string">&quot;OPTIONS&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;context_processors&quot;</span>: [<br>                <span class="hljs-string">&quot;django.template.context_processors.debug&quot;</span>,<br>                <span class="hljs-string">&quot;django.template.context_processors.request&quot;</span>,<br>                <span class="hljs-string">&quot;django.contrib.auth.context_processors.auth&quot;</span>,<br>                <span class="hljs-string">&quot;django.contrib.messages.context_processors.messages&quot;</span>,<br>                <span class="hljs-string">&quot;django.template.context_processors.static&quot;</span>,<br>            ],<br>            # <span class="hljs-string">&quot;builtins&quot;</span>:[<span class="hljs-string">&quot;django.templatetags.static&quot;</span>],# 让模板不需要手动添加static<br>        &#125;,<br>    &#125;,<br>]<br></code></pre></td></tr></table></figure><br>数据库的配置，设置种类帐号密码ip端口。<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs 1c">DATABASES = &#123;<br>    &#x27;default&#x27;: &#123;<br>        &#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;,<br>        &#x27;NAME&#x27;: &#x27;exam&#x27;,<br>        &#x27;USER&#x27;: &#x27;root&#x27;,<br>        &#x27;PASSWORD&#x27;: &#x27;<span class="hljs-number">123123</span>&#x27;,<br>        &#x27;HOST&#x27;: &#x27;127.0.0.1&#x27;,<br>        &#x27;PORT&#x27;: <span class="hljs-number">3306</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>语言和时区，注意时区很重要，默认并不是使用电脑的时区，而是使用芝加哥时区；这个配置甚至没有在 settings 里默认生成。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">LANGUAGE_CODE</span> = <span class="hljs-string">&quot;en-us&quot;</span><br><br><span class="hljs-comment"># TIME_ZONE = &quot;UTC&quot;</span><br><span class="hljs-attr">USE_TZ</span> = <span class="hljs-literal">False</span><br><span class="hljs-attr">TIME_ZONE</span> = <span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span><br><br><span class="hljs-attr">USE_I18N</span> = <span class="hljs-literal">True</span><br><span class="hljs-comment"># 多語言</span><br><br></code></pre></td></tr></table></figure><br>静态文件相关的一些设置，指引 django 应该去哪里寻找静态文件。</p><p>总之就是我到现在还没摸透，能跑就行，捏马的。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">STATIC_URL</span> = <span class="hljs-string">&quot;/static/&quot;</span>  <span class="hljs-comment"># 不需要拼接前面的路径,这边的事相对路径</span><br><br><span class="hljs-attr">STATIC_ROOT</span> = os.path.join(BASE_DIR, <span class="hljs-string">&#x27;static&#x27;</span>)<br><br><span class="hljs-attr">STATICFILES_FINDERS</span> = [<span class="hljs-string">&#x27;django.contrib.staticfiles.finders.FileSystemFinder&#x27;</span>,<br>                       <span class="hljs-string">&#x27;django.contrib.staticfiles.finders.AppDirectoriesFinder&#x27;</span>,<br>                       ]<br></code></pre></td></tr></table></figure></p><h2 id="urls-的设置"><a href="#urls-的设置" class="headerlink" title="urls 的设置"></a>urls 的设置</h2><p>urls 其实可以有多个，工程一个，每个app一个。</p><p>urls.py 中，重点设置的只有 urlpatterns 这个列表：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">urlpatterns = [<br>    path(&quot;admin/&quot;, <span class="hljs-keyword">admin</span>.site.urls),<br>    path(&quot;favicon.ico&quot;, RedirectView.as_view(url=staticfiles_storage.url(&quot;favicon.ico&quot;)),),<br>    url(&quot;&quot;, <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;project_app.urls&#x27;</span>)),<br>    # path(<span class="hljs-string">&#x27;api-auth/&#x27;</span>, <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;rest_framework.urls&#x27;</span>))<br>]<br></code></pre></td></tr></table></figure><p>如上所示，</p><pre><code class="hljs">`path(&quot;admin/&quot;, admin.site.urls)`：设置管理员后台。`path(&quot;favicon.ico&quot;, RedirectView.as_view(url=staticfiles_storage.url(&quot;favicon.ico&quot;)),)`：设置网站图标。`url(&quot;&quot;, include(&#39;project_app.urls&#39;)),`：将 app 的 urls 拼接到自己后面。</code></pre><h2 id="App-中-models-的设置"><a href="#App-中-models-的设置" class="headerlink" title="App 中 models 的设置"></a>App 中 models 的设置</h2><p>models 是 django 和数据库的对接，里面的每一个类都对应一张表单。</p><p>未完待续</p><h2 id="App-中-views-的设置"><a href="#App-中-views-的设置" class="headerlink" title="App 中 views 的设置"></a>App 中 views 的设置</h2><p>这是重头戏，前端的呈现和逻辑都在这里完成。</p><p>未完待续</p><h2 id="statics-和-templates"><a href="#statics-和-templates" class="headerlink" title="statics 和 templates"></a>statics 和 templates</h2><p>网页模板，本质是在 html 中插入形如 <code>&#123;&#123; for i in list &#125;&#125;、&#123;% static "asd/asd/asd" %&#125;</code> 之类的模板语法，通过 django 的 render（渲染）函数，配合传递的参数，生成一个标准 html 页面。</p><p>传递的参数是一个字典，组织方式类似于变量和值的一一对应；其中的变量可以是绝大多数 python 支持的变量，但似乎不支持自己定义的类。</p><p>未完待续</p><h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><p>由 models 定义绝大多数使用到的表单，包括但不限于成绩存储，学生帐号信息，题库。</p><h2 id="表单的定义"><a href="#表单的定义" class="headerlink" title="表单的定义"></a>表单的定义</h2><p>未完待续</p><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>未完待续</p><h2 id="中途调整"><a href="#中途调整" class="headerlink" title="中途调整"></a>中途调整</h2><p>未完待续</p><h2 id="在-views-py-中增删查改（访问）数据"><a href="#在-views-py-中增删查改（访问）数据" class="headerlink" title="在 views.py 中增删查改（访问）数据"></a>在 views.py 中增删查改（访问）数据</h2><p>未完待续</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>未完待续</p><h1 id="打分测评模型"><a href="#打分测评模型" class="headerlink" title="打分测评模型"></a>打分测评模型</h1><p>另一位同学负责的部分，具体表现为一个时刻监控数据库的神经网络模型程序。</p><p>django 完成一次测评，向一张表单中写入测评数据；打分模型检测到表单新增数据，则会自动处理。处理完成后，会向该学生对应的表中写入数据，如果表不存在，则创建表格。</p><p>输出的分数有两种情况，视题型而定，可能是单个分数，可能是四个分数。</p><p>前端读取到数据时会判断题型，在计算均分时，会对只有一个分数的题型特殊处理。</p><p>未完待续</p><h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><p>通过 https 方式启动 django 的大致指令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 ./project/manage.py runsslserver 0.0.0.0:8000 --certificate /etc/apache2/ssl/xxx.com.crt --key /etc/apache2/ssl/xxx.com.key<br></code></pre></td></tr></table></figure></p><p>如果是 DEBUG 状态，可以加入 <code>--no-static</code> 参数。</p><p>0.0.0.0:8000 是广播的目标地址，意思是对所有 ip 通过 8000 端口广播。值得注意的是，如果改为 443，80 等https，http默认端口，则会和本地服务器程序冲突。要想通过 443、80 广播，应当使用 nginx 之类的反向代理应用。</p><p><code>--certificate</code> 和 <code>--key</code> 都是 ssl 所需参数。</p><h1 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h1><p>未完待续</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Django 学习</title>
    <link href="/2023/08/10/2023%E5%B9%B48%E6%9C%8810%E6%97%A5/"/>
    <url>/2023/08/10/2023%E5%B9%B48%E6%9C%8810%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>正在学习 Django，和半吊子 mysql。</p><p>顺便练习键盘盲打……之前一直是一指禅野路子，现在眼睛也离不开键盘。</p><p>命令行里面使用就是 django-admin，注意不是django。python包是django</p><p>（正在看网课 <a href="https://www.bilibili.com/video/BV1qW4y1V7ky?p=36&amp;vd_source=91ff2e0c9c276605072aa920b7fb2501">前端+MySQL+Django</a>）</p><p>顺带一提，Windows快速切换桌面是 win+ctrl+方向</p><h1 id="各个文件分工"><a href="#各个文件分工" class="headerlink" title="各个文件分工"></a>各个文件分工</h1><h2 id="asgi-和-wsgi"><a href="#asgi-和-wsgi" class="headerlink" title="asgi 和 wsgi"></a>asgi 和 wsgi</h2><p>涉及请求，一个同步一个异步，一般来说不需要更改。</p><h2 id="urls"><a href="#urls" class="headerlink" title="urls"></a>urls</h2><p>对应python函数和网站的url，使用比较频繁。</p><p>假设有一个 app 名为 sims，那么，在外层的 urls 中， url 和文件是这样对应的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin<br><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path<br><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url, include<br><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin.site.urls),<br>    url(<span class="hljs-string">r&#x27;^sims/&#x27;</span>, include(<span class="hljs-string">&#x27;sims.urls&#x27;</span>))<br>]<br></code></pre></td></tr></table></figure><br>也就是使用 urlpatterns 这个列表，里面的 path 和 url 方法来进行对应。其中，path 只管 admin，其他都是 url 来的。urls 后面接 include，</p><hr><p>在 app ，即 sims 内层，urls.py 是这样对应的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^$&#x27;</span>, views.index),<br>    url(<span class="hljs-string">r&#x27;^add/$&#x27;</span>, views.add),<br>    url(<span class="hljs-string">r&#x27;^edit/$&#x27;</span>, views.edit),<br>    url(<span class="hljs-string">r&#x27;^delete/$&#x27;</span>, views.delete)<br>]<br></code></pre></td></tr></table></figure><p>首先需要导入 app 里面的</p><h2 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h2><p>配置文件，需要连接数据库，注册app，等等操作。</p><h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><h2 id="manage"><a href="#manage" class="headerlink" title="manage"></a>manage</h2><p>和其他的不在一起，在外面。</p><p>最常用的文件。</p><h1 id="APP的概念"><a href="#APP的概念" class="headerlink" title="APP的概念"></a>APP的概念</h1><p>大型项目中的某些功能。不同app可以拥有独立的表结构，html模板，css，不会相互影响。</p><p>但是一般来说多app的项目就是比较复杂的了。</p><p>可以通过 python manage.py startapp app01 这种形式来创建应用。新应用回合项目本体一样有自己的文件夹。</p><h2 id="apps"><a href="#apps" class="headerlink" title="apps"></a>apps</h2><p>不需要更改</p><h2 id="tests"><a href="#tests" class="headerlink" title="tests"></a>tests</h2><p>单元测试用的</p><h2 id="views"><a href="#views" class="headerlink" title="views"></a>views</h2><p>用于和 urls.py 里面的函数对应，所谓视图函数。</p><h2 id="models"><a href="#models" class="headerlink" title="models"></a>models</h2><p>专门操作数据库，使用orm，可以取代pymysql。</p><h2 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h2><p>默认提供后台管理功能，一般不使用。</p><h2 id="主要就是-views-和-models-这两个"><a href="#主要就是-views-和-models-这两个" class="headerlink" title="主要就是 views 和 models 这两个"></a>主要就是 views 和 models 这两个</h2><h1 id="基本使用步骤"><a href="#基本使用步骤" class="headerlink" title="基本使用步骤"></a>基本使用步骤</h1><ul><li><p>首先需要创建并注册 app：在setting的installed_apps这个列表里面注册，具体来说就是添加字符串，内容为形如 app01.apps.app01config 之类的类，这个类里面应该包含 app01 所需要的注册信息。</p></li><li><p>然后编写一个 urls 和 apps 的对应关系：编写 urls 文件。</p></li><li><p>然后编写一个视图函数 views，需要有一个函数 （例如index），这个函数 index 必须有一个参数 request 。这个函数中，可以使用httpresponse()之类的方法返回文字信息，也可以通过更加复杂的方法返回其他信息。</p></li><li><p>启动 django 程序：使用 python manage.py runserver</p></li></ul><p>总结一下就是一般网站配置 urls 和 views 即可，如果需要访问数据库则需要 models。每一个 url 可以对应一个函数。</p><h1 id="模板，和静态文件"><a href="#模板，和静态文件" class="headerlink" title="模板，和静态文件"></a>模板，和静态文件</h1><p>templates 模板的使用：</p><p>views文件的函数返回render()，参数为request和html模板文件名，例如return render(request,”asd.html”)</p><p>其中，默认情况下，程序会在app的templates目录下寻找html模板文件。如果setting里面配置了TEMPLATES里面的DIRS，则会改变。</p><h2 id="静态文件：例如CSS，图片，js"><a href="#静态文件：例如CSS，图片，js" class="headerlink" title="静态文件：例如CSS，图片，js"></a>静态文件：例如CSS，图片，js</h2><p>静态文件放在app 目录底下的 static 文件夹底下</p><p>一般来说， static 文件夹底下还会有css，img，plungins，js等等细分文件，方便管理</p><p>注意少使用绝对路径，可以使用 { % load static % } 之类的</p><h1 id=""><a href="#" class="headerlink" title="#"></a>#</h1>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>VITS 论文阅读-3</title>
    <link href="/2023/06/14/VITS-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-3/"/>
    <url>/2023/06/14/VITS-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-3/</url>
    
    <content type="html"><![CDATA[<p>VITS 本质是一个以最大化变分下界为目标的条件VAE.</p><p>这个变分下界表达式为</p><script type="math/tex; mode=display">\log p_{\theta}(x \mid c) \geq \mathbb{E}_{q_{\phi}(z \mid x)}\left[\log p_{\theta}(x \mid z)-\log \frac{q_{\phi}(z \mid x)}{p_{\theta}(z \mid c)}\right]</script><script type="math/tex; mode=display">={似然函数}[log{数据点 x 的似然函数} - log({近似后验分布} / {条件c下潜变量z的先验分布})]</script><ul><li>条件VAE公式（a conditional VAE formulation）<ul><li>目标:”变分下界”，证据下界（ELBO）<ul><li>重建损失</li><li>KL收敛</li></ul></li></ul></li><li>基于变分推理的对准估计（alignment estimation derived from variational inference）<br>- </li><li>提高合成质量的对抗性训练（adversarial training for improving synthesis quality）</li></ul><p>总损失函数是各个损失函数相加.</p><h2 id="条件VAE公式"><a href="#条件VAE公式" class="headerlink" title="条件VAE公式"></a>条件VAE公式</h2><p>输入语料 $x_{mel}$ ，提取 x 的 mel 频谱(梅尔语谱图, 用于音频处理). (人耳对频率的感受是对数的(logarithmic), 因此不能线性处理, 需要梅尔语谱图)</p><p>通过解码器将潜在变量 z 上采样, 转到波形域 $\hat{y}$.将 $\hat{y}$ 变换到 mel 频谱 $\hat{x}_{mel}$ .</p><p>对比 $x<em>{mel}$ 和 $\hat{x}</em>{mel}$ ,差值就是重建损失. 这个重建损失可以看作一个拉普拉斯分布, 但这个估计不需要可训练的参数，因为它只使用 STFT(短时傅立叶变换) 和线性投影到 mel 标度上; 估计仅在训练期间使用，推理不需要. </p><p>重建损失需要求一个变分下界, </p><script type="math/tex; mode=display">\mathbb{E}_{q_{\phi}(z \mid x)}\left[\log p_{\theta}(x \mid z)-\log \frac{q_{\phi}(z \mid x)}{p_{\theta}(z \mid c)}\right]</script><p>训练需要保证这个下界最大.</p><p>先验编码器 c 的输入条件, 由 <strong>从文本中提取的音素$c_{text}$</strong>, 和 <strong>音素与潜在变量之间的对齐 A</strong> 组成。</p><h2 id="变分推理的对准估计"><a href="#变分推理的对准估计" class="headerlink" title="变分推理的对准估计"></a>变分推理的对准估计</h2><h2 id="对抗性训练"><a href="#对抗性训练" class="headerlink" title="对抗性训练"></a>对抗性训练</h2><h1 id="训练过程"><a href="#训练过程" class="headerlink" title="训练过程"></a>训练过程</h1><p>有 $x_{mel}$ , 有潜变量 z, 可以得到重建损失.</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>VITS 论文阅读-2</title>
    <link href="/2023/06/14/VITS-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-2/"/>
    <url>/2023/06/14/VITS-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-2/</url>
    
    <content type="html"><![CDATA[<h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><p>所提出的方法主要在前三小节中描述：</p><ul><li>条件VAE公式（a conditional VAE formulation）</li><li>基于变分推理的对准估计（alignment estimation derived from variational inference）</li><li>提高合成质量的对抗性训练（adversarial training for improving synthesis quality）</li></ul><p>图1a和1b分别显示了我们方法的训练和推理过程。从现在起，我们将把我们的方法称为端到端文本到语音（VITS），具有对抗性学习的变分推理。</p><p>训练和推理流程如下：</p><p><img src="/img/QQ截图20230614191808.png" alt=""></p><h2 id="条件推理（conditional-inference）"><a href="#条件推理（conditional-inference）" class="headerlink" title="条件推理（conditional inference）"></a>条件推理（conditional inference）</h2><p>条件VAE公式（a conditional VAE formulation）。</p><p>目标为一个”变分下界”，也叫证据下界（ELBO）。详细说就是“intractable marginal log-likelihood ”棘手边缘拟合对数似然的变分下界。</p><p>如图，$\log p<em>{\theta}(x \mid c)$的变分下界为$\mathbb{E}</em>{q<em>{\phi}(z \mid x)}\left[\log p</em>{\theta}(x \mid z)-\log \frac{q<em>{\phi}(z \mid x)}{p</em>{\theta}(z \mid c)}\right]$。</p><script type="math/tex; mode=display">L_{\text {recon }}=\left\|x_{mel}-\hat{x}_{mel}\right\|_{1}</script><p>下界：似然【数据点x的似然函数 - （近似后验分布 / 条件c下潜变量z的先验分布）的对数】</p><p>训练损失即负的ELBO。</p><p>也可以看作为重建损失 + KL散度，这在潜变量z服从近似后验分布时成立。</p><h3 id="重建损失"><a href="#重建损失" class="headerlink" title="重建损失"></a>重建损失</h3><p>作为重建损失中的目标数据点，我们使用<strong>mel频谱图</strong>而不是原始波形，由 $x<em>{mel}$ 表示。我们通过<strong>解码器</strong>将潜在变量z<strong>上采样到波形域</strong> $\hat{y}$ ，并将 $\hat{y}$ <strong>变换到融合谱图域</strong> $\hat{x}</em>{mel}$ 。然后，预测的和目标mel谱图之间的L1损失被用作重建损失：</p><script type="math/tex; mode=display">L_{\text {recon }}=\left\|x_{mel}-\hat{x}_{mel}\right\|_{1}</script><p>这可以被视为<strong>假设数据分布的拉普拉斯分布并忽略常数项</strong>的最大似然估计。我们定义了mel声谱图域中的重建损失，以通过使用近似人类听觉系统响应的mel标度来提高感知质量。注意，根据原始波形的mel谱图估计不需要可训练的参数，因为它只使用STFT和线性投影到mel标度上。<strong>此外，估计仅在训练期间使用，而不是推理。</strong> 在实践中，我们不对整个潜在变量z进行上采样，而是使用部分序列作为解码器的输入，这是用于高效端到端训练的窗口生成器训练。</p><h3 id="KL收敛"><a href="#KL收敛" class="headerlink" title="KL收敛"></a>KL收敛</h3><p>先验编码器c的输入条件由从文本中提取的音素$c_{text}$和音素与潜在变量之间的对齐 A 组成。</p><p>对齐是一个硬单调注意力矩阵，其$\mid c_{text}\mid \times \mid z\mid$维度表示每个输入音素扩展到与目标语音时间对齐的长度。由于对齐没有基本事实标签，我们必须在每次训练迭代时估计对齐。</p><p>在我们的问题设置中，我们的目标是为后验编码器提供更多的高分辨率信息。因此，我们使用目标语音$x_{lin}$的线性尺度频谱图作为输入，而不是mel频谱图。注意，修改后的输入并不违反变分推理的性质。那么KL分歧是：</p><p><img src="/img/QQ截图20230614185303.png" alt=""></p><p>“因子分解正态分布”用于参数化我们的先验和后验编码器。</p><p>我们发现，增加先验分布的表现力对于生成真实样本很重要。因此，我们应用归一化流 f ，该流允许在因子分解的正态先验分布之上，根据变量变化规则，将简单分布可逆变换为更复杂的分布。</p><h2 id="路线估计（Alignment-Estimation）"><a href="#路线估计（Alignment-Estimation）" class="headerlink" title="路线估计（Alignment Estimation）"></a>路线估计（Alignment Estimation）</h2><p>基于变分推理的对准估计（alignment estimation derived from variational inference）。</p><h3 id="单调对齐搜索（MONOTONIC-ALIGNMENT-SEARCH）"><a href="#单调对齐搜索（MONOTONIC-ALIGNMENT-SEARCH）" class="headerlink" title="单调对齐搜索（MONOTONIC ALIGNMENT SEARCH）"></a>单调对齐搜索（MONOTONIC ALIGNMENT SEARCH）</h3><p>为了估计输入文本和目标语音之间的对齐A，我们采用<strong>单调对齐搜索（MAS）</strong>。</p><p>这是一种搜索对齐的方法，其最大化了由归一化流 f 参数化的数据的可能性。</p><p>因为人类按顺序阅读文本，不跳过任何单词，候选比对（ candidate alignments）被限制为单调且不跳过。</p><p>为了找到最佳对准，Kim等人（2020）使用动态规划。在我们的这个情况下直接应用MAS是困难的，因为我们的目标是ELBO，而不是确切的对数似然。因此，我们重新定义MAS，以找到最大化ELBO的对齐。</p><p>这个过程简化为找到最大化潜在变量z的对数似然的对齐。</p><p>但事实上，无论修不修改，都可以工作。因此我们使用的是原始MAS。</p><h3 id="文本时长预测器（DURATION-PREDICTION-FROM-TEXT）"><a href="#文本时长预测器（DURATION-PREDICTION-FROM-TEXT）" class="headerlink" title="文本时长预测器（DURATION PREDICTION FROM TEXT）"></a>文本时长预测器（DURATION PREDICTION FROM TEXT）</h3><p>我们可以通过对估计的对齐$\sum<em>{j}^{} A</em>{i,j}$的每行中的所有列求和来计算每个输入token$d_i$的持续时间。但持续时间可以用来训练确定性的持续时间预测器，但它不能表达一个人每次以不同的语速说话的方式。</p><p>为了生成类似人类的语音节奏，我们设计了一个<strong>随机持续时间预测器</strong>，使其样本遵循给定音素的持续时间分布。</p><p>随机持续时间预测器是一种基于流的生成模型，通常通过最大似然估计进行训练。然而，最大似然估计的直接应用是困难的，因为每个输入音素的持续时间是</p><p>1）离散整数，其需要被去量化（dequantized）以使用连续归一化流。</p><p>2）标量，其由于可逆性而无法进行高维变换。</p><p>我们应用<strong>变分去量化</strong>和<strong>变分数据扩充</strong>来解决这些问题。</p><p>具体地说，我们引入了两个随机变量 u 和 v ，它们具有与持续时间序列 d 相同的时间分辨率和维度，分别用于变分去方程化和变分数据扩充。</p><p>我们将u的支持度限制为[0, 1），使得差$d-v$变成了一个正实数序列。</p><p>我们按通道连接 v 和 d ，以生成更高维的潜在表示。、</p><p>我们通过近似后验分布$q(u,v|d,c<em>{text})$对这两个变量进行采样。由此产生的目标是<strong>音素持续时间的对数似然的变分下界</strong>。训练损失$L</em>{dur}$是<strong>负变分下界</strong>。</p><p>我们将阻止输入梯度反向传播的”停止梯度算子”应用于输入s，保证持续时间预测器的训练不会影响其他模块的训练。</p><p>而取样程序相对简单：通过随机持续时间预测器的逆变换，从随机噪声中采样音素持续时间，然后将其转换为整数。</p><h2 id="对抗训练"><a href="#对抗训练" class="headerlink" title="对抗训练"></a>对抗训练</h2><p>提高合成质量的对抗性训练（ adversarial training for improving synthesis quality）。</p><p>为了在我们的学习系统中采用对抗性训练，我们添加了一个鉴别器D，用于区分解码器G生成的输出和实际的波形y。</p><p>在这项工作中，我们使用了两种成功应用于语音合成的损失类型：一种是<strong>对抗性训练的最小二乘损失函数</strong>，另一种是<strong>训练生成器的附加特征匹配损失</strong>。</p><p>T表示鉴别器中的层的总数，并且$D^{l}$输出具有$N_{l}$个特征的鉴别器的第l层的特征图。</p><p>值得注意的是，特征匹配损失可以被视为在<strong>鉴别器的隐藏层中测量的重建损失</strong>，该重建损失被建议作为VAE的逐元素重建损失的替代方案。</p><h2 id="最终的损失函数"><a href="#最终的损失函数" class="headerlink" title="最终的损失函数"></a>最终的损失函数</h2><p>所有损失函数直接相加。</p><h2 id="模型架构"><a href="#模型架构" class="headerlink" title="模型架构"></a>模型架构</h2><p>总体架构由后验编码器、先验编码器、解码器、鉴别器和随机持续时间预测器组成。后验编码器和鉴别器仅用于训练，而不用于推理。</p><h3 id="后验编码器"><a href="#后验编码器" class="headerlink" title="后验编码器"></a>后验编码器</h3><p>对于后验编码器，我们使用WaveGlow和Glow-TTS中使用的非因果WaveNet残差块, “the non-causal WaveNet residual blocks”。</p><p>WaveNet残差块由具有多个扩张卷积层（ dilated convolutions ），每层含有门控激活单元（gated activation unit）和跳跃连接（ skip connection）。块上方的线性投影层产生正态后验分布的均值和方差。</p><p>对于多个说话人的情况，我们在残差块中使用全局条件反射（global conditioning）来添加说话人embedding。</p><h3 id="先验编码器"><a href="#先验编码器" class="headerlink" title="先验编码器"></a>先验编码器</h3><p>先验编码器包括处理输入音素$c_{text}$的<strong>文本编码器</strong>、改进先验分布的灵活性的<strong>归一化流</strong> f 。</p><p>文本编码器是一种transformer编码器（transformer encoder），它使用相对位置表示（relative positional representation）而不是绝对位置编码（absolute positional encoding）。</p><p>我们可以通过文本编码器和文本编码器上方的线性投影层，从 $c<em>{text}$ 中获得 hidden representation $h</em>{text}$ ，该线性投影层产生用于构建先验分布的均值和方差。</p><p>归一化流(normalizing flow)是仿射耦合层（affine coupling layers）堆积而成，包含 WaveNet 残差块的堆栈。为了简单起见，我们将归一化流设计为雅可比行列式为1的保体积变换（a volume-preserving transformation with the Jacobian determinant of one）。</p><p>这个变换来自于 GLOW. <a href="https://arxiv.org/abs/1807.03039">https://arxiv.org/abs/1807.03039</a></p><p>对于多说话人设置，我们通过全局条件，将说话人embedding加入到归一化流中的残差块中。</p><h3 id="解码器"><a href="#解码器" class="headerlink" title="解码器"></a>解码器</h3><p>解码器本质上是<strong>HiFi GAN V1生成器</strong>。它由”反条件姿态卷积”堆积组成，每个卷积后面，都有一个多接收场融合模块（MRF）。</p><p>MRF的输出是具有不同感受野大小的残差块的输出之和。</p><p>对于多说话人设置，我们添加一个转换说话人embedding的线性层，并将其添加到输入潜在变量z中。</p><h3 id="判别器"><a href="#判别器" class="headerlink" title="判别器"></a>判别器</h3><p>我们遵循HiFi GAN中提出的<strong>多周期鉴别器的鉴别器架构</strong>。</p><p>多周期判别器是基于<strong>马尔可夫窗的子鉴别器的混合</strong>，每个子判别器对输入波形的不同周期模式进行操作。</p><h3 id="随机持续时间预测器"><a href="#随机持续时间预测器" class="headerlink" title="随机持续时间预测器"></a>随机持续时间预测器</h3><p>随机持续时间预测器根据条件输入的 $h_{text}$ 估计音素持续时间的分布。</p><p>为了有效地参数化随机持续时间预测器，我们将<strong>残差块</strong>，与<strong>扩张和深度可分离的卷积层</strong>叠加。我们还将神经样条流（neural spline flows）应用于耦合层，其通过使用单调有理二次样条（monotonic rational-quadratic splines）采用可逆非线性变换的形式。</p><p>与常用的仿射耦合层相比，神经样条流的参数相似数量，但提高了变换的表现力。</p><p>对于多说话人设置，我们添加了一个线性层来转换说话人embedding，并将其添加到输入 $h_{text}$ 中。</p><h1 id="个人理解"><a href="#个人理解" class="headerlink" title="个人理解"></a>个人理解</h1><h2 id="训练过程"><a href="#训练过程" class="headerlink" title="训练过程"></a>训练过程</h2><p>使用了：</p><ul><li>后验编码器</li><li>先验编码器</li><li>解码器</li><li>鉴别器</li><li>随机持续时间预测器</li></ul><p>也就是所有部件。</p><p>$x_{lin}$ 为线性频谱, 通过后验编码器, flow, 解码器, 输出预测的原始波形 $\hat{y}$ .</p><p>$c<em>{text}$ 为从文本中提取的音素, 通过文本编码器得到 $h</em>{text}$ , 投影到 z 所服从的正态分布, 正态分布的两个参数是 $\mu<em>{\theta}$ 和  $\sigma</em>{\theta}$ . 然后使用单调对齐搜索( MAS )估计潜在变量之间的对齐 A ,最大化由归一化流 f 参数化的数据的可能性.</p><p>对齐 A 是一个<strong>硬单调注意力矩阵</strong>，其$\mid c<em>{text}\mid \times \mid z\mid$维度, 表示每个输入音素$c</em>{text}$扩展到与目标语音时间对齐的长度。</p><p>核心的 flow 是一堆 z 和一堆对应的 $f<em>z(z)$ .对于 $\theta$ 层的 $z$, 服从的正态分布系数是 $\mu</em>{\theta}$ 和  $\sigma_{\theta}$ , </p><p>$f_{\theta}(z)$ ,</p><h2 id="推理过程"><a href="#推理过程" class="headerlink" title="推理过程"></a>推理过程</h2><p>使用了：</p><ul><li>先验编码器</li><li>解码器</li><li>随机持续时间预测器</li></ul><p>也就是不使用后验编码器和判别器。</p><p>$c_{text}$ ，phoneme（音素），作为输入。</p><p>经过text encoder，文本编码器，和线性投影层，得到 $h_{text}$ ，hidden representation，和投影。</p><p> $h_{text}$ 使用随机时间预测器，逆变换，从随机噪声中提取持续时间。</p><p>取样程序：通过随机持续时间预测器的逆变换，从随机噪声中采样音素持续时间，然后将其转换为整数，得到向量 $d$ 。</p><p>然后投入先验编码器，先验编码器包括文本编码器和归一化流，文本编码器是一个transformer，归一化流进行估计，参数化对先验概率q的逼近。</p><!-- 具体过程是, 有多个维度的 $\mu_{\theta}$ 和  $\sigma_{\theta}$ , 每次出一个像素, 组成一个三维向量, 和 d 相乘,  --><h1 id="涉及的论文与概念"><a href="#涉及的论文与概念" class="headerlink" title="涉及的论文与概念"></a>涉及的论文与概念</h1><h2 id="归一化流"><a href="#归一化流" class="headerlink" title="归一化流"></a>归一化流</h2><p>本质是一个生成模型。一个基于可能性的生成模型。</p><p>（自回归模型, 生成对抗网络(GAN)的一部分, 变分自动编码器（VAE）也是自回归模型。）</p><p>Flow 将简单分布（易于采样和评估密度）映射到复杂分布（通过数据学习）。但是方便起见，实际使用时就是想办法得到一个encoder将输入x编码为<strong>隐变量z</strong>，并且<strong>使得z服从标准正态分布</strong>。</p><p>得益于flow模型的精巧设计，这个encoder是<strong>可逆</strong>的，从而我们可以立马从encoder写出相应的decoder（生成器）出来，因此，只要encoder训练完成，我们就能同时得到decoder，完成生成模型的构建。</p><hr><p>x 和 z 应该有以下关系：</p><p>首先， $X=f(Z)$ ， $Z=f^{-1}(X)$ 。也就是说从 Z 映射到 X ，这个映射确定而可逆。</p><p>然后有：</p><p><strong>变量变换定理(change of variable theorem):</strong> 有 $p_z(z)$ 和 $p_x(x)$ ,有 $f(z)=x$ ,如果要通过 $f$ 建立 $p_z(z)$ 和 $p_x(x)$ 之间的关系，可以将 $p_z(z)$ 和 $p_x(x)$ 使用微分方法借取一小段，直接计算一小段的体积，并对比，并按照体积的比例进行缩放，缩放函数在每个点上组合起来就是 $f(z)=x$ 。</p><script type="math/tex; mode=display">p_x(x)=p_z(z) ( f^{-1}(x)) \mid {det}( \frac{\partial f^{-1}(x)}{\partial x} =p_z(z) ( f^{-1}(x)) \mid {det}( \frac{\partial f(x)}{\partial x}^{-1}  ) \mid</script><p>其中，由于可逆矩阵 $det(A^{-1})=det(A)^{-1}$ 。因此对于 $z=f^{-1}(x)$ ，有：</p><script type="math/tex; mode=display">p_x(x)=p_z(z) \mid {det}( \frac{\partial f(z)}{\partial z}  ) \mid</script><p>对于 $\frac{\partial f^{-1}(x)}{\partial x}$ ，这是一个 n 维矩阵。这个矩阵记做<strong>雅可比矩阵</strong>。</p><p><strong>保体积</strong>： $\mid {det}( \frac{\partial f(z)}{\partial z}  ) \mid =1$ ，则从 z 到 x 的映射是保体积的。换言之，变换后的 $p_x$ 和 原始的 $p_z$ 有同样的体积，或者说volume。</p><p>(体积指的就是行列式.)</p><p>流模型核心条件：</p><ul><li>模型可逆</li><li>对应的雅可比行列式容易计算 <ul><li>因此本文将其设计为雅可比行列式为1的保体积变换（a volume-preserving transformation with the Jacobian determinant of one）</li></ul></li></ul><p>有“边界可能性” $p_x(x)$ ，满足</p><script type="math/tex; mode=display">p_x(x;\theta )=p_z(f_{\theta }^{-1}(x)) \mid {det}( \frac{\partial f_{\theta }^{-1}(x)}{\partial x}  ) \mid</script><p>名称“归一化流”可以解释如下：</p><ul><li>“归一化”意味着变量的变化在应用可逆变换后给出归一化密度（normalized density）。</li><li>“流”意味着可逆变换可以相互组合，以创建更复杂的可逆变换。</li></ul><p>存在多个隐变量 z, 存在对应数量的变换函数 f(z), 而最后一个 z 对应出来就是 x.</p><hr><p>优化函数:</p><script type="math/tex; mode=display">logp_k(x^i)=logp_z(z^i)+\sum_{h=1}^{K}log\mid det(J_{G^{-1}})\mid =logp_z(G^{-1}(x^i))+\sum_{h=1}^{K}log\mid det(J_{G^{-1}})\mid</script><p>这是 $G^{-1}$ 训练的目标: 最大化这个式子的值即可.</p><p>实际使用 G, 将其逆转即可.</p><h3 id="平面流"><a href="#平面流" class="headerlink" title="平面流"></a>平面流</h3><h3 id="vits使用的流模型"><a href="#vits使用的流模型" class="headerlink" title="vits使用的流模型"></a>vits使用的流模型</h3><p><strong>the non-causal WaveNet residual blocks</strong> used in <strong>WaveGlow</strong> (Prenger et al., 2019) and <strong>Glow-TTS</strong> (Kim et al., 2020).</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>fpga 电梯项目</title>
    <link href="/2023/06/13/fpga-%E7%94%B5%E6%A2%AF%E9%A1%B9%E7%9B%AE/"/>
    <url>/2023/06/13/fpga-%E7%94%B5%E6%A2%AF%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<p>累死我了。昨天下午到今天中午。</p><p>累不累不要紧，主要是这是期末复习周。分秒寸金的复习周。</p><h2 id="吐槽两句"><a href="#吐槽两句" class="headerlink" title="吐槽两句"></a>吐槽两句</h2><h3 id="调试："><a href="#调试：" class="headerlink" title="调试："></a>调试：</h3><p>vivado，verilog的开发方式和其他语言不太一样。调试的话，要么仿真，要么建立一个debug core调试核，要么下板。一开始，觉得很快就能做完；觉得编写仿真文件，或者现学调试不合算，我选择直接下板。然后被这个反复下板浪费的时间折磨到了。</p><p>而且三阶段，一个是分析，一个是硬件，一个是比特流，每一项都花时间，每一项都走不开，不能像是“让程序慢慢跑，吃个饭先”之类的。</p><p>下次一定仿真。</p><h3 id="暂时不要相信gpt的复杂代码水平"><a href="#暂时不要相信gpt的复杂代码水平" class="headerlink" title="暂时不要相信gpt的复杂代码水平"></a>暂时不要相信gpt的复杂代码水平</h3><p>基于python或c或go之类的几十行一两百行还好，这种复杂的程序真的是难为gpt这种泛用模型了。尤其是verilog还是个非主流语言。</p><p>而且，我这个项目，是网络上已经有不少现成的，gpt是将它们按照我的要求缝在了一起。有的地方缝错位了，有的地方不该缝的缝上了。还有有的地方我以为缝错了其实缝对了。导致修改花了绝大多数时间。</p><p>不过，要我自己从零写，不知道要花多少时间。我没这个时间也没这个精力再写一次。</p><h3 id="遗憾："><a href="#遗憾：" class="headerlink" title="遗憾："></a>遗憾：</h3><p>fpga开发板贵的一批。学校给了我使用的机会，但我没有珍惜。</p><p>下次一定。</p><h2 id="基本架构"><a href="#基本架构" class="headerlink" title="基本架构"></a>基本架构</h2><p>有以下几个部分：</p><ul><li>top：顶层文件</li><li>key_debounce：按键消抖</li><li>matrix_key：矩阵键盘。实际使用四个键，属于是卵用没有，只能添乱。</li><li>switch_control：拨码开关控制（并输出floor查看运行状态）</li><li>clk_div：理论有用但实际没用，全他妈用的是自己分频…………这个模块对我的唯一贡献，是给led_control模块塞了一个花了我好长时间的bug……</li><li>seg_control：控制数码管显示。大改过。</li><li>led_control：控制led和电梯上下楼，名副其实的灵魂模块。</li><li>beep_control：一个意义不明的模块，我不知道gpt本来是想做什么，反正它在我这里就是一个运行指示器。</li></ul><p>top里面重要的reg：</p><ul><li>row行信号，设置为1110<ul><li>一开始设的是0001，纳闷了好久。</li></ul></li><li>几个led灯</li><li>key_in和key_out</li><li>floor和floor_out<ul><li>floor是寄存器，作为模块输入，不能作为输出。</li><li>要改变floor的值，需要通过一个wire，floor_out来转接。</li><li>我在top里面加了一句always @(posedge clk) floor&lt;=floor_out; endmodule，用来将这两个直接相连。</li></ul></li></ul><h2 id="模块介绍"><a href="#模块介绍" class="headerlink" title="模块介绍"></a>模块介绍</h2><h3 id="top：顶层文件"><a href="#top：顶层文件" class="headerlink" title="top：顶层文件"></a>top：顶层文件</h3><p>模块例化，将floor_out和floor链接。</p><p>`timescale 1ns / 1ps不知道有没有用，总之加上就是了。之前因为这一句翻过车。</p><p>总之就是要把各个变量对应好，不要出现什么时钟频率错误，in和out变量错误什么的。</p><h3 id="key-debounce：按键消抖"><a href="#key-debounce：按键消抖" class="headerlink" title="key_debounce：按键消抖"></a>key_debounce：按键消抖</h3><p>基本原理是检测到按键按下，然后等20个时钟周期再看看，如果还是按下，那就真的按下了，输出按键信息。</p><h3 id="switch-control：拨码开关控制（并输出floor查看运行状态）"><a href="#switch-control：拨码开关控制（并输出floor查看运行状态）" class="headerlink" title="switch_control：拨码开关控制（并输出floor查看运行状态）"></a>switch_control：拨码开关控制（并输出floor查看运行状态）</h3><p>其实也是个没卵用的模块，把二位的led_status分割成一个rst一个start。我是不知道为什么我不在xdc里面直接定义rst和start……可能是闲得蛋疼。</p><p>但是我还是保留了，毕竟能正常工作，还能加点其他功能，不在其他模块碍眼。例如打印floor状态。</p><h3 id="clk-div：理论有用但实际没用，全他妈用的是自己分频…………这个模块对我的唯一贡献，是给led-control模块塞了一个花了我好长时间的bug……"><a href="#clk-div：理论有用但实际没用，全他妈用的是自己分频…………这个模块对我的唯一贡献，是给led-control模块塞了一个花了我好长时间的bug……" class="headerlink" title="clk_div：理论有用但实际没用，全他妈用的是自己分频…………这个模块对我的唯一贡献，是给led_control模块塞了一个花了我好长时间的bug……"></a>clk_div：理论有用但实际没用，全他妈用的是自己分频…………这个模块对我的唯一贡献，是给led_control模块塞了一个花了我好长时间的bug……</h3><p>字面意思，理论上应该用这个控制所有时钟分频，但是我的模块用分频的少，所以都自己分了。</p><h3 id="seg-control：控制数码管显示。大改过。"><a href="#seg-control：控制数码管显示。大改过。" class="headerlink" title="　seg_control：控制数码管显示。大改过。"></a>　seg_control：控制数码管显示。大改过。</h3><p>大改指的是把本来的全部注释掉然后重写。</p><p>主要是因为我改了matrix_key，没用，导致编码从8421变成了独热码。而且我的floor只有两位，按键四个，不需要那么复杂的东西。</p><p>两个数码管，交替选择，选择时显示内容。</p><p>如果不使用分频，会导致残影。理论上需要专门的方法去除，但是我懒狗，我是把频率降一下就当没看到残影。我是用的是1000hz。</p><h3 id="led-control：控制led和电梯上下楼，名副其实的灵魂模块。"><a href="#led-control：控制led和电梯上下楼，名副其实的灵魂模块。" class="headerlink" title="led_control：控制led和电梯上下楼，名副其实的灵魂模块。"></a>led_control：控制led和电梯上下楼，名副其实的灵魂模块。</h3><p>首先是判断key_in，如果非零，那就说明按键按下。在这个情况下，需要根据floor和key的内容选择新的floor。</p><p>松开按键，则key就会归零，于是针对key我使用了一个key_reg保存上一次的输入。所有判断都是在计时器计满之后执行的；都是基于上一次key的输入来选择判断。</p><p>好吧，实际用到key_reg的只有一处，控制led灯那里。要求是：</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">led<span class="hljs-number">_</span><span class="hljs-keyword">out</span><span class="hljs-number">0</span>：按下KEY<span class="hljs-number">0</span>键，若电梯不在<span class="hljs-number">1</span>楼，则LED<span class="hljs-number">0</span>亮；电梯到达<span class="hljs-number">1</span>楼后，LED<span class="hljs-number">0</span>指示灯灭掉<br>由于按下key<span class="hljs-number">0</span>，电平会从高变低，因此是：<br>若为一楼停靠：<span class="hljs-number">00</span>：led<span class="hljs-number">0</span>灭，为<span class="hljs-number">0</span><br>若为二楼停靠，或者其他状态：key<span class="hljs-number">0</span>取反<br><br>led<span class="hljs-number">_</span><span class="hljs-keyword">out</span><span class="hljs-number">1</span>：<br>按下KEY<span class="hljs-number">1</span>键, 若电梯不在<span class="hljs-number">2</span>楼，则LED<span class="hljs-number">1</span>亮,电梯到达<span class="hljs-number">2</span>楼后，LED<span class="hljs-number">1</span>指示灯灭掉.<br>由于按下key<span class="hljs-number">1</span>，电平会从高变低，因此是：<br>若为一楼停靠，或其他状态：key<span class="hljs-number">1</span>取反，若key<span class="hljs-number">1</span>按下，则为<span class="hljs-number">1</span>，若未按下，则为<span class="hljs-number">0</span><br>若为二楼停靠：<span class="hljs-number">01</span>：led<span class="hljs-number">1</span>灭，为<span class="hljs-number">0</span><br><br>led<span class="hljs-number">_</span><span class="hljs-keyword">out</span><span class="hljs-number">2</span>：<br>电梯在<span class="hljs-number">2</span>楼，按KEY<span class="hljs-number">2</span>键, 则LED<span class="hljs-number">2</span>亮，电梯到<span class="hljs-number">1</span>楼后LED<span class="hljs-number">2</span>灭<br><span class="hljs-number">01</span>、<span class="hljs-number">11</span>：key<span class="hljs-number">2</span>取反<br><span class="hljs-number">00</span>、<span class="hljs-number">10</span>：设<span class="hljs-number">0</span><br><br>led<span class="hljs-number">_</span><span class="hljs-keyword">out</span><span class="hljs-number">3</span>：<br>电梯在<span class="hljs-number">1</span>楼，按KEY<span class="hljs-number">3</span>键, 则LED<span class="hljs-number">3</span>亮，电梯到<span class="hljs-number">2</span>楼后LED<span class="hljs-number">3</span>灭。<br><span class="hljs-number">00</span>、<span class="hljs-number">10</span>：key<span class="hljs-number">3</span>取反（一楼、一楼到二楼）<br><span class="hljs-number">01</span>、<span class="hljs-number">11</span>：设<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>本来有很多用了key_reg的，砍掉了。</p><p>还有就是运行时灯的流动，<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">led_reg</span>，五个灯，<span class="hljs-number">0</span>.<span class="hljs-number">1</span>秒移动一次，在电梯运行时移动。<br><span class="hljs-attribute">led_reg</span>则是对应G5～T4，从左到右分别<span class="hljs-number">01234</span><br></code></pre></td></tr></table></figure><br>代码:<br><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-number">2&#x27;b10</span>: led_reg &lt;= &#123;led_reg[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>],led_reg[<span class="hljs-number">4</span>]&lt;=<span class="hljs-number">1</span>&#125;; <span class="hljs-comment">//如果电梯上行，LED11至LED7从左到右轮流点亮</span><br><span class="hljs-number">2&#x27;b11</span>: led_reg &lt;= &#123;led_reg[<span class="hljs-number">0</span>]&lt;=<span class="hljs-number">1</span>,led_reg[<span class="hljs-number">4</span>:<span class="hljs-number">1</span>]&#125;; <span class="hljs-comment">//如果电梯下行，LED11至LED7从右到左轮流点亮</span><br></code></pre></td></tr></table></figure><br>注意不是流水灯，但大差不差。</p><h3 id="beep-control：一个意义不明的模块，我不知道gpt本来是想做什么，反正它在我这里就是一个运行指示器。"><a href="#beep-control：一个意义不明的模块，我不知道gpt本来是想做什么，反正它在我这里就是一个运行指示器。" class="headerlink" title="beep_control：一个意义不明的模块，我不知道gpt本来是想做什么，反正它在我这里就是一个运行指示器。"></a>beep_control：一个意义不明的模块，我不知道gpt本来是想做什么，反正它在我这里就是一个运行指示器。</h3><p>改了，改成了到站叫一声。</p><p>使用了一个timer_start一个beep_enable来分别控制counter和timer，timer控制时长，counter控制频率。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Transformer(Attention机制)论文阅读-2</title>
    <link href="/2023/06/13/Transformer-Attention%E6%9C%BA%E5%88%B6-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-2/"/>
    <url>/2023/06/13/Transformer-Attention%E6%9C%BA%E5%88%B6-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-2/</url>
    
    <content type="html"><![CDATA[<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><h3 id="编码器encoder"><a href="#编码器encoder" class="headerlink" title="编码器encoder"></a>编码器encoder</h3><p>包含了6个相同的层组成的“stack”，每层两个子层，一个是多头自注意力机制，一个是“simple, positionwise fully connected feed-forward network”简单的、互联的前馈网络。</p><p>在每子层的周围使用残差连接、层归一化。“We employ a residual connection around each of the two sub-layers, followed by layer normalization.”，也就是每层的输出为 LayerNorm(x + Sublayer(x))。</p><p>所有层被标准化为512维的输出。</p><h3 id="解码器decoder"><a href="#解码器decoder" class="headerlink" title="解码器decoder"></a>解码器decoder</h3><p>同样包含了6个相同的层组成的“stack”，但每层三个子层，一个是多头自注意力机制，一个是多头编码器-解码器注意力机制，“performs multi-head attention over the output of the encoder stack”，一个是简单的、互联的前馈网络。</p><p>其中的自注意力层和编码器有所不同，不会关注当前位置后面的位置。</p><p>和编码器相同，在每子层的周围使用残差连接、层归一化。“We employ a residual connection around each of the two sub-layers, followed by layer normalization.”，也就是每层的输出为 LayerNorm(x + Sublayer(x))。所有层被标准化为512维的输出。</p><h2 id="注意力机制"><a href="#注意力机制" class="headerlink" title="注意力机制"></a>注意力机制</h2><p>本质是将查询（query）和一组键值对（a set of key-value pairs，是键和值）映射到输出。</p><p>换言之，这个键和这个值是配对的，查询是额外的。</p><p>输出是值的加权和，权重由查询和对应关键字兼容性函数确定。（weight assigned to each value is computed by a compatibility function of the query with the corresponding key.）</p><p>将三种向量各自组成查询（Q），键（K），值（V），然后三个矩阵变一个Output。</p><p><img src="/img/QQ截图20230613170233.png" alt="图一"></p><p>其中，求权重的“Scaled Dot-Product Attention”的公式为：</p><p><img src="v2-3c82189a676da40f1ee57c916311ec88_r.png" alt="Scaled Dot-Product Attention"></p><p>即计算QKV三者输出。假设Q和K等长，长度dk，V长度dv，计算过程：</p><ul><li>求QK余弦相似度：求夹角余弦值，相当于判断向量夹角，角度越小越相似。</li><li>余弦相似度除(dk)^(1/2)（长度）</li><li>softmax得到权重，即是attention。</li><li>attention权重和V相乘，每一行就是需要的输出。</li></ul><p>Scaled Dot-Product Attention属于点乘注意力机制，并在一般点乘注意力机制的基础上，加上了scaled。scaled是指对注意力权重进行缩放，以确保数值的稳定性。</p><p>常用注意力机制有additive attention、dot-product (multiplicative) attention，加性注意力和点积注意力。Scaled Dot-Product Attention属于点积注意力，但Scaled Dot-Product Attention 比传统的点积注意力多了一个根号dk的部分。</p><p>加性注意力使用具有单个隐藏层的前馈网络来计算兼容性函数。</p><p>虽然加与乘注意力两者在理论复杂性上相似，但点积注意力在实践中要快得多，而且更节省空间，因为它可以使用高度优化的矩阵乘法代码来实现。</p><p>引入根号dk的原因：弥补点积注意力相对于加法注意力的缺陷：对于较大的dk值，点积的大小会变大，从而将softmax函数推向具有极小梯度的区域。根号dk可以抵消这个影响。</p><h3 id="多头注意力"><a href="#多头注意力" class="headerlink" title="多头注意力"></a>多头注意力</h3><p>从“performing a single attention function with dmodel-dimensional keys, values and queries”</p><p>到“linearly project the queries, keys and values h times with different, learned linear projections to dk, dk and dv dimensions, respectively，On each of these projected versions of queries, keys and values we then perform the attention function in parallel, yielding dv-dimensional output values. These are concatenated and once again projected, resulting in the final values.”</p><p>（projected，含预计和投影的意思。）</p><p>翻译一下就是，本来是单头注意力，只有一个注意力函数。</p><p>而多头注意力是用不同的、通过机器学习学到的线性投影，将查询、键和值（三个向量）分别线性投影到dk、dk和dv维度h次，也就是h个注意力头。然后在查询、键和值的每个投影版本上，我们并行执行注意力函数，生成dv维输出值。这些被连接起来，组成多头，并再次投影，得到最终值。</p><p>多头注意力允许模型联合关注来自不同位置的不同表示子空间的信息。对于一个单一的注意力头而言，做不到，因为单头注意力使用的平均会抑制这种情况。</p><p>“头”指的是某次线性投影得到的注意力。</p><p><img src="/img/QQ截图20230614140633.png" alt="图二"></p><p>团队在测试的时候使用了八个头，h=8，QK长度均为64，d(model)则是h与64相乘。</p><p>总计算成本比较低，因为每个头的维数并不高，而且还可以并行计算。</p><h3 id="Transformer中注意力机制的使用"><a href="#Transformer中注意力机制的使用" class="headerlink" title="Transformer中注意力机制的使用"></a>Transformer中注意力机制的使用</h3><h4 id="编码器-解码器注意力"><a href="#编码器-解码器注意力" class="headerlink" title="编码器-解码器注意力"></a>编码器-解码器注意力</h4><p>在解码器中使用。</p><p>查询来自上一个解码器层，键和值来自编码器的输出。</p><p>这种机制模仿了序列到序列模型中的典型编码器-解码器注意力机制，允许解码器中的每一个位置关注输入序列中的所有位置。</p><h4 id="编码器自注意力"><a href="#编码器自注意力" class="headerlink" title="编码器自注意力"></a>编码器自注意力</h4><p>所有的键、值和查询都来自同一个地方，也就是是编码器中前一层的输出。</p><p>这种机制允许编码器中的每个位置关注编码器的前一层中的所有位置。</p><h4 id="解码器自注意力"><a href="#解码器自注意力" class="headerlink" title="解码器自注意力"></a>解码器自注意力</h4><p>基本同编码器，但是解码器只能关注半边的信息，“prevent leftward information flow in the decoder to preserve the auto-regressive property”</p><h2 id="位置前馈网络Position-wise-Feed-Forward-Networks"><a href="#位置前馈网络Position-wise-Feed-Forward-Networks" class="headerlink" title="位置前馈网络Position-wise Feed-Forward Networks"></a>位置前馈网络Position-wise Feed-Forward Networks</h2><p>每层都包含一个全连接神经网络。“applied to each position separately and identically”，分别且相同地应用于每个位置。</p><p>这个网络包含了两个线性变换，一个是relu激活。</p><p>不同层网络结构相同但参数不同。</p><p>这个网络也可以看作是一个卷积核大小为1的两个卷积。实验者设置的输入和输出的维度为dmodel=512，内层的维度为dff=2048。</p><h2 id="Embeddings-and-Softmax"><a href="#Embeddings-and-Softmax" class="headerlink" title="Embeddings and Softmax"></a>Embeddings and Softmax</h2><p>embedding含义为嵌入层，可以把信息选择性保留，缩小矩阵大小（稀疏矩阵）抽象但更容易处理，即降维；也可以升维。</p><p>transformer中的embedding是输入token和输出token转换为维度为dmodel的向量，还使用普通线性变换和softmax函数，将解码器的输出转换为预测的下一个token概率。</p><p>transformer中两个嵌入层和预softmax线性变换之间共享相同的权重矩阵。在embedding层中，将这些权重和根号dmodel相乘。</p><h2 id="位置编码positional-encodings"><a href="#位置编码positional-encodings" class="headerlink" title="位置编码positional encodings"></a>位置编码positional encodings</h2><p>只用注意力机制，不使用卷积和递归，因此需要引入相关位置信息，计算序列中的token。</p><p>每层的复杂度、顺序操作、最大路径长度</p><p><img src="/img/QQ截图20230614145448.png" alt="图三"></p><p>n是序列长度，d是表示维度，k是卷积的核大小，r是限制自注意中邻域的大小。</p><p>transformer将位置编码和“编码器和解码器堆栈底部的‘输入embedding’”结合。（指编码器解码器都有多层，这里是加到最底下一层的embedding子层）</p><p>位置编码与embedding具有相同的维度dmodel，因此可以将两者进行直接处理。有多种位置编码可以选择，可以选择让机器学习编码，也可以直接使用固定方式。而本文使用的是不同频率正余弦函数。</p><p><img src="/img/QQ截图20230614150348.png" alt="图四"></p><p>输入参数中，pos是位置，i是尺寸。</p><p>可以理解为将每个位置和频域上的冲激相对应起来。之所以选择正余弦函数，是对pos的任何偏移，都可以将函数转化为没有偏移的正余弦函数。</p><h2 id="自注意力机制和递归、卷积对比"><a href="#自注意力机制和递归、卷积对比" class="headerlink" title="自注意力机制和递归、卷积对比"></a>自注意力机制和递归、卷积对比</h2><p>三个方面：</p><h3 id="每层的总计算复杂度"><a href="#每层的总计算复杂度" class="headerlink" title="每层的总计算复杂度"></a>每层的总计算复杂度</h3><h3 id="可以并行化的计算量"><a href="#可以并行化的计算量" class="headerlink" title="可以并行化的计算量"></a>可以并行化的计算量</h3><h3 id="网络中长程依赖项之间的路径长度（path-length-between-long-range-dependencies-in-the-network）"><a href="#网络中长程依赖项之间的路径长度（path-length-between-long-range-dependencies-in-the-network）" class="headerlink" title="网络中长程依赖项之间的路径长度（path length between long-range dependencies in the network）"></a>网络中长程依赖项之间的路径长度（path length between long-range dependencies in the network）</h3><p>网络需要学习长程依赖关系，而影响学习这种依赖性的能力的一个关键因素是前向和后向信号在网络中必须经过的路径的长度，越短就越容易学习。</p><p>研究时统计了由不同层类型组成的网络中任意两个输入和输出位置之间的最大路径长度：</p><p>每层的复杂度、顺序操作、最大路径长度</p><p><img src="/img/QQ截图20230614145448.png" alt="图三"></p><p>n是序列长度，d是表示维度，k是卷积的核大小，r是限制自注意中邻域的大小。<br><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs excel">自关注层通过恒定数量的顺序执行操作连接所有位置，而递归层需要O（<span class="hljs-built_in">n</span>）个顺序操作。就计算复杂性而言，当序列长度<span class="hljs-built_in">n</span>小于表示维度d时，自注意层比递归层更快，这在机器翻译中最先进的模型使用的句子表示中最为常见，例如分词[<span class="hljs-number">38</span>]和字节对[<span class="hljs-number">31</span>]表示。为了提高涉及非常长序列的任务的计算性能，可以将自注意限制为仅考虑输入序列中以相应输出位置为中心的大小为r的邻域。这将使最大路径长度增加到O（<span class="hljs-built_in">n</span>＝r）。我们计划在未来的工作中进一步研究这种方法。<br><br>核宽度k＜<span class="hljs-built_in">n</span>的单个卷积层并不连接所有输入和输出位置对。在连续核的情况下，这样做需要O（<span class="hljs-built_in">n</span>=k）个卷积层的堆栈，或者在扩张卷积的情况下需要O（logk（<span class="hljs-built_in">n</span>））[<span class="hljs-number">18</span>]，从而增加网络中任意两个位置之间最长路径的长度。卷积层通常比递归层贵k倍。然而，可分离卷积[<span class="hljs-number">6</span>]将复杂性显著降低到O（k <span class="hljs-built_in">n</span> d+<span class="hljs-built_in">n</span> <span class="hljs-symbol">d2</span>）。然而，即使k=<span class="hljs-built_in">n</span>，可分离卷积的复杂性也等于自注意层和逐点前馈层的组合，这是我们在模型中采用的方法。<br><br>作为副作用，自我关注可以产生更多可解释的模型。我们从我们的模型中检查注意力分布，并在附录中给出和讨论示例。个体注意力负责人不仅清楚地学会了执行不同的任务，而且许多人似乎表现出与句子的句法和语义结构有关的行为。<br></code></pre></td></tr></table></figure></p><p>自注意力层：通过恒定数量的顺序执行操作连接所有位置</p><p><strong>递归层</strong>：需要O（n）个顺序操作</p><p>当序列长度n小于表示维度d时，自注意层比递归层更快</p><p>为了提高涉及非常长序列的任务的计算性能，可以将自注意限制为仅考虑输入序列中以相应输出位置为中心的大小为r的邻域。这将使最大路径长度增加到O（n＝r）。我们计划在未来的工作中进一步研究这种方法。</p><p>核宽度k＜n的单个卷积层并不连接所有输入和输出位置对。在连续核的情况下，这样做需要O（n=k）个卷积层的堆栈，或者在扩张卷积的情况下需要O（logk（n））[18]，从而增加网络中任意两个位置之间最长路径的长度。卷积层通常比递归层贵k倍。然而，可分离卷积[6]将复杂性显著降低到O（k n d+n d2）。然而，即使k=n，可分离卷积的复杂性也等于自注意层和逐点前馈层的组合，这是我们在模型中采用的方法。</p><p>另外，自注意力可以产生更多可解释的模型。</p><p>我们从我们的模型中检查注意力分布，并在附录中给出和讨论示例。单个的注意力头不仅清楚地学会了执行不同的任务，而且许多注意力头似乎表现出与句子的句法和语义结构有关的行为。</p><h2 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h2><p>使用BLEU评价效果。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>VITS论文阅读</title>
    <link href="/2023/06/12/VITS%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    <url>/2023/06/12/VITS%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/</url>
    
    <content type="html"><![CDATA[<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>VITS，Variational Inference with adversarial learning for end-to-end Text-to-Speech，一个很牛逼的变分推理 + 对抗学习的端到端 TTS 网络。</p><p>基于《Attention is all you need》中的Transformer结构，额外添加了一个持续时长预测器。</p><h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><p>基于 transformer，也有编码器，解码器。但是编码器做了文本编码器、先验编码器、后验编码器的区分。</p><p><strong>基本组成部分：</strong></p><p>•  文本编码器（Text Encoder）：将输入的文本序列转换为文本特征序列，使用transformer的编码器结构。</p><p>•  后验编码器（Posterior Encoder）：将文本特征序列和真实的语音特征序列（如梅尔频谱）作为输入，使用transformer的编码器结构，输出一个后验潜变量分布。</p><p>•  先验编码器（Prior Encoder）：将文本特征序列作为输入，使用transformer的编码器结构，并在每个层后面加入一个标准化流层（Normalizing Flow Layer），输出一个先验潜变量分布。</p><p>•  语音解码器（Speech Decoder）：将文本特征序列和从先验或后验分布中采样得到的潜变量作为输入，使用transformer的解码器结构，并在最后一层后面加入一个对抗损失层（Adversarial Loss Layer），输出一个语音特征序列。</p><p>•  持续时间预测器（Duration Predictor）：将文本特征序列作为输入，使用一个全连接层和一个softmax层，输出一个持续时间序列，表示每个文本单元对应的语音帧数。</p><p><strong>VITS的模型训练过程包含以下几个损失函数：</strong></p><p>•  重建损失（Reconstruction Loss）：衡量语音解码器输出的语音特征序列和真实的语音特征序列之间的差异，使用L1损失或MSE损失。</p><p>•  对抗损失（Adversarial Loss）：衡量语音解码器输出的语音特征序列是否能够被一个判别器（Discriminator）区分出真假，使用Wasserstein距离或GAN损失。</p><p>•  KL散度损失（KL Divergence Loss）：衡量后验潜变量分布和先验潜变量分布之间的差异，使用KL散度公式。</p><p>•  持续时间损失（Duration Loss）：衡量持续时间预测器输出的持续时间序列和真实的持续时间序列之间的差异，使用MSE损失或二值交叉熵损失。</p><h2 id="训练过程的网络"><a href="#训练过程的网络" class="headerlink" title="训练过程的网络"></a>训练过程的网络</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">1.将输入的文本序列和真实的语音特征序列（如梅尔频谱）通过文本编码器和后验编码器得到后验潜变量分布，并从中采样得到后验潜变量。<br><br>2.将输入的文本序列通过先验编码器得到先验潜变量分布，并从中采样得到先验潜变量。<br><br>3.将文本特征序列和后验潜变量或先验潜变量通过语音解码器得到重建的语音特征序列，并通过判别器判断其真假。<br><br>4.根据重建损失、对抗损失、KL散度损失和持续时间损失对模型参数进行更新。<br></code></pre></td></tr></table></figure><p>总结一下，即</p><ul><li>文本序列，真实语音序列作为输入，通过文本编码器、后验编码器，输出后验潜变量分布，采样得后验潜变量。</li><li>文本序列作为输入，通过先验编码器，得到先验潜变量分布，采样得到先验潜变量。</li><li>“文本特征序列”+后验潜变量通过语音解码器，得到重建语音特征序列。</li><li>“文本特征序列”+先验潜变量通过语音解码器，得到重建语音特征序列。</li><li>重建语音特征序列输入判别器，判断真假。</li><li>计算所有损失，求和，并进行模型参数更新。</li></ul><p>但是VITS将本来的编码器换成了VAE，又加了个标准化流，变成了Glow模型。</p><h2 id="推理过程的网络"><a href="#推理过程的网络" class="headerlink" title="推理过程的网络"></a>推理过程的网络</h2><p><strong>VITS的模型推理过程如下：</strong></p><p>•  将输入的文本序列通过文本编码器得到文本特征序列。</p><p>•  将文本特征序列通过先验编码器得到先验潜变量分布，并从中采样得到潜变量。</p><p>•  将文本特征序列和潜变量通过语音解码器得到语音特征序列。</p><p>•  将语音特征序列通过一个声码器（Vocoder）得到最终的语音波形。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Transformer 在 VITS 中的应用</title>
    <link href="/2023/06/12/Transformer-%E5%9C%A8-VITS-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <url>/2023/06/12/Transformer-%E5%9C%A8-VITS-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>VITS，Variational Inference with adversarial learning for end-to-end Text-to-Speech，使用了 transformer 作为基本的架构，但是在后验编码器和先验编码器之间额外添加了变分推理和标准化流。</p><h2 id="Transformer的结构"><a href="#Transformer的结构" class="headerlink" title="Transformer的结构"></a>Transformer的结构</h2><p>一个编码器，一个解码器。</p><p>编码器解码器各自是一个相对完整的神经网络，每层含子层，子层分别为注意力和前馈神经网络。处理查询（query）、</p><p>键（key）或值（value）（都是向量）。</p><h2 id="VITS的结构和原版Transformer的对应"><a href="#VITS的结构和原版Transformer的对应" class="headerlink" title="VITS的结构和原版Transformer的对应"></a>VITS的结构和原版Transformer的对应</h2><p>文本编码器（Text Encoder）：transformer的<strong>编码器</strong>结构，将输入的文本序列转换为文本特征序列。</p><p>后验编码器（Posterior Encoder）：transformer的<strong>编码器</strong>结构，将文本特征序列和真实的语音特征序列（如梅尔频谱）作为输入，输出一个后验潜变量分布。</p><p>先验编码器（Prior Encoder）：transformer的<strong>编码器</strong>结构，将文本特征序列作为输入，并在每个层后面加入一个标准化流层（Normalizing Flow Layer），输出一个先验潜变量分布。</p><p>语音解码器（Speech Decoder）：transformer的<strong>解码器</strong>结构，将文本特征序列和从先验或后验分布中采样得到的潜变量作为输入，并在最后一层后面加入一个对抗损失层（Adversarial Loss Layer），输出一个语音特征序列。</p><p><strong>以及额外添加的：</strong></p><p>持续时间预测器（Duration Predictor）：将文本特征序列作为输入，使用一个全连接层和一个softmax层，输出一个持续时间序列，表示每个文本单元对应的语音帧数。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Transformer(Attention机制)论文阅读-1</title>
    <link href="/2023/06/09/Transformer-Attention%E6%9C%BA%E5%88%B6-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    <url>/2023/06/09/Transformer-Attention%E6%9C%BA%E5%88%B6-%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/</url>
    
    <content type="html"><![CDATA[<p>业界典中典之《Attention Is All You Need》，影响世界格局的注意力机制，和“Transformer”。你甚至可以在 <a href="https://en.wikipedia.org/wiki/Transformer">维基百科的transformer</a> 页面看到它的大名。</p><p>论文原链接为<a href="https://arxiv.org/abs/1706.03762">https://arxiv.org/abs/1706.03762</a> 和 <a href="https://arxiv.org/pdf/1706.03762.pdf。">https://arxiv.org/pdf/1706.03762.pdf。</a><br>方便起见，我在文末会嵌入论文pdf页面。</p><h2 id="首先问问new-bing怎么说："><a href="#首先问问new-bing怎么说：" class="headerlink" title="首先问问new bing怎么说："></a>首先问问new bing怎么说：</h2><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">《<span class="hljs-variable">Attention</span> <span class="hljs-variable">Is</span> <span class="hljs-built_in">All</span> <span class="hljs-variable">You</span> <span class="hljs-variable">Need</span>》是一篇于<span class="hljs-number">2017</span>年发表在<span class="hljs-variable">NIPS</span>会议上的论文，由<span class="hljs-variable">Google</span> <span class="hljs-variable">Brain</span>和<span class="hljs-variable">Google</span> <span class="hljs-variable">Research</span>的<span class="hljs-number">8</span>位作者共同撰写 。这篇论文提出了一种新的基于注意力机制的网络架构，叫做<span class="hljs-variable">Transformer</span>，它完全摒弃了循环神经网络和卷积神经网络，只使用注意力机制来编码和解码序列。<br><br>这篇论文的主要贡献有以下几点：<br><br>•  提出了一种新的注意力函数，叫做缩放点积注意力（<span class="hljs-built_in">Scaled</span> <span class="hljs-built_in">Dot</span><span class="hljs-operator">-</span><span class="hljs-built_in">Product</span> <span class="hljs-variable">Attention</span>），它可以计算一个查询向量和一组键值对之间的相关性，并输出相应的值向量的加权和。<br><br>•  提出了一种新的注意力模块，叫做多头注意力（<span class="hljs-variable">Multi</span><span class="hljs-operator">-</span><span class="hljs-built_in">Head</span> <span class="hljs-variable">Attention</span>），它可以将输入向量分成多个子空间，并在每个子空间上分别进行缩放点积注意力，然后将结果拼接起来。<br><br>•  提出了一种新的位置编码方式，叫做正弦余弦位置编码（<span class="hljs-variable">Sinusoidal</span> <span class="hljs-variable">Positional</span> <span class="hljs-variable">Encoding</span>），它可以给输入序列中的每个位置添加一个固定的向量，用来表示位置信息。<br><br>•  提出了一种新的网络结构，叫做<span class="hljs-variable">Transformer</span>，它由一个编码器和一个解码器组成，每个编码器和解码器都包含若干层，每层都由多头注意力、前馈神经网络、残差连接和层归一化组成。<br><br>•  在两个机器翻译任务上，分别是<span class="hljs-variable">WMT</span> <span class="hljs-number">2014</span>英德翻译和<span class="hljs-variable">WMT</span> <span class="hljs-number">2014</span>英法翻译，展示了<span class="hljs-variable">Transformer</span>的优越性能，分别达到了<span class="hljs-number">28.4</span> <span class="hljs-variable">BLEU</span>和<span class="hljs-number">41.8</span> <span class="hljs-variable">BLEU</span>的单模型最佳结果。<br><br>•  在一个英语成分句法分析任务上，展示了<span class="hljs-variable">Transformer</span>的泛化能力，无论是在大规模还是小规模的训练数据上，都能取得不错的效果。<br><br>这篇论文对于自然语言处理领域有着深远的影响，它开创了基于自注意力机制的序列建模和转换的范式，并为后续的许多工作提供了灵感和基础。例如<span class="hljs-variable">BERT</span>、<span class="hljs-variable">GPT</span>、<span class="hljs-variable">XLNet</span>等预训练语言模型都是基于<span class="hljs-variable">Transformer</span>或其变体构建的。<br></code></pre></td></tr></table></figure><p><strong>总结一下，新提出的有以下：</strong></p><ol><li>神经网络架构<ol><li>Transformer，核心是注意力机制</li><li>由一个编码器和一个解码器组成</li><li>每个编码器和解码器都包含若干层，每层都由多头注意力、前馈神经网络、残差连接和层归一化组成</li></ol></li><li>注意力函数<ol><li>名为缩放点积注意力（Scaled Dot-Product Attention）</li><li>计算一个查询向量和一组键值对之间的相关性，并输出相应的值向量的加权和</li></ol></li><li>注意力模块<ol><li>多头注意力（Multi-Head Attention）</li><li>将输入向量分成多个子空间，并在每个子空间上分别进行缩放点积注意力，然后将结果拼接起来</li></ol></li><li>位置编码方式<ol><li>正弦余弦位置编码（Sinusoidal Positional Encoding）</li><li>给输入序列中的每个位置添加一个固定的向量，用来表示位置信息</li></ol></li></ol><p>总之就是注意力，围绕注意力机制展开的一系列工作。</p><p><strong>论文摘要为：</strong><br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">基于复杂的循环或卷积神经网络的编码器-解码器配置的主导序列转换模型。<br><br>最佳性能的模型还通过注意力机制连接编码器和解码器。<br><br>我们提出了一种新的简单网络架构，Transformer，它完全基于注意力机制，完全摒弃了循环和卷积。<br><br>两个机器翻译任务上的实验表明，这些模型在质量上优于其他模型，同时更易于并行化，并且需要显著更少的时间来训练。<br><br>我们的模型在WMT <span class="hljs-number">2014</span>英德翻译任务上实现了<span class="hljs-number">28</span>.<span class="hljs-number">4</span> <span class="hljs-keyword">BLEU的单一模型最佳结果，在现有最佳结果（包括集成）上提高了2 </span><span class="hljs-keyword">BLEU以上。在WMT </span><span class="hljs-number">2014</span>英法翻译任务上，我们的模型在<span class="hljs-number">8</span>个GPU上训练<span class="hljs-number">3</span>.<span class="hljs-number">5</span>天后建立了<span class="hljs-number">41</span>.<span class="hljs-number">8</span> <span class="hljs-keyword">BLEU的单一模型最新水平BLEU分数，这是文献中最佳模型训练成本的一小部分。</span><br><span class="hljs-keyword"></span><br>我们展示了Transformer对其他任务具有很好的泛化能力，通过将其成功应用于英语成分句法分析，在大规模和有限训练数据上都取得了不错的效果。<br></code></pre></td></tr></table></figure><br>（其实什么都没说，就是效果好，好的离谱。）</p><hr><p>根据搜索结果，本文Transformer中的各个组成模块分别是：</p><p>•  缩放点积注意力（Scaled Dot-Product Attention）：这是一种注意力函数，它计算一个查询向量和一组键值对之间的相关性，并输出相应的值向量的加权和。它的公式是：</p><script type="math/tex; mode=display">\text{Attention}(Q,K,V)=\text{softmax}(\frac{QK^T}{\sqrt{d_k}})V</script><p>其中，$Q$是查询矩阵，$K$是键矩阵，$V$是值矩阵，$d_k$是键向量的维度。分母上的$\sqrt{d_k}$是为了缩放点积的结果，避免过大或过小的数值影响梯度传播。</p><p>•  多头注意力（Multi-Head Attention）：这是一种注意力模块，它将输入向量分成多个子空间，并在每个子空间上分别进行缩放点积注意力，然后将结果拼接起来。它的公式是：</p><script type="math/tex; mode=display">\text{MultiHead}(Q,K,V)=\text{Concat}(\text{head}_1,\dots,\text{head}_h)W^O</script><p>其中，$\text{head}_i=\text{Attention}(QW_i^Q,KW_i^K,VW_i^V)$，$W_i^Q,W_i^K,W_i^V,W^O$都是可学习的参数矩阵。多头注意力可以让模型同时关注不同的表示子空间和不同的位置信息。 </p><p>•  正弦余弦位置编码（Sinusoidal Positional Encoding）：这是一种位置编码方式，它给输入序列中的每个位置添加一个固定的向量，用来表示位置信息。它的公式是：</p><script type="math/tex; mode=display">\text{PE}{(pos,2i)}=\sin(pos/10000^{2i/d{\text{model}}})</script><script type="math/tex; mode=display">\text{PE}{(pos,2i+1)}=\cos(pos/10000^{2i/d{\text{model}}})</script><p>其中，$pos$是位置索引，$i$是维度索引，$d_{\text{model}}$是模型维度。正弦余弦位置编码可以让模型捕捉到相对位置和绝对位置的信息，并且具有平移不变性。</p><p>•  Transformer：这是一种网络结构，它由一个编码器和一个解码器组成，每个编码器和解码器都包含若干层，每层都由多头注意力、前馈神经网络、残差连接和层归一化组成。编码器用来将输入序列编码成一个高维向量表示，解码器用来根据编码器的输出和自身的输入生成目标序列。</p><p>以上就是本文Transformer中各个组成模块的简要解释。如果你想了解更多细节，请参考原文 <a href="https://www.electricalclassroom.com/parts-of-a-transformer/">https://www.electricalclassroom.com/parts-of-a-transformer/</a> 或其他相关资料。</p><hr><p>也就是</p><p>•  缩放点积注意力（Scaled Dot-Product Attention）：<strong>注意力函数</strong></p><p>计算一个查询向量和一组键值对之间的相关性，并输出相应的值向量的加权和</p><p>•  多头注意力（Multi-Head Attention）：<strong>注意力模块</strong></p><p>将输入向量分成多个子空间，并在每个子空间上分别进行缩放点积注意力，然后将结果拼接起来</p><p>•  正弦余弦位置编码（Sinusoidal Positional Encoding）：<strong>位置编码方式</strong></p><p>给输入序列中的每个位置添加一个固定的向量，用来表示位置信息</p><p>•  Transformer：<strong>网络结构</strong></p><p>由一个<strong>编码器</strong>和一个<strong>解码器</strong>组成，每个编码器和解码器都包含若干层，每层都由多头注意力、前馈神经网络、残差连接和层归一化组成。编码器用来将输入序列编码成一个高维向量表示，解码器用来根据编码器的输出和自身的输入生成目标序列。</p><hr><ul><li><strong>神经网络架构</strong><ul><li>Transformer</li><li>编码器<ul><li>将输入序列编码成一个高维向量表示</li><li>若干层<ul><li>多头注意力</li><li>前馈神经网络</li><li>残差连接</li><li>层归一化</li></ul></li></ul></li><li>解码器<ul><li>根据编码器的输出和自身的输入生成目标序列</li><li>若干层<ul><li>多头注意力</li><li>前馈神经网络</li><li>残差连接</li><li>层归一化</li></ul></li></ul></li></ul></li><li><strong>注意力函数</strong><ul><li>缩放点积注意力（Scaled Dot-Product Attention）</li><li>计算一个查询向量和一组键值对之间的相关性<ul><li>输出相应的值向量的加权和</li></ul></li></ul></li><li><strong>注意力模块</strong><ul><li>多头注意力（Multi-Head Attention）</li><li>将输入向量分成多个子空间<ul><li>在每个子空间上分别进行缩放点积注意力<ul><li>然后将结果拼接起来</li></ul></li></ul></li></ul></li><li><strong>位置编码方式</strong><ul><li>正弦余弦位置编码（Sinusoidal Positional Encoding）</li><li>给输入序列中的每个位置添加一个固定的向量，用来表示位置信息</li></ul></li></ul><hr><p>transformer 是一个网络结构，它包含了缩放点积注意力、多头注意力和正弦余弦位置编码等部分。</p><hr><p>自注意力机制（Self-Attention Mechanism）是一种注意力机制，它计算一个序列中不同位置的元素之间的相关性，并输出相应的元素的加权和。它的公式是：</p><script type="math/tex; mode=display">\text{Attention}(Q,K,V)=\text{softmax}(\frac{QK^T}{\sqrt{d_k}})V</script><p>其中，$Q$是查询矩阵，$K$是键矩阵，$V$是值矩阵，$d_k$是键向量的维度。分母上的$\sqrt{d_k}$是为了缩放点积的结果，避免过大或过小的数值影响梯度传播。</p><p>自注意力机制的本质可以被描述为一个查询（query）到一系列（键key-值value）对的映射，其中查询和键值对都来自于同一个序列。</p><p>自注意力机制可以让序列中的每个元素都与其他元素进行交互，从而捕捉序列内部的结构和依赖关系。</p><p>自注意力机制有多种变体，例如多头注意力（Multi-Head Attention），它将输入向量分成多个子空间，并在每个子空间上分别进行自注意力，然后将结果拼接起来。</p><p>自注意力机制被广泛应用于基于深度学习的自然语言处理任务中，例如机器翻译、文本摘要、语义分析等。</p><p>如果你想了解更多关于自注意力机制的原理和应用，请参考以下资源：</p><p>•  <a href="https://zhuanlan.zhihu.com/p/410776234">《Attention Is All You Need》</a> ：这是一篇经典的论文，提出了基于自注意力机制的Transformer网络结构，在机器翻译任务上取得了显著的效果。</p><p>•  <a href="https://towardsdatascience.com/illustrated-self-attention-2d627e33b20a">《Illustrated: Self-Attention》</a> ：这是一篇通俗易懂的博客文章，用图解的方式介绍了自注意力机制的计算过程和意义。</p><p>•  <a href="https://machinelearningmastery.com/the-transformer-attention-mechanism/">《The Transformer Attention Mechanism》</a> ：这是一篇详细的教程文章，介绍了Transformer中使用的不同类型的自注意力机制，以及如何用Python实现它们。</p><hr><p>《Attention Is All You Need》是一篇于2017年发表在NIPS会议上的论文，由Google Brain和Google Research的研究人员合作撰写。</p><p>该论文提出了一种新的神经网络架构，称为Transformer，它完全基于注意力机制（attention mechanism），摒弃了循环（recurrence）和卷积（convolution）。</p><p>注意力机制是一种将一个<strong>查询（query）</strong>和一组<strong>键值对（key-value pairs）</strong>映射到一个<strong>输出（output）</strong>的函数，其中<strong>查询、键、值和输出都是向量</strong>。</p><p>Transformer利用了两种注意力机制：<strong>自注意力（self-attention）</strong>和<strong>编码器-解码器注意力（encoder-decoder attention）</strong>。</p><p><strong>自注意力</strong>允许模型在同一个序列中的不同位置之间建立联系，<strong>编码器-解码器注意力</strong>允许模型在不同序列之间建立联系。</p><p>Transformer由一个编码器（encoder）和一个解码器（decoder）组成，每个部分都包含多个相同的层（layer）。</p><p>每个层都有两个子层（sub-layer），一个是多头注意力（multi-head attention），另一个是前馈神经网络（feed-forward neural network）。</p><p>此外，每个子层都有残差连接（residual connection）和层归一化（layer normalization）。</p><p>Transformer在机器翻译任务上取得了优异的性能，超过了当时的最佳模型，包括集成模型。它在WMT 2014英德翻译任务上达到了28.4 BLEU，比最佳结果提高了2 BLEU以上。它在WMT 2014英法翻译任务上达到了41.8 BLEU，创造了新的单模型最高纪录。Transformer还能很好地泛化到其他任务，例如英语成分句法分析（English constituency parsing）。</p><hr><h3 id="捋清思路"><a href="#捋清思路" class="headerlink" title="捋清思路"></a>捋清思路</h3><p>注意力的本质是处理“查询”和“键值对”并输出的函数。操作对象都是向量。</p><p>多头注意力，包含两种注意力机制，一种是<strong>自注意力</strong>，另一种是<strong>编码器-解码器注意力</strong>。</p><p>自注意力用于在同一序列、不同位置之间建立联系。可以让模型学习到序列内部的依赖关系，无论他们相隔多远。</p><p>编码器-解码器注意力用于在不同序列之间建立联系。可以让模型关注到编码器输出中和当前解码器输入相关的部分。</p><p><strong>Transformer架构如下：</strong></p><ul><li>transformer<ul><li>编码器：包含多个相同的层，每层包含两个子层。<ul><li>层：包含两个子层<ul><li>多头注意力<ul><li>残差连接</li><li>层归一化</li></ul></li><li>前馈神经网络<ul><li>残差连接</li><li>层归一化</li></ul></li></ul></li></ul></li><li>解码器：包含多个相同的层，每层包含两个子层。<ul><li>层：包含两个子层<ul><li>多头注意力<ul><li>残差连接</li><li>层归一化</li></ul></li><li>前馈神经网络<ul><li>残差连接</li><li>层归一化</li></ul></li></ul></li></ul></li></ul></li></ul><p><strong>自然语言处理中：</strong></p><ul><li>序列（sequence）：句子</li><li>序列中的不同位置（position）：单词，或者子词。</li></ul><p>Transformer网络的目标是解决序列到序列（sequence-to-sequence）的任务，例如机器翻译（machine translation），即将一个源语言序列转换为一个目标语言序列。</p><p>Transformer网络的工作过程可以分为以下几个步骤：</p><ol><li><p>首先，将源语言序列和目标语言序列都进行编码（encoding），即将每个单词或子词转换为一个固定长度的向量（vector），通常使用词嵌入（word embedding）或者位置编码（position encoding）来实现。</p></li><li><p>然后，将源语言序列的向量输入到编码器（encoder）中，编码器由多个层（layer）组成，每个层都包含一个多头自注意力（multi-head self-attention）子层和一个前馈神经网络（feed-forward neural network）子层。多头自注意力子层可以让每个位置的输出都包含了输入序列中所有位置的信息，从而捕捉到序列中的依赖关系。前馈神经网络子层可以对每个位置的输出进行非线性变换，从而增加模型的表达能力。</p></li><li><p>接着，将目标语言序列的向量输入到解码器（decoder）中，解码器也由多个层组成，每个层都包含一个多头自注意力子层、一个多头编码器-解码器注意力（multi-head encoder-decoder attention）子层和一个前馈神经网络子层。多头自注意力子层可以让每个位置的输出都包含了目标语言序列中所有位置的信息，从而捕捉到序列中的依赖关系。多头编码器-解码器注意力子层可以让每个位置的输出都包含了编码器输出序列中所有位置的信息，从而实现了源语言序列和目标语言序列之间的对齐。前馈神经网络子层可以对每个位置的输出进行非线性变换，从而增加模型的表达能力。</p></li><li><p>最后，将解码器输出的向量进行解码（decoding），即将每个向量转换为一个单词或子词，通常使用线性变换（linear transformation）和softmax函数来实现。这样就得到了最终的目标语言序列。</p></li></ol><p><strong>多头注意力层：</strong></p><p>可以将输入序列分成多个子序列，然后对每个子序列应用不同的注意力函数，最后将各个子序列的输出拼接起来。这样可以让模型同时关注到不同的特征和信息。自注意力和编码器-解码器注意力都是一种注意力函数，只是应用的对象不同。自注意力是在同一个序列中的不同位置之间进行计算，编码器-解码器注意力是在不同序列之间进行计算。</p><hr><p>在编码器自注意力中，查询（query）和键（key）、值（value）都来自于输入序列；</p><p>在编码器-解码器注意力中，查询（query）来自于解码器的输出序列，而键（key）和值（value）来自于编码器的输出序列。</p><p>编码器自注意力和编码器-解码器注意力的主要区别在于<strong>它们的查询（query）来源</strong>。</p><hr><p>编码器-解码器注意力是一种注意力机制，它用于编码器-解码器模型中。</p><p>在这种模型中，编码器将输入序列编码为一个固定长度的向量，然后解码器使用这个向量来生成输出序列。编码器-解码器注意力允许解码器在生成输出序列时直接访问编码器的输出。</p><p>在编码器-解码器注意力中，查询（query）来自于解码器的输出序列，而键（key）和值（value）来自于编码器的输出序列。这种机制允许解码器根据输入序列中不同位置的相关性来分配不同的权重，从而更好地捕捉序列中不同位置之间的关系。</p><p>自注意力（Self-Attention）是一种注意力机制，它用于捕捉序列中不同位置之间的关系。</p><p>与传统的注意力机制不同，自注意力减少了对外部信息的依赖，更擅长捕捉数据或特征的内部相关性。</p><p>在自注意力中，查询（query）、键（key）和值（value）都来自于输入序列。这种机制允许模型根据输入序列中不同位置的相关性来分配不同的权重，从而更好地捕捉序列中不同位置之间的关系。</p><hr><p>在<strong>自注意力机制</strong>中，查询（query）、键（key）和值（value）都来自于输入序列。查询（query）表示请求的内容，键（key）表示被请求的内容，值（value）表示被请求内容的实际值。通过计算查询（query）和键（key）之间的点积来确定每个值（value）的权重，然后对所有值（value）进行加权求和来得到输出。</p><p>在<strong>编码器-解码器注意力机制</strong>中，查询（query）来自于解码器的输出序列，而键（key）和值（value）来自于编码器的输出序列。查询（query）表示请求的内容，键（key）表示被请求的内容，值（value）表示被请求内容的实际值。</p><p>与自注意力机制类似，编码器-解码器注意力机制通过计算查询（query）和键（key）之间的点积来确定每个值（value）的权重，然后对所有值（value）进行加权求和来得到输出。不同之处在于，查询（query）来自于解码器的输出序列，而键（key）和值（value）来自于编码器的输出序列。</p><p>自注意力机制中，Transformer首先将输入序列转化为查询（query）、键（key）和值（value），然后通过自注意力机制进行处理并输出。</p><p>编码器-解码器注意力机制中，编码器首先将输入序列编码为一个固定长度的向量，然后解码器使用这个向量来生成输出序列。在生成输出序列时，解码器会根据输入序列中不同位置的相关性来分配不同的权重，从而更好地捕捉序列中不同位置之间的关系。</p><hr><p>在Transformer网络中，编码器和解码器是两个分开的部分，它们之间通过编码器-解码器注意力机制进行交互。</p><p>编码器将输入序列编码为一个固定长度的向量，然后解码器使用这个向量来生成输出序列。在生成输出序列时，解码器会使用编码器-解码器注意力机制来直接访问编码器的输出。这种机制允许解码器根据输入序列中不同位置的相关性来分配不同的权重，从而更好地捕捉序列中不同位置之间的关系。</p><p>多头注意力是Transformer网络中编码器和解码器共有的子层。它允许模型同时关注多个位置，从而更好地捕捉序列中不同位置之间的关系。在多头注意力中，查询（query）、键（key）和值（value）被分成多个头，每个头分别进行自注意力或编码器-解码器注意力计算，然后将所有头的结果拼接起来作为最终输出。</p><hr><p><strong>Q：</strong>在运行过程中，编码器和解码器的层是同一层吗？换句话说，能不能认为，transformer是一个大型网络，不存在编码器解码器的分别，只是transformer网络中的每一层，可以看出有两个部分，一部分负责编码一部分负责解码？</p><p><strong>A：</strong>在Transformer网络中，编码器和解码器是两个分开的部分，它们由多个层组成。编码器和解码器的层数可以相同，也可以不同。</p><p>编码器将输入序列编码为一个固定长度的向量，然后解码器使用这个向量来生成输出序列。编码器和解码器都由多个层组成，每个层都包含多头注意力子层和前馈神经网络子层。在编码器中，多头注意力子层使用自注意力机制来捕捉输入序列中不同位置之间的关系。在解码器中，多头注意力子层既使用自注意力机制来捕捉输出序列中不同位置之间的关系，也使用编码器-解码器注意力机制来直接访问编码器的输出。</p><p>因此，Transformer网络可以看作是一个大型网络，它由编码器和解码器两个部分组成。每个部分都由多个层组成，每个层都包含多头注意力子层和前馈神经网络子层。编码器和解码器之间通过编码器-解码器注意力机制进行交互。</p><pre><code class="hljs">亦即是说解码器和编码器确实是分开的，两个网络，毕竟层数都可以不一样。但也没有分那么开，联系相当紧密。</code></pre><hr><p><strong>Q：</strong>我复述一遍，你看看对不对。序列进入transformer时，首先是进入编码器，通过所有层，而不是只通过某一层，最终生成的是编码后的向量。这个向量再被放入解码器，得到输出序列。那么，我有一个问题。编码器输出的向量，是query、key和value中的哪一个？解码器的各个层中的编码器-解码器注意力，使用的query、key和value是解码器的前一层的输出，还是编码器的输出？</p><p><strong>A：</strong>您的理解是正确的。序列进入Transformer时，首先进入编码器，通过所有层，最终生成编码后的向量。这个向量再被放入解码器，得到输出序列。</p><p>编码器输出的向量不是查询（query）、键（key）或值（value），而是编码后的向量，它表示输入序列的固定长度表示。在解码器中，每个层的编码器-解码器注意力子层使用的查询（query）来自于解码器的前一层的输出，而键（key）和值（value）来自于编码器的输出。</p><hr><p><strong>Q：</strong>你说解码器的键（key）和值（value）来自于编码器的输出，又说编码器输出的向量不是查询（query）、键（key）或值（value），而是编码后的向量。编码后的向量和键（key）、值（value）有什么关系？请详细介绍。</p><p><strong>A：</strong>编码器输出的向量是输入序列的固定长度表示，它由编码器的最后一层输出。在解码器中，每个层的编码器-解码器注意力子层使用的键（key）和值（value）来自于编码器的输出，也就是说，它们来自于编码器的最后一层输出的编码后的向量。</p><p>在编码器-解码器注意力子层中，查询（query）、键（key）和值（value）都是通过将输入序列中的每个元素与不同的权重矩阵相乘来计算得到的。查询（query）来自于解码器的前一层的输出，而键（key）和值（value）来自于编码器的最后一层输出的编码后的向量。</p><p>因此，编码后的向量和键（key）、值（value）之间的关系是：编码后的向量是输入序列的固定长度表示，它由编码器的最后一层输出；而键（key）和值（value）则是通过将编码后的向量与不同的权重矩阵相乘来计算得到的。</p><pre><code class="hljs">亦即是说，编码器确实是执行完所有层，才会输出句子对应的向量。这个向量经过与不同的权重矩阵相乘来计算，得到键（key）和值（value）。键（key）和值（value）会传递给解码器，解码器第一层会将目标序列转化为查询（query）向量，传递给下一层；之后的每一层会输出向量，作为下一层的查询（query）输入。</code></pre><p><strong>Q：</strong>解码器的输入是“目标序列”，那么，这个“目标序列”是怎么转化为查询（query）的？</p><p><strong>A：</strong>在解码器中，每个层的编码器-解码器注意力子层使用的查询（query）来自于解码器的前一层的输出。在解码器的第一层中，查询（query）来自于目标序列。</p><p>目标序列首先被转化为嵌入表示，然后与位置编码相加来表示序列中每个元素的位置信息。这个嵌入表示就是解码器第一层的输入，也就是查询（query）。</p><p>在解码器的每个层中，查询（query）都是通过将输入序列中的每个元素与权重矩阵相乘来计算得到的。在解码器的第一层中，输入序列就是目标序列的嵌入表示。</p><hr><p><strong>Q：</strong>详细解释权重矩阵是哪里来的。是transformer神经网络自带的吗？键（key）和值（value）在解码器的每一层中是如何处理的？</p><p><strong>A：</strong>权重矩阵是Transformer网络的参数之一，它们在训练过程中被学习得到。查询（query）、键（key）和值（value）都是通过将输入序列中的每个元素与不同的权重矩阵相乘来计算得到的。</p><p>在解码器的每一层中，查询（query）来自于解码器的前一层的输出，而键（key）和值（value）来自于编码器的输出。多头注意力子层将查询（query）、键（key）和值（value）分成多个头，每个头分别进行自注意力或编码器-解码器注意力计算，然后将所有头的结果拼接起来作为最终输出。</p><p>在编码器-解码器注意力计算中，首先计算查询（query）和键（key）之间的点积来确定每个值（value）的权重，然后对所有值（value）进行加权求和来得到输出。这样，解码器就可以根据输入序列中不同位置的相关性来分配不同的权重，从而更好地捕捉序列中不同位置之间的关系。</p><p>因此，在解码器的每一层中，键（key）和值（value）都是通过编码器-解码器注意力计算来处理的。它们用于确定每个值（value）的权重，并对所有值（value）进行加权求和来得到输出。</p><hr><p>transformer的训练产物是权重矩阵。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>更加完善的爬虫 plus</title>
    <link href="/2023/05/28/%E6%9B%B4%E5%8A%A0%E5%AE%8C%E5%96%84%E7%9A%84%E7%88%AC%E8%99%AB-plus/"/>
    <url>/2023/05/28/%E6%9B%B4%E5%8A%A0%E5%AE%8C%E5%96%84%E7%9A%84%E7%88%AC%E8%99%AB-plus/</url>
    
    <content type="html"><![CDATA[<p>算上注释，和一些意义不明的回车，大概五百行。</p><p>总之就是：</p><ul><li>使用<code>controller</code>控制页面的切换，实现了<code>return</code>，而且不用像之前一样重复实例化多个窗口（在connect里面实时实例化）。</li><li>优化了UI的布局。</li><li>进行了exe打包</li><li>增加了功能：<ul><li>使用jieba进行分词</li><li>使用word2vec进行 句子-词向量 的转化</li><li>使用pandas将测到的结果写入csv文件</li></ul></li></ul><h2 id="Controller-控制器"><a href="#Controller-控制器" class="headerlink" title="Controller 控制器"></a>Controller 控制器</h2><p>核心是Qt的信号量机制。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 利用一个控制器来控制页面的跳转</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Controller</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-comment"># 跳转到 main 窗口</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show_main</span>(<span class="hljs-params">self</span>):<br>        self.main = mainpage()<br>        self.main.switch_window1.connect(self.show_add_url) <span class="hljs-comment"># 信号量关联</span><br>        self.main.switch_window2.connect(self.show_crawler)<br>        self.main.show()<br><br>    <span class="hljs-comment"># 跳转到search窗口, 注意关闭原页面</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show_add_url</span>(<span class="hljs-params">self</span>):<br>        self.add_url = addurl()<br>        self.add_url.switch_window1.connect(self.show_main)<br>        self.add_url.switch_window1.connect(self.add_url.close)<br>        self.main.close()<br>        self.add_url.show()<br>        <br>     <span class="hljs-comment">#跳转到 DisFac 窗口, 注意关闭原页面</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show_crawler</span>(<span class="hljs-params">self</span>):<br>        self.crawler = crawler()<br>        self.crawler.switch_window1.connect(self.show_main)<br>        self.crawler.switch_window1.connect(self.crawler.close)<br>        self.main.close()<br>        self.crawler.show()<br></code></pre></td></tr></table></figure><br>可以看到，函数中调用的<code>self.xxx.switch_window1</code>是原类中的一个<code>pyqtSignal()</code>对象，本质是Qt使用的信号量。在类的开头进行实例化：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">switch_window1=pyqtSignal()<br></code></pre></td></tr></table></figure><br>实例化后就可以调用其中的<code>emit()</code>方法，在这里，方便起见，我另外设置了一个方法来调用。</p><p>具体内容为：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">return_to_main</span>(<span class="hljs-params">self</span>):<br>    self.switch_window1.emit()<br></code></pre></td></tr></table></figure></p><p>而与之对应，在主页面也有对应方法，用于和对应的跳转按钮对应起来：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">switch_window1=pyqtSignal()<br>switch_window2=pyqtSignal()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">jump_to_add_url</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;jump to add url&#x27;</span>)<br>    self.switch_window1.emit()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">jump_to_crawler</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;jump to crawler&#x27;</span>)<br>    self.switch_window2.emit()<br></code></pre></td></tr></table></figure><br>总之就是，使用<code>pyqtSignal()</code>对象中的<code>emit()</code>方法进行跳转。在<code>Controller</code>内，这个<code>pyqtSignal()</code>对象应该和形如<code>show_add_url</code>的方法对应起来。</p><h2 id="UI的优化"><a href="#UI的优化" class="headerlink" title="UI的优化"></a>UI的优化</h2><p>主页：<br><img src="/img/QQ截图20230528230605.png" alt="主页"></p><p>添加url：<br><img src="/img/QQ截图20230528230840.png" alt="添加url"></p><p>爬取：<br><img src="/img/QQ截图20230528230821.png" alt="爬取"></p><h2 id="exe打包"><a href="#exe打包" class="headerlink" title="exe打包"></a>exe打包</h2><p>使用了<code>pyinstaller</code>，值得注意的是，当前虚拟环境（我用了<code>anaconda</code>）里，没有用到的包似乎也会被一并打包，导致最终的<code>exe</code>巨大一个。</p><p>要是需要小一点的<code>exe</code>，可以新建虚拟环境，并尽量少地安装包。</p><h2 id="readline-和-rstrip-“-n”-和-split-‘-‘"><a href="#readline-和-rstrip-“-n”-和-split-‘-‘" class="headerlink" title="readline 和 rstrip(“\n”) 和 split(‘ ‘)"></a>readline 和 rstrip(“\n”) 和 split(‘ ‘)</h2><p><code>readline</code>真的是只读一行，读到回车为止。</p><p><code>rstrip</code>是一个字符串的方法，可以删去字符串首尾的多余字符。例如<code>skipwords[i] = skipwords[i].rstrip(&quot;\n&quot;)</code></p><p><code>split</code>也是一个字符串的方法，可以以参数为界，将字符串切割为列表。</p><h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><p><code>cutwordslist += [word for word in jieba.cut(word_read, cut_all=False) if word not in skipwords]</code></p><p><code>C for A in B</code>，用中括号括起来就是一个列表，甚至可以用if进行跳过。很神奇。</p><h2 id="eval-和-dict"><a href="#eval-和-dict" class="headerlink" title="eval 和 dict"></a>eval 和 dict</h2><p>理论上<code>dict</code>可以将字符串转化为字典，但是我从来没使用成功过，反倒是一直在用<code>eval</code>。</p><h2 id="jieba-分词"><a href="#jieba-分词" class="headerlink" title="jieba 分词"></a>jieba 分词</h2><p><code>cutwordslist += [word for word in jieba.cut(word_read, cut_all=False) if word not in skipwords]</code></p><p>jieba.cut方法，输入需要切割的字符串，指定切割模式，返回一个列表。</p><h2 id="word2vec"><a href="#word2vec" class="headerlink" title="word2vec"></a>word2vec</h2><p>首先加载模型，<code>w2v_model = Word2Vec.load(&#39;aaa.model&#39;)</code></p><p>然后，由于我使用的向量是一百二十八维的（主要是因为模型就是这个维数），所以需要更新大小。</p><p><code>vec = numpy.zeros(size).reshape((1, size))</code></p><p>要想获得一句话的词向量，只需要将词汇的词向量全部相加。</p><p><code>vec += w2v_model.wv[word].reshape((1, size))</code></p><p>获得vec之后写入即可。</p><h2 id="pandas-写入-csv"><a href="#pandas-写入-csv" class="headerlink" title="pandas 写入 csv"></a>pandas 写入 csv</h2><p><code>pandas</code>使用的数据类型叫做<code>DataFrame</code>，初始化的时候需要提供数据和标签，<code>data</code>和<code>columns</code>。</p><p><code>data=pandas.DataFrame(data=[j for j in range(128)],columns=[&#39;index&#39;])</code></p><p>写入新数据是<code>data[line]=vec[0]</code>，其中<code>line</code>为句子本身的字符串，作为索引，<code>vec</code>是一个列表套列表所以不能直接用，需要<code>vec[0]</code>。</p><p>如果vec维数不够128维就会出现报错，以防万一，使用<code>if</code>判断，然后<code>data[line]=[0 for k in range(128)]</code>进行补零。</p><p>最后写入：<code>data.to_csv(&#39;data_final_&#39;+self.site+&#39;.csv&#39;)</code>。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>有GUI的爬虫plus</title>
    <link href="/2023/05/22/%E6%9C%89GUI%E7%9A%84%E7%88%AC%E8%99%ABplus/"/>
    <url>/2023/05/22/%E6%9C%89GUI%E7%9A%84%E7%88%AC%E8%99%ABplus/</url>
    
    <content type="html"><![CDATA[<p>代码比较多，优化空间也很大，就不放上来了。</p><p>聊聊写的时候碰到的问题和解决。</p><h2 id="QT使用的基本思路"><a href="#QT使用的基本思路" class="headerlink" title="QT使用的基本思路"></a>QT使用的基本思路</h2><p>首先实例化组件：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">self.label_name = QLabel(<span class="hljs-string">&#x27;name&#x27;</span>)<br>self.edit_name = QComboBox()<br>self.label_num = QLabel(<span class="hljs-string">&#x27;page num&#x27;</span>)<br>self.edit_page_num = QComboBox()<br></code></pre></td></tr></table></figure><br>层：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">self.lay_h1=QHBoxLayout()<br></code></pre></td></tr></table></figure><br>向层中添加组件：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">self.lay_h1.addWidget(self.label_name)<br>self.lay_h1.addWidget(self.label_num)<br>self.lay_h1.addWidget(self.label_url)<br>self.lay_h2.addWidget(self.edit_name)<br>self.lay_h2.addWidget(self.edit_page_num)<br>self.lay_h2.addWidget(self.edit_url)<br>self.lay_h3.addWidget(self.btn_crawl)<br>self.lay_h3.addWidget(self.btn_update)<br>self.lay_h3.addWidget(self.btn_exit)<br><br></code></pre></td></tr></table></figure><br>向窗口添加层:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">self.lay_v1=QVBoxLayout()<br>self.lay_v1.addLayout(self.lay_h1)<br>self.lay_v1.addLayout(self.lay_h2)<br>self.lay_v1.addLayout(self.lay_h3)<br></code></pre></td></tr></table></figure><br>定义按钮行为:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">self.btn_crawl.clicked.connect(self.crawl)<br><span class="hljs-comment"># self.btn_exit.clicked.connect(main.show)</span><br>self.btn_update.clicked.connect(self.update)<br>self.btn_exit.clicked.connect(self.close)<br></code></pre></td></tr></table></figure><br>设置下拉框等等：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 下拉框</span><br>self.edit_name.addItems(<span class="hljs-built_in">list</span>(url_dict.keys())) <span class="hljs-comment"># 认列表，不认字典</span><br>self.edit_page_num.addItems(<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>)) <span class="hljs-comment"># 好事情</span><br></code></pre></td></tr></table></figure><br>最后完成窗口设置：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">self.setLayout(self.lay_v1)<br></code></pre></td></tr></table></figure></p><h2 id="如何多py文件开发？"><a href="#如何多py文件开发？" class="headerlink" title="如何多py文件开发？"></a>如何多py文件开发？</h2><p>我也不清楚这个应该怎么称呼，总之就是多个源文件，但源文件之间可以使用其他文件的代码。要称呼的话应该是“工程”。</p><p>如果需要使用其他文件里的代码，在文件开头<code>import</code>文件名即可，就当作库来使用。</p><h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><p>也就是<code>if __name__ == &#39;__main__&#39;:</code>这句话，<code>__name__</code>是自带变量，获取文件名。</p><h2 id="使用pyqt窗口"><a href="#使用pyqt窗口" class="headerlink" title="使用pyqt窗口"></a>使用pyqt窗口</h2><p>需要实例化，即<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">app = QApplication(sys.argv)<br>addurl_test=addurl()<br>crawl_test=crawler()<br>main = mainpage(addurl_test,crawl_test)<br>main.show()<br>sys.exit(app.exec_())<br></code></pre></td></tr></table></figure><br>实例化了几个窗口，在实例化时，会调用<code>__init__</code>方法，但是没有调用<code>show</code>方法，所以并不会显示。</p><h2 id="关于窗口切换"><a href="#关于窗口切换" class="headerlink" title="关于窗口切换"></a>关于窗口切换</h2><p>一开始是试着通过调用<code>close</code>和<code>show</code>实现窗口切换，但是发现类的方法之间并不能使用主函数中实例化的窗口，需要传送参数，但是<code>connect</code>方法传参会出现<code>TypeError: argument 1 has unexpected type &#39;NoneType&#39;</code>的问题，于是不了了之。</p><p>后面参考其他同学的代码，发现他们是通过<strong>在分页面的类内插入</strong>形如<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">switch_window1=QtCore.pyqtSignal()<br>self.switch_window1.emit()<br></code></pre></td></tr></table></figure><br>的语段来实现。</p><p>在主界面似乎并没有这种语段。</p><h2 id="需要更改父类的方法"><a href="#需要更改父类的方法" class="headerlink" title="需要更改父类的方法"></a>需要更改父类的方法</h2><p>直接写就是覆盖，如果需要在父类方法中插入语句，可以</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">super</span>().show()<br>    <span class="hljs-built_in">print</span>(self.__class__.__name__)<br></code></pre></td></tr></table></figure><p>使用<code>super()</code>。</p><h2 id="QT自带计时器"><a href="#QT自带计时器" class="headerlink" title="QT自带计时器"></a>QT自带计时器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">timer=QTimer(self)<br>timer.start(<span class="hljs-number">5000</span>)<br>timer.stop()<br></code></pre></td></tr></table></figure><p>计时器也是一个对象（毕竟面向对象），是需要实例化的。</p><h2 id="“抓取成功”提示"><a href="#“抓取成功”提示" class="headerlink" title="“抓取成功”提示"></a>“抓取成功”提示</h2>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>爬虫 plus</title>
    <link href="/2023/05/18/Python-%E7%88%AC%E8%99%AB-plus/"/>
    <url>/2023/05/18/Python-%E7%88%AC%E8%99%AB-plus/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 导入所需模块</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> _exit,path,remove,system<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> ctime<br><span class="hljs-comment"># import json</span><br><br>cookie = <span class="hljs-string">&#x27;this is cookies&#x27;</span>                       <br>cookies = &#123;i.split(<span class="hljs-string">&quot;=&quot;</span>)[<span class="hljs-number">0</span>]:i.split(<span class="hljs-string">&quot;=&quot;</span>)[-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cookie.split(<span class="hljs-string">&quot;; &quot;</span>)&#125;<br><br>headers = &#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;this is User-Agent&#x27;</span><br>&#125;<br><br>site_url=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;site.txt&#x27;</span>,<span class="hljs-string">&#x27;r+&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-comment"># 可读可写</span><br><br>url_read=site_url.read()<br>url_dict=<span class="hljs-built_in">eval</span>(url_read) <span class="hljs-comment"># 转化为字典</span><br><span class="hljs-comment"># site=set(url_dict) # 这样会输出集合，不方便遍历</span><br>site=<span class="hljs-built_in">list</span>(url_dict.keys()) <span class="hljs-comment"># 需要从dict_key强转为list</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_site</span>():<br>    <span class="hljs-built_in">print</span>(url_dict)<br>    url_dict[<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;输入站点代号：&#x27;</span>)]=<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入站点url：&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(url_dict)<br>    site_url.seek(<span class="hljs-number">0</span>)<br>    site_url.write(<span class="hljs-built_in">str</span>(url_dict))<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-comment"># system(&#x27;cls&#x27;)</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-1.add new site&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;0.quit&#x27;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(url_dict)):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(i+<span class="hljs-number">1</span>)+<span class="hljs-string">&#x27;.&#x27;</span>+site[i])<br>    num=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入站点编号：&#x27;</span>))<br>    <span class="hljs-keyword">if</span> num==<span class="hljs-number">0</span>:<br>        site_url.close()<br>        _exit(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">if</span> num==-<span class="hljs-number">1</span>:<br>        add_site()<br>        site_url.seek(<span class="hljs-number">0</span>)<br>        url_read=site_url.read()<br>        site=<span class="hljs-built_in">list</span>(url_dict.keys()) <span class="hljs-comment"># 需要从dict_key强转为list</span><br>        <span class="hljs-keyword">continue</span><br>    page_num=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入抓取页数：&#x27;</span>))<br>    file_path = <span class="hljs-string">&#x27;data&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+site[num-<span class="hljs-number">1</span>]+<span class="hljs-string">&#x27;.txt&#x27;</span><br>    <span class="hljs-keyword">if</span> path.exists(file_path):<br>        remove(file_path)<br>    <br>    f=<span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;a&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    f.write(<span class="hljs-string">&#x27;抓取时间：&#x27;</span>+ctime()+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    f.close()<br><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(page_num):<br>        f=<span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;a&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        f.write(<span class="hljs-string">&#x27;\n\n第&#x27;</span>+<span class="hljs-built_in">str</span>(page+<span class="hljs-number">1</span>)+<span class="hljs-string">&#x27;页：\n&#x27;</span>)<br>        f.close()<br><br>        url = url_dict[site[num-<span class="hljs-number">1</span>]]+<span class="hljs-built_in">str</span>(page+<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(url)<br>        response = requests.get(url, headers=headers,cookies=cookies)<br>        soup = BeautifulSoup(response.text, <span class="hljs-string">&#x27;lxml&#x27;</span>)<br>        <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">&#x27;tbody&#x27;</span>): <br>            title = each.find(<span class="hljs-string">&#x27;a&#x27;</span>,class_ = <span class="hljs-string">&#x27;topic&#x27;</span>).get_text(strip=<span class="hljs-literal">True</span>)<br>            f=<span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;a&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            f.write(<span class="hljs-string">&#x27;\n&#x27;</span>.join([title]))<br>            f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            f.close()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;response.status_code ==&#x27;</span>,response.status_code)<br>site_url.close()<br></code></pre></td></tr></table></figure><h2 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h2><p>增加了通过文件读写来更新<code>site</code>即站点列表；</p><p>增加了交互式查询的功能；</p><p>增加了抓取时间和抓取页面的页数（如果是用于数据分析，那这个属于是多余，但如果爬出来的结果是给人看的，那就显得很有必要了。）</p><h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><h3 id="文件的打开方式"><a href="#文件的打开方式" class="headerlink" title="文件的打开方式"></a>文件的打开方式</h3><p>只介绍我用到的两种，和试图用的一种</p><p>‘r+’：可读可写</p><p>‘a’：追加内容</p><p>‘w+’：打开即清空</p><p>前两种的差别在于文件指针初始位置：</p><ul><li>‘r+’初始在文件头，read操作将其挪到文件尾，导致第二次read就读不出东西。这种时候就可以通过<code>seek()</code>方法更改文件指针位置，例如<code>seek(0)</code>就是挪到文件开头。</li><li>‘a’初始在文件尾，因此我们需要<code>if path.exists(file_path): remove(file_path)</code>来进行伪覆写。</li></ul><p>‘w+’不是很讲理，将打开的文件视作全新文件，即使没有任何操作也会清空文件内容。</p><h3 id="python各种对象和字符串对象的转化"><a href="#python各种对象和字符串对象的转化" class="headerlink" title="python各种对象和字符串对象的转化"></a>python各种对象和字符串对象的转化</h3><p>其实字符串也是对象，但字符串比较偏朴素，和花里胡哨的<code>dict</code>、<code>list</code>、<code>set</code>什么的完全比不了。</p><p>其他对象可以使用<code>str()</code>转化为字符串，字符串也可以通过<code>list()</code>（列表）、<code>eval</code>（字典）等方法转化为其它类型的对象。</p><p>其他类型的强制类型转化也是类似，例如字符串可以转化为整型数，’1’可以转化为 1。</p><p>对 C 语言起手的人来说堪称魔法。</p><h3 id="获取目前时间"><a href="#获取目前时间" class="headerlink" title="获取目前时间"></a>获取目前时间</h3><p>使用<code>time</code>库的<code>ctime()</code>方法。</p><h3 id="连缀"><a href="#连缀" class="headerlink" title="连缀"></a>连缀</h3><p><code>&#39;\n&#39;.join([title])</code>，意思是通过换行符号将<code>join</code>里字符串序列连接起来。</p><p>收回前言，<code>python</code>字符串也挺花里胡哨的。</p><h3 id="python中的for"><a href="#python中的for" class="headerlink" title="python中的for"></a>python中的for</h3><p>看上去和 C 里的 <code>for(i=0;i&lt;n;i++);</code>很像，但这里的意思是选取系列中的元素，对所有元素进行以下操作。</p><p>如果把系列，也就是<code>soup.find_all(&#39;tbody&#39;)</code>换成<code>range()</code>，那就和 C 类似了。</p><p>另外，<code>python</code>的<code>for</code>是可以使用<code>else</code>的。<br><figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">&#x27;tbody&#x27;</span>): <br>    title = each.find(<span class="hljs-string">&#x27;a&#x27;</span>,class_ = <span class="hljs-string">&#x27;topic&#x27;</span>).get_text(strip=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><br>果然面向过程到面向对象的思维转化是个艰难的过程。</p><h3 id="从右向左执行"><a href="#从右向左执行" class="headerlink" title="从右向左执行"></a>从右向左执行</h3><p><code>url_dict[input(&#39;输入站点代号：&#39;)]=input(&#39;请输入站点url：&#39;)</code>，会先让你输入url，再输入站点代号。反正我觉得没差，就没动它了。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Python爬虫构建</title>
    <link href="/2023/05/17/Python%E7%88%AC%E8%99%AB%E6%9E%84%E5%BB%BA/"/>
    <url>/2023/05/17/Python%E7%88%AC%E8%99%AB%E6%9E%84%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 导入所需模块</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>cookie = <span class="hljs-string">&#x27;this is cookies&#x27;</span>                       <br>cookies = &#123;i.split(<span class="hljs-string">&quot;=&quot;</span>)[<span class="hljs-number">0</span>]:i.split(<span class="hljs-string">&quot;=&quot;</span>)[-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cookie.split(<span class="hljs-string">&quot;; &quot;</span>)&#125;<br>headers = &#123;<br><span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;this is user-agent&#x27;</span>,<br>&#125;<br><span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    url = &#123;<span class="hljs-string">&quot;ng2&quot;</span>:<span class="hljs-string">&#x27;https://bbs.nga.cn/thread.php?fid=-447601&amp;page=%s&#x27;</span> %page,<br>        <span class="hljs-string">&quot;ark&quot;</span>:<span class="hljs-string">&#x27;https://bbs.nga.cn/thread.php?fid=-34587507&amp;page=%s&#x27;</span> %page&#125;<br>    response = requests.get(url[<span class="hljs-string">&#x27;ark&#x27;</span>], headers=headers,cookies=cookies)<br>    soup = BeautifulSoup(response.text, <span class="hljs-string">&#x27;lxml&#x27;</span>)<br>    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">&#x27;tbody&#x27;</span>): <br>        title = each.find(<span class="hljs-string">&#x27;a&#x27;</span>,class_ = <span class="hljs-string">&#x27;topic&#x27;</span>).get_text(strip=<span class="hljs-literal">True</span>)<br>        f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;ark&#x27;</span>+<span class="hljs-string">&#x27;.txt&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        f.write(<span class="hljs-string">&#x27;\n&#x27;</span>.join([title]))<br>        f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        f.close()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;response.status_code ==&#x27;</span>,response.status_code)<br></code></pre></td></tr></table></figure><h2 id="关于爬虫"><a href="#关于爬虫" class="headerlink" title="关于爬虫"></a>关于爬虫</h2><p>本质是一个访问网站，提取某些信息的程序。</p><p>“爬取”这个动词描述获取数据的过程。其实比起爬取，爬虫的行为更像是递交一个申请表，申请到一本<code>html</code>文件，然后对着这本<code>html</code>文件写了一篇摘要呈现给用户。</p><p>理论上说，人来通过浏览器手动记录数据本质和爬虫一样，但爬虫效率高，容易把服务器爬出问题。</p><h2 id="关于我这个爬虫"><a href="#关于我这个爬虫" class="headerlink" title="关于我这个爬虫"></a>关于我这个爬虫</h2><p>用来爬<code>ngabbs.com</code>的某些版面帖子标题，用于数据分析，绝对不是干什么坏事。</p><h2 id="解读"><a href="#解读" class="headerlink" title="解读"></a>解读</h2><p>首先我是使用了<code>beautifulsoup4</code>和<code>request</code>库。不得不说<code>python</code>的库是真的方便。<br><figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br></code></pre></td></tr></table></figure><br>然后我需要清理一下之前生成的残留文件，因此我需要<code>os</code>来获取当前路径下的文件并移除：<br><figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br>path = <span class="hljs-string">&#x27;data&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;ark&#x27;</span>+<span class="hljs-string">&#x27;.txt&#x27;</span><br><span class="hljs-keyword">if</span> os.path.exists(path):<br>    os.remove(path)<br></code></pre></td></tr></table></figure><br>然后是构建请求。</p><p>请求需要<code>Cookies</code>，否则会报403错误（无权限）；</p><p><code>Cookies</code>不能直接提交，需要转换为字典；</p><p>请求需要请求头，也就是<code>headers</code>，里面包含<code>User-Agent</code>。一开始我不知道，把<code>Cookies</code>也放在了里面。事实上<code>Cookies</code>应该单独提交；</p><p>请求需要<code>url</code>，因为我需要不同版面，不同页数的数据，因此构建了一个字典，使用助记词对应<code>url</code>。令我惊叹的、很人性化的一点是，可以使用<code>%s</code>和追加<code>%page</code>来实现变参的作用；</p><p>最后，我们调用了<code>get</code>方法，得到的是<code>response</code>。</p><p>然后使用<code>BeautifulSoup</code>对其进行解码，得到<code>soup</code>。<br><figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">cookie = <span class="hljs-string">&#x27;this is cookies&#x27;</span>                       <br>cookies = &#123;i.split(<span class="hljs-string">&quot;=&quot;</span>)[<span class="hljs-number">0</span>]:i.split(<span class="hljs-string">&quot;=&quot;</span>)[-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cookie.split(<span class="hljs-string">&quot;; &quot;</span>)&#125;<br>headers = &#123;<br><span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;this is user-agent&#x27;</span>,<br>&#125;<br><span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    url = &#123;<span class="hljs-string">&quot;ng2&quot;</span>:<span class="hljs-string">&#x27;https://bbs.nga.cn/thread.php?fid=-447601&amp;page=%s&#x27;</span> %page,<br>        <span class="hljs-string">&quot;ark&quot;</span>:<span class="hljs-string">&#x27;https://bbs.nga.cn/thread.php?fid=-34587507&amp;page=%s&#x27;</span> %page&#125;<br>    response = requests.get(url[<span class="hljs-string">&#x27;ark&#x27;</span>], headers=headers,cookies=cookies)<br>    soup = BeautifulSoup(response.text, <span class="hljs-string">&#x27;lxml&#x27;</span>)<br></code></pre></td></tr></table></figure><br>然后是写入文件，这部分折磨了我好久。我一开始的版本是：<br><figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">&#x27;tbody&#x27;</span>): <br>    title = each.find(<span class="hljs-string">&#x27;a&#x27;</span>,class_ = <span class="hljs-string">&#x27;topic&#x27;</span>).get_text(strip=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;ark&#x27;</span>+<span class="hljs-string">&#x27;.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">&#x27;\n&#x27;</span>.join([title]))<br>        f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        f.close()<br></code></pre></td></tr></table></figure><br>但这样写会让文件的写入覆盖前一个，也就是说，无数轮循环结束，文件里只能保留最后一个标题。</p><p>但我不知道为什么，怀疑是<code>with open(&#39;data&#39;+&#39;_&#39;+&#39;ark&#39;+&#39;.txt&#39;, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f:</code>的问题。我将其改成了<code>f = open(&#39;data&#39;+&#39;_&#39;+&#39;ark&#39;+&#39;.txt&#39;, &#39;w&#39;, encoding=&#39;utf-8&#39;)</code>，但还是同样的问题。</p><p>其实我的怀疑是对的，但没怀疑到点子上。</p><p>事实上是这个：</p><figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;ark&#x27;</span>+<span class="hljs-string">&#x27;.txt&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br></code></pre></td></tr></table></figure><p>注意到区别了吗？</p><p>‘a’ 和 ‘w’。</p><p>我应该再多读读文件操作那章的。<br><figure class="highlight python"><figcaption><span>3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;response.status_code ==&#x27;</span>,response.status_code)<br></code></pre></td></tr></table></figure><br>这句不用多说，是打印状态值。一开始疯狂报403、411，终于稳定报200之后，我真的是甚是欣慰。</p><h3 id="爬取的成果如下：（碍于篇幅，只展示第一页的）"><a href="#爬取的成果如下：（碍于篇幅，只展示第一页的）" class="headerlink" title="爬取的成果如下：（碍于篇幅，只展示第一页的）"></a>爬取的成果如下：（碍于篇幅，只展示第一页的）</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs text">[公告] [四周年活动第一弹]分享罗德岛的年度工作报告，赢版面声望！(抽30位幸运坛友赠送周边一份！)<br>[ROLL] 明日方舟四周年庆典签到活动 抽取iPad手办京东卡等周边大奖<br>[剧情讨论] [闲谈交流] 关于“坠落的星星”，我发现一个华点<br>黄铁峡谷18：“弑君者III：狼牙”+“源石环境：活性III”<br>[可能火星]如果下个月是异格阿葬的话，他就是第77个六星<br>[全新开业]龙门茶馆 - 一盅两盏，畅所欲言<br>[提问]新人放入坑，有一堆疑问<br>汐斯塔扭蛋广场<br>[安科/安价]出场文物是各位干员的泰拉博物馆奇妙夜(博士升任司岁台头头)<br>[失智安科]博士发现了一个奇怪的法阵<br>[博all]随机挑选一个男干员当小妈，但是博士想追求自己的小妈<br>[随缘安科][棘流勇境]极境是要成为魔法帝的男人！<br>[ex8突袭]令人绝望的场景<br>[ROLL] 来roll送一块手工小莫流麻！<br>帮助选择困难症萌新<br>回忆一些老cp的发展，非常主观<br>莱塔尼亚大图书馆<br>[同人文] 《边缘》明日方舟x死亡空间<br>[短篇同人](阿米娅向)雷姆必拓的兔子们<br>[渣文笔][同人文]凯尔希之家<br>[葬博] [送葬人氵] 试图坚持三十天每日一葬<br>[提问] 对萌新来说，这次活动商店兑换优先级是什么样的<br>[闲谈交流] 保全派驻的一点正体验(仅限模拟器)<br>[保全氵]太恶心了<br>[破事氵]虽然不是什么特别的数字，但怎么总觉得这龙门币在骂我自己<br>[氵]突然在想，为什么谢拉格二期的中心不能是崖心呢？<br>为啥突袭0—1这么难啊，把我关了<br>陈陈陈陈陈陈是否还有第二异格形态的可能？<br>保全任务是不是有bug<br>和海愿绝配<br>[闲谈交流]各圈各平台最火CP一览，方舟上榜<br>[剧情讨论] 所以老干猫到底有没有自我意识<br>越来越喜欢叔叔了 因为我加班一个月了<br>才发现明日方舟干员列表的背景不是白色而是透明的<br>保全派驻是明日方舟最弱智最失败的模式，没有之一。<br>有没有基建大佬展示一下顶配基建收益<br>3月后入坑的人，没有夜刀玩肉鸽是不是很难受？<br>黄票不足 要换小火龙吗<br>卡西米尔竞技场<br>[突袭cws4](已过审)无限定，6人带阿消，操作简单，大部分时间在挂机<br>[泰拉记事社] #吉姆波顿 # 特里蒙晚间电波秀<br>[孤星]CW-S-1-AB到CW-S-4突袭摆完挂机，不过是小猪！<br>[中坚寻访]中坚甄选：05月18日 04:00 - 06月01日 03:59<br>[剧情氵]霍尔海雅与缪尔赛思人物对比分析<br>[攒抽氵]小刻也能看懂的零氪攒抽记录--《从大哥到缪缪》<br>[微考据][小车氵]Friston？神经科学？是你！——Friston 在现实世界的致敬/原型<br>[考据氵][抛砖引玉氵]谈“孤星”剧情中的科幻Neta(已更新DLC)<br>[活动奖励干员]重装-铁卫 Friston-3<br>[活动奖励服饰] //竞技之梦改装 - 正义骑士号<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2023年5月5日</title>
    <link href="/2023/05/04/2023%E5%B9%B45%E6%9C%885%E6%97%A5/"/>
    <url>/2023/05/04/2023%E5%B9%B45%E6%9C%885%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="关于阿里云服务器"><a href="#关于阿里云服务器" class="headerlink" title="关于阿里云服务器"></a>关于阿里云服务器</h2><p>让一个七个月的云服务器烂在手里还是太可惜了。</p><p><code>github</code>上看到一个很有意思的项目，<url><a href="https://github.com/jaywcjlove/reference">https://github.com/jaywcjlove/reference</a></url>，似乎非常非常适合镜像到自己的服务器上，作为时时刻刻、随时随地的便利参考。</p><p>好奇还有什么类似的项目。</p><p>关于云服务器直接部署页面……部署了<code>wordpress</code>博客，搭建了数据库，但是不会使用，不会操作，所以这么长时间就放任它烂在了手里。感觉对不起这个云服务器……属于是倒了大霉碰上了我。</p><p>另外，我的服务器是<code>2G+2G</code>配置，据同学说，这个配置跑 MC 似乎还是比较吃力的。</p><h2 id="关于VITS"><a href="#关于VITS" class="headerlink" title="关于VITS"></a>关于VITS</h2><p>论文还在读，笔记做的是纸质的。学习完成之后，打算一股脑传上来。</p><h2 id="关于课业"><a href="#关于课业" class="headerlink" title="关于课业"></a>关于课业</h2><div>            <input type="checkbox" disabled >1、信号与系统作业          </div><div>            <input type="checkbox" disabled >2、电磁场与波作业          </div><div>            <input type="checkbox" disabled checked="checked">3、美术鉴赏ppt          </div><div>            <input type="checkbox" disabled >4、神经网络导论期末大作业          </div><div>            <input type="checkbox" disabled >5、信号与系统课程设计          </div><div>            <input type="checkbox" disabled >6、python语言课程作业          </div><h2 id="关于勾选框的使用方法："><a href="#关于勾选框的使用方法：" class="headerlink" title="关于勾选框的使用方法："></a>关于勾选框的使用方法：</h2><p><strong>使用 hexo 的勾选框</strong><br><div>            <input type="checkbox" disabled >6、python语言课程作业          </div><br><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">&#123;% cb 6、python语言课程作业,false %&#125;<br><br>&#123;% cb text, checked?, incline? %&#125;<br>text：显示的文字<br>checked：默认是否已勾选，默认 false<br>incline: 是否内联（可以理解为后面的文字是否换行），默认 false<br>&#123;% cb false %&#125; 也可以只传入一个参数，文字写在后边（这样不支持外联）<br>内联就是不换行，外联就是换行。<br></code></pre></td></tr></table></figure></p><p><strong>使用 md 自带的勾选框</strong></p><ul><li>[ ] 这是未选择</li><li>[x] 这是选择</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">- [ ] 这是未选择<br>- [x] 这是选择<br>注意空格和 “ - ”<br></code></pre></td></tr></table></figure><h2 id="关于-hexo-博客的评论功能"><a href="#关于-hexo-博客的评论功能" class="headerlink" title="关于 hexo 博客的评论功能"></a>关于 hexo 博客的评论功能</h2><p>开启评论需要在主题配置中开启并指定评论模块：</p><pre><code class="hljs">post:comments:    enable: true    type: disqus</code></pre><p>然后在下方还要设置对应评论模块的参数，比如 disqus 对应设置：</p><pre><code class="hljs">disqus:shortname: fluid</code></pre><p>当前支持的评论插件如下：</p><p>Valine (opens new window):基于 LeanCloud</p><p>Waline (opens new window): 从 Valine 衍生而来，额外增加了服务端和多种功能</p><p>Gitalk (opens new window): 基于 GitHub Issues</p><p>Utterances (opens new window): 基于 GitHub Issues</p><p>Disqus (opens new window): 基于第三方的服务</p><p>畅言 (opens new window): 基于第三方的服务</p><p>来必力(Livere) (opens new window): 基于第三方的服务</p><p>Remark42 (opens new window): 需要自托管服务端</p><p>Twikoo (opens new window): 基于腾讯云开发</p><p>Cusdis (opens new window): 基于第三方服务或自托管服务</p><p>Giscus (opens new window): 基于 GitHub Discussion</p><p>使用方式和参数设置请点击上面链接查看各自的文档。</p><p>若想自己添加新的评论插件，可通过自定义功能加入 <code>&lt;script&gt;</code>，并判断是否存在 #comments 元素进行挂载。</p><p><strong>TIP</strong></p><p>国内用户推荐使用 Valine、Waline 或者 twikoo</p><p>如果设置后评论模块没有显示，说明配置没有完成，或者配置有误出现报错（请在浏览器控制台查看具体报错）</p><p>如果想在某个文章页关闭评论，或者想在某个自定义页面开启评论，可以通过在 <code>Front-matter (opens new window)</code>设置 <code>comment: bool</code> 来控制评论开关，或者通过 <code>comment: &#39;type&#39;</code> 来开启指定的评论插件。</p><p>例如在关于页开启并指定评论插件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">关于页</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">about</span><br><span class="hljs-attr">index_img:</span> <span class="hljs-string">/img/example.jpg</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2019-10-10 10:00:00</span><br><span class="hljs-attr">comment:</span> <span class="hljs-string">&#x27;valine&#x27;</span><br><span class="hljs-meta">---</span><br><span class="hljs-string">以下是正文内容</span><br></code></pre></td></tr></table></figure><h3 id="总结一下就是"><a href="#总结一下就是" class="headerlink" title="总结一下就是"></a>总结一下就是</h3><ul><li>主题内配置开启与参数。<ul><li>高级用户可以通过自己的<code>script</code>客制化。</li></ul></li><li>可以在页面的开头设置本页面是否开启评论、开启哪种方式的评论。</li></ul><h3 id="使用-gittalk-评论"><a href="#使用-gittalk-评论" class="headerlink" title="使用 gittalk 评论"></a>使用 gittalk 评论</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">gitalk:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">#启用gitalk</span><br>  <span class="hljs-attr">github_id:</span>   <span class="hljs-comment">#github帐号 例：CodeHaotian</span><br>  <span class="hljs-attr">id:</span> <span class="hljs-string">location.pathname</span>  <span class="hljs-comment">#此设置参照下文常见问题说明</span><br>  <span class="hljs-attr">repo:</span>   <span class="hljs-comment">#存放评论的仓库名称</span><br>  <span class="hljs-attr">client_id:</span>   <span class="hljs-comment">#application的id，即上文Client ID</span><br>  <span class="hljs-attr">client_secret:</span>  <span class="hljs-comment">#application的密码，即上文Client Secret</span><br>  <span class="hljs-attr">admin_user:</span>  <span class="hljs-comment">#页面显示联系**初始化评论 例：CodeHaotian</span><br>  <span class="hljs-attr">distraction_free_mode:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Facebook-like distraction free mode</span><br>  <span class="hljs-comment"># Gitalk&#x27;s display language depends on user&#x27;s browser or system environment</span><br>  <span class="hljs-comment"># If you want everyone visiting your site to see a uniform language, you can set a force language value</span><br>  <span class="hljs-comment"># Available values: en | es-ES | fr | ru | zh-CN | zh-TW</span><br>  <span class="hljs-attr">language:</span> <span class="hljs-string">zh-CN</span><br></code></pre></td></tr></table></figure><p>这种方法需要一个github application，一个github repo，一个github账号。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Numpy 和 Matplotlib 的使用</title>
    <link href="/2023/04/26/Numpy-%E5%92%8C-Matplotlib-%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/04/26/Numpy-%E5%92%8C-Matplotlib-%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>首先，<code>import</code>一下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br></code></pre></td></tr></table></figure></p><h1 id="Numpy"><a href="#Numpy" class="headerlink" title="Numpy"></a>Numpy</h1><pre><code class="hljs">Numpy是Python的一个科学计算的库，提供了矩阵运算的功能，其一般与Scipy、matplotlib一起使用。其实，list已经提供了类似于矩阵的表示形式，不过numpy为我们提供了更多的函数。</code></pre><p><strong>操作的对象有两种，一种是 <code>N 维数组对象 ndarray</code>，另一种是<code>矩阵 matrix</code></strong>。</p><p>数据类型也很多，虽然不需要像C一样指定，但数据确实是有数据类型的。</p><h3 id="创建一个-ndarry-对象"><a href="#创建一个-ndarry-对象" class="headerlink" title="创建一个 ndarry 对象"></a>创建一个 ndarry 对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">numpy.array(<span class="hljs-built_in">object</span>, dtype = <span class="hljs-literal">None</span>, copy = <span class="hljs-literal">True</span>, order = <span class="hljs-literal">None</span>, subok = <span class="hljs-literal">False</span>, ndmin = <span class="hljs-number">0</span>)<br><span class="hljs-comment"># 必须的只有object，也就是数组对象，新建的 ndarry 内容和 object 完全一致。</span><br><span class="hljs-comment"># 可以输入多个 object，这样会被视为多维度 ndarry。</span><br><span class="hljs-comment"># </span><br><br>numpy.empty(shape, dtype = <span class="hljs-built_in">float</span>, order = <span class="hljs-string">&#x27;C&#x27;</span>)<br><br>numpy.asarray(a, dtype = <span class="hljs-literal">None</span>, order = <span class="hljs-literal">None</span>)<br><br>numpy.frombuffer(buffer, dtype = <span class="hljs-built_in">float</span>, count = -<span class="hljs-number">1</span>, offset = <span class="hljs-number">0</span>)<br><br>numpy.fromiter(iterable, dtype, count=-<span class="hljs-number">1</span>)<br><br>numpy.arange(start, stop, step, dtype)<br><br>np.linspace(start, stop, num=<span class="hljs-number">50</span>, endpoint=<span class="hljs-literal">True</span>, retstep=<span class="hljs-literal">False</span>, dtype=<span class="hljs-literal">None</span>)<br><br>np.logspace(start, stop, num=<span class="hljs-number">50</span>, endpoint=<span class="hljs-literal">True</span>, base=<span class="hljs-number">10.0</span>, dtype=<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2023年4月23日</title>
    <link href="/2023/04/23/2023%E5%B9%B44%E6%9C%8823%E6%97%A5/"/>
    <url>/2023/04/23/2023%E5%B9%B44%E6%9C%8823%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="关于so-vits-svc"><a href="#关于so-vits-svc" class="headerlink" title="关于so-vits-svc"></a>关于so-vits-svc</h1><p>首先，这是一个很牛逼的项目，极大简化了训练和音色迁移的过程，随着团队的接手，他们甚至加上了<code>webUI</code>。</p><p>但是。</p><p>他们把项目存了档，我不知道是什么让他们这么做的，但他们就是这么干了。我的评价是这是一个极其弱智且不负责任的行为，因为随着项目的存档，关于该项目的所有<code>issue</code>全部丢失。<code>issue</code>堪称这个项目的贡献者与使用者浓度最高的聚居地，绝大多数讨论都是在<code>issue</code>内进行，只有极少部分有典型性的问题会被搬运到其他平台。</p><p>关了之后，当人们碰到问题，或试图参与开发时，想上网寻找相关资料，在搜索引擎里敲入相关字眼，引入眼帘的永远是已经关闭了的<code>issue</code>。</p><p>无论如何，项目是他们的，我没有参与贡献，我只是一个学习者，他们确确实实有权决定这个项目的一切。</p><p>不过我也确确实实的很不爽。</p><hr><p>然后，黑泥结束，让我来夸夸这个项目。</p><p><code>VITS</code>是一个文字转语音的网络，最大的特征是对抗学习和时长预测。论文涉及到不少我本人知识范围以外的东西，在在试着读透。</p><p>我在<code>AutoDL</code>上租了一块<code>GPU</code>进行训练。</p><p>开始的时候，我以为本地并不足以支持音色迁移的工作完成，所以音色迁移都是交给云端来完成的，现在想想浪费了不少资源。</p><p>后来，我开始训练<a href="prts.wiki/w/翎羽">翎羽</a>的语音资料。</p><p>解释一下，翎羽是游戏明日方舟的一个角色，有中、日、韩、英四国语音，各有33条。一开始，我是使用日文语音进行训练的，日文语音总时长在三分钟左右。总共运行了63500步，然后我认为，仅仅三分钟的语音不足以构建出色的模型，于是停止了训练，导入了新的语音。</p><p>但是事实上，在这个项目中，模型和训练数据集语音直接挂钩，甚至可以说是一一对应，<strong>连顺序都不能替换</strong>。但我并没有意识到这一点，也没有人和我说，于是，我放弃了现有的训练数据集，后面的事情可想而知。</p><p>我跑了六万步的模型尚未完成，卡在<strong>不能训练</strong>和<strong>不能用</strong>之间，或者说，在我随机排列32条语音找到正确顺序之前，我无法对其进行进一步训练；同时由于训练步数原因，产生的音频电流声巨大，完全不能使用。</p><p>更糟糕的是，我使用的新训练集是四国语音复合的，也就是说实际上是四个人的语音素材。新训练集跑了三万多步，实际效果可谓是一团浆糊。</p><p>而我花了很久才意识到这一点。</p><h1 id="关于VITS"><a href="#关于VITS" class="headerlink" title="关于VITS"></a>关于VITS</h1><p>论文于三年前发表，属于是经典之一。正在读论文。</p><h1 id="关于其他类似项目"><a href="#关于其他类似项目" class="headerlink" title="关于其他类似项目"></a>关于其他类似项目</h1><p><a href="https://github.com/yxlllc/DDSP-SVC"><strong>DDSP-SVC</strong></a>。</p><p>按照介绍，这是一个针对低显存设备进行特别优化的项目。我本人的笔记本电脑是惠普的<code>战99</code>，使用的是<code>nvidia t600</code>入门级专业卡，内存只有可怜的4G。</p><p><em>要不然我为什么要租显卡……</em></p><p>还没用，但很期待。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2023年4月19日</title>
    <link href="/2023/04/19/2023%E5%B9%B44%E6%9C%8819%E6%97%A5/"/>
    <url>/2023/04/19/2023%E5%B9%B44%E6%9C%8819%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="亲爱的日记："><a href="#亲爱的日记：" class="headerlink" title="亲爱的日记："></a>亲爱的日记：</h2><h3 id="关于vits"><a href="#关于vits" class="headerlink" title="关于vits"></a>关于vits</h3><p>前几天发现了autodl这个GPU租用平台，于是充了15块钱，拿来跑vits。</p><p>至于原因，我之前一直觉得，自家电脑环境有问题、显存也不够，不足以支撑运算。于是租了三块，每块用多少扣多少钱，一个小时0.78元，可以说是相当便宜。</p><p>刚刚回忆了一下，之前监控的内存占用，是不是只有2G多，还有快到离谱（训练一分钟歌曲只需要零点几秒）的速度，又想起还有conda这个环境管理器，于是在自己电脑上试了试。</p><p>事实证明，能跑，而且，对显存要求很低。大概只占用了1G多。虽然确实慢了不少，78秒的音频文件，使用了61秒跑完。尽管确实很慢，但比我想象中还是快太多了。</p><p>这下不需要忧心忡忡等GPu空闲了。也不需要开着filezilla等着文件传输的完成。更不需要熄灯后用手机热点慢慢传数据了。</p><p>但是训练模型，应该还是需要更牛逼的GPU来干。</p><h3 id="关于spleeter"><a href="#关于spleeter" class="headerlink" title="关于spleeter"></a>关于spleeter</h3><p>这是一个分割音频中人声、伴奏的开源工程，只有11M左右。GUI版本甚至更小，只有10M。</p><p>我正在试图解读。</p><h3 id="还是关于vits"><a href="#还是关于vits" class="headerlink" title="还是关于vits"></a>还是关于vits</h3><p>vits和so-vits-svc有本质区别，虽然我把这俩混为一谈。vits，很小，只有14m；so-vits-svc，更小，小的超乎想象，只有9m。</p><p>但是事实上这俩确实是两码事。vits比较大可能是因为自带了测试样品。</p><p>so-vits-svc，SoftVC VITS Singing Voice Conversion。</p><p>vits，VITS，Conditional Variational Autoencoder with Adversarial Learning for End-to-End Text-to-Speech。</p><p>这是VITS的论文。</p><url>https://arxiv.org/abs/2106.06103</url><url>https://petertan303.github.io/img/2106.06103.pdf</url><h3 id="关于hexo博客插入pdf在线预览"><a href="#关于hexo博客插入pdf在线预览" class="headerlink" title="关于hexo博客插入pdf在线预览"></a>关于hexo博客插入pdf在线预览</h3><url>https://lizhening.github.io/posts/7d20ce7f/</url><p>简单概括就是：</p><ul><li>hexo-pdf插件。通过npm安装，注意是在hexo根目录下执行该语句。<code>npm install --save hexo-pdf</code></li><li><code>&#123;% pdf 链接 %&#125;</code>的形式插入即可，例如<code>&#123;% pdf http://7xov2f.com1.z0.glb.clouddn.com/bash_freshman.pdf %&#125;</code></li></ul><p>那么，我这个就是:<div class="row">    <embed src="https://petertan303.github.io/img/2106.06103.pdf" width="100%" height="550" type="application/pdf"></div></p><p><del>另外注意pdf可以直接放在source文件夹里面。</del><br>似乎并不可以……还是放在img文件夹里得了。</p><p><del>好吧，还是有点问题。</del><br>现在好了。真不错。</p><h3 id="正事"><a href="#正事" class="headerlink" title="正事"></a>正事</h3><ul><li>[x] py作业</li><li>[ ] it英语作业</li><li>[ ] 体测：周四</li><li>[ ] 数字系统实验报告（纸质）<ul><li>[ ] 实际实验</li><li>[ ] 仿真实验：延时灯</li></ul></li><li>[ ] 交通灯</li><li>[x] 美术鉴赏作业</li><li>[ ] 复习<ul><li>[ ] 人工智能基础</li><li>[ ] 电磁场与波</li></ul></li></ul><h3 id="不是正事"><a href="#不是正事" class="headerlink" title="不是正事"></a>不是正事</h3><p><code>希望可以找时间解决了……</code></p><ul><li>[ ] VITS论文阅读</li><li>[ ] VITS代码阅读</li><li>[ ] so-vits-svc代码阅读</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>关于香橙派显示屏</title>
    <link href="/2023/04/11/%E5%85%B3%E4%BA%8E%E9%A6%99%E6%A9%99%E6%B4%BE%E6%98%BE%E7%A4%BA%E5%B1%8F/"/>
    <url>/2023/04/11/%E5%85%B3%E4%BA%8E%E9%A6%99%E6%A9%99%E6%B4%BE%E6%98%BE%E7%A4%BA%E5%B1%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="香橙派店家资料"><a href="#香橙派店家资料" class="headerlink" title="香橙派店家资料"></a>香橙派店家资料</h2><p>LCD 显示屏和开发板的接线方式如下所示</p><p>（注意香橙派是 26pin 而不是 24pin）</p><div class="table-container"><table><thead><tr><th>对应到手头的显示屏</th><th>TFT SPI 模块引脚</th><th>开发板26pin 对应的引脚</th><th>GPIO — GPIO num</th></tr></thead><tbody><tr><td>3.3v</td><td>VCC</td><td>1 号引脚</td></tr><tr><td>GND</td><td>GND</td><td>6 号引脚</td></tr><tr><td>T_CS</td><td>CS</td><td>24 号引脚</td></tr><tr><td>RST</td><td>RESET</td><td>7 号引脚</td><td>PC9 — 73</td></tr><tr><td>AO(LCD_RS)</td><td>D/C</td><td>11 号引脚</td><td>PC6 — 70</td></tr><tr><td>MOSI/SDI</td><td>SDI(MOSI)</td><td>19 号引脚</td></tr><tr><td>SDK</td><td>SCK</td><td>23 号引脚</td></tr><tr><td>BL(Back Light)</td><td>LED</td><td>13 号引脚</td><td>PC5 — 69</td></tr><tr><td>MISO</td><td>SDO(MISO)</td><td>21 引脚</td></tr></tbody></table></div><p>(注意表格前面需要两个空行)</p><h2 id="显示屏店家资料"><a href="#显示屏店家资料" class="headerlink" title="显示屏店家资料"></a>显示屏店家资料</h2><div class="table-container"><table><thead><tr><th>解释</th><th>16</th><th>14</th><th>12</th><th>10</th><th>8</th><th>6</th><th>4</th><th>2</th></tr></thead><tbody><tr><td>电路板</td><td>T_CLK</td><td>NC</td><td>MOSI</td><td>NC</td><td>CS</td><td>SCK</td><td>NC</td><td>GND</td></tr><tr><td>原理图</td><td>T_CLK</td><td>-</td><td>T_MOSI</td><td>-</td><td>LCD_CS</td><td>LCD_SCL</td><td>-</td><td>GND</td><td></td></tr><tr><td>解释</td><td>时钟？</td><td>-</td><td>输入</td><td>-</td><td>片选信号</td><td>时钟信号</td><td>-</td><td>地</td></tr><tr><td>-</td><td><strong>15</strong></td><td><strong>13</strong></td><td><strong>11</strong></td><td><strong>9</strong></td><td><strong>7</strong></td><td><strong>5</strong></td><td><strong>3</strong></td><td><strong>1</strong></td></tr><tr><td>电路板</td><td>T_CS</td><td>PEN</td><td>MISO</td><td>SDI</td><td>AO</td><td>RST</td><td>BL</td><td>3.3V</td></tr><tr><td>原理图</td><td>T_CS</td><td>T_PEN</td><td>T_MISO</td><td>LCD_SDI</td><td>LCD_RS</td><td>LCD_RST</td><td>IO_BK</td><td>3.3v</td></tr><tr><td>解释</td><td>片选信号</td><td>？</td><td>输出</td><td>传递数据</td><td>命令/数据</td><td>重置</td><td>显示屏背光</td><td>电源</td></tr></tbody></table></div><p>一般来说是标准七脚，分别是<code>GND，VCC，D0，D1，RES，DC，CS</code></p><ul><li>GND：接地</li><li>VCC：供电</li><li>DO：Master input slave output，MISO，</li><li>DI：Master output slave input，MOSI，</li><li>RES：RST，复位</li><li>DC：RS，在只有MOSI的情况下控制写入数据还是命令，这个时候没有MISO</li><li>CS：CE，SSEL，SS，片选信号</li><li>SCLK：时钟信号</li></ul><p>放在这块显示屏上，则是</p><ul><li>GND：接地</li><li>VCC：供电</li><li>DO：T_MISO</li><li>DI：T_MOSI，LCD_SDI</li><li>RES：LCD_RST</li><li>DC：LCD_RS</li><li>CS：T_CS</li><li>SCLK：T_CLK，LCD_SCL</li></ul><p>公用的有</p><ul><li>GND</li><li>3.3v</li><li>IO_BK</li></ul><p>LCD开头的有</p><ul><li>LCD_CS</li><li>LCD_SCL（CLK）</li><li>LCD_SDI（MOSI）</li><li>LCD_RS</li><li>LCD_RST</li></ul><p>T开头的有</p><ul><li>T_CLK</li><li>T_MOSI</li><li>T_MISO</li><li>T_CS</li><li>T_PEN</li></ul><p>公用三个，T开头LCD开头各五个，共计16个，三个NC</p><p><strong>基本参数：</strong></p><p>240 X RGB X 320</p><p><del>驱动：fb_ili9341</del></p><p>驱动：fb_st7789v</p><h2 id="使用ssh传输文件："><a href="#使用ssh传输文件：" class="headerlink" title="使用ssh传输文件："></a>使用ssh传输文件：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">scp root@192.168.3.29:/boot/boot.bmp .<br><br>scp <span class="hljs-string">&quot;burythelight2 (online-audio-converter.com).rar&quot;</span> root@192.168.3.29:/.<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>嵌入式操作系统</title>
    <link href="/2023/04/11/%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    <url>/2023/04/11/%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="现有嵌入式操作系统"><a href="#现有嵌入式操作系统" class="headerlink" title="现有嵌入式操作系统"></a>现有嵌入式操作系统</h1><p><strong>Mobile operating systems</strong></p><ul><li><p>DIP DOS on Atari Portfolio</p><ul><li><p>Embedded Linux (see also Linux for mobile devices)</p></li><li><p>Android</p><ul><li><p>CalyxOS</p></li><li><p>DivestOS</p></li><li><p>EMUI</p></li><li><p>Flyme OS</p></li><li><p>GrapheneOS</p></li><li><p>LineageOS</p></li><li><p>MIUI</p></li><li><p>Replicant</p></li><li><p>See also List of custom Android distributions</p></li></ul></li><li><p>Firefox OS</p><ul><li>KaiOS</li></ul></li><li><p>Ångström distribution</p></li><li><p>Familiar Linux</p></li><li><p>Mæmo based on Debian deployed on Nokia’s Nokia 770, N800 and N810 Internet Tablets.</p></li><li><p>OpenZaurus</p></li><li><p>webOS from Palm, Inc., later Hewlett-Packard via acquisition, and most recently at LG Electronics through acquisition from Hewlett-Packard[39]</p></li><li><p>Access Linux Platform</p></li><li><p>bada</p></li><li><p>Openmoko Linux</p></li><li><p>OPhone</p></li><li><p>MeeGo (from merger of Maemo &amp; Moblin)</p></li><li><p>Mobilinux</p></li><li><p>MotoMagx</p></li><li><p>Qt Extended</p></li><li><p>Sailfish OS</p></li><li><p>Tizen (earlier called LiMo Platform)</p></li><li><p>Ubuntu Touch</p></li><li><p>PostmarketOS</p></li></ul></li><li><p>Inferno (distributed OS originally from Bell Labs)</p></li><li><p>Magic Cap</p></li><li><p>MS-DOS on Poqet PC, HP 95LX, HP 100LX, HP 200LX, HP 1000CX, HP OmniGo 700LX</p></li><li><p>NetBSD</p></li><li><p>Newton OS on Apple MessagePad</p></li><li><p>Palm OS from Palm, Inc; now spun off as PalmSource</p></li><li><p>PEN/GEOS on HP OmniGo 100 and 120</p></li><li><p>PenPoint OS</p></li><li><p>Plan 9 from Bell Labs</p></li><li><p>PVOS</p></li><li><p>Symbian OS</p><ul><li>EPOC</li></ul></li><li><p>Windows CE, from Microsoft</p></li><li><p>Pocket PC from Microsoft, a variant of Windows CE</p></li><li><p>Windows Mobile from Microsoft, a variant of Windows CE</p></li><li><p>Windows Phone from Microsoft</p></li><li><p>DSPnano RTOS</p></li><li><p>iOS</p><ul><li><p>watchOS</p></li><li><p>tvOS</p></li></ul></li><li><p>iPod software</p></li><li><p>iPodLinux</p></li><li><p>iriver clix OS</p></li><li><p>RockBox</p></li><li><p>BlackBerry OS</p></li><li><p>PEN/GEOS, GEOS-SC, GEOS-SE</p></li><li><p>Palm OS</p></li><li><p>Symbian platform (successor to Symbian OS)</p></li><li><p>BlackBerry 10</p></li><li><p>HarmonyOS</p></li></ul><p><strong>- Routers</strong></p><ul><li><p>CatOS – by Cisco Systems</p></li><li><p>Cisco IOS – originally Internetwork Operating System by Cisco Systems</p></li><li><p>DNOS – by DriveNets</p></li><li><p>Inferno – distributed OS originally from Bell Labs</p></li><li><p>IOS-XR – by Cisco Systems</p></li><li><p>JunOS – by Juniper Networks</p></li><li><p>LCOS – by LANCOM Systems[40]</p></li><li><p>Linux</p><ul><li><p>OpenWrt</p><ul><li><p>DD-WRT</p></li><li><p>LEDE</p></li><li><p>Gargoyle</p></li><li><p>LibreCMC</p></li></ul></li><li><p>Zeroshell</p></li></ul></li><li><p>FTOS – by Force10 Networks</p></li><li><p>FreeBSD</p><ul><li><p>m0n0wall</p></li><li><p>OPNsense</p></li><li><p>pfsense</p></li></ul></li><li><p>List of wireless router firmware projects</p></li></ul><p><strong>- Other embedded</strong></p><ul><li><p>Apache Mynewt</p></li><li><p>ChibiOS/RT</p></li><li><p>Contiki</p></li><li><p>ERIKA Enterprise</p></li><li><p>eCos</p></li><li><p>NetBSD</p></li><li><p>Nucleus RTOS[41]</p></li><li><p>NuttX</p></li><li><p>Minix</p></li><li><p>NCOS</p></li><li><p>freeRTOS, openRTOS, safeRTOS</p></li><li><p>Fuchsia</p></li><li><p>OpenEmbedded (or Yocto Project)</p></li><li><p>OpenHarmony</p></li><li><p>pSOS (Portable Software On Silicon)</p></li><li><p>QNX – Unix-like real-time operating system, aimed primarily at the embedded systems market.[42]</p></li><li><p>REX OS – microkernel; usually an embedded cell phone OS</p></li><li><p>RIOT</p></li><li><p>ROM-DOS</p></li><li><p>TinyOS</p></li><li><p>ThreadX</p></li><li><p>RT-Thread</p></li><li><p>DSPnano RTOS</p></li><li><p>Windows IoT – formerly Windows Embedded</p><ul><li><p>Windows CE</p></li><li><p>Windows IoT Core</p></li><li><p>Windows IoT Enterprise</p></li></ul></li><li><p>Wind River VxWorks RTOS.[17]</p></li><li><p>Wombat – microkernel; usually real-time embedded</p></li><li><p>Zephyr</p></li><li><p>LEGO Mindstorms</p></li><li><p>brickOS</p></li><li><p>leJOS</p></li></ul><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">An embedded operating <span class="hljs-keyword">system</span> <span class="hljs-keyword">is</span> an operating <span class="hljs-keyword">system</span> <span class="hljs-keyword">for</span> embedded computer systems. Embedded operating systems are computer systems designed <span class="hljs-keyword">to</span> increase functionality <span class="hljs-keyword">and</span> reliability <span class="hljs-keyword">for</span> achieving a specific task.[<span class="hljs-number">1</span>] Resource efficiency comes at the <span class="hljs-keyword">cost</span> <span class="hljs-keyword">of</span> losing <span class="hljs-keyword">some</span> functionality <span class="hljs-keyword">or</span> granularity that larger computer operating systems provide, including <span class="hljs-keyword">functions</span> that may <span class="hljs-keyword">not</span> be used <span class="hljs-keyword">by</span> the specialized applications run. Depending <span class="hljs-keyword">on</span> the <span class="hljs-keyword">method</span> used <span class="hljs-keyword">for</span> multitasking, this <span class="hljs-keyword">type</span> <span class="hljs-keyword">of</span> OS <span class="hljs-keyword">is</span> frequently considered a <span class="hljs-type">real</span>-<span class="hljs-type">time</span> operating <span class="hljs-keyword">system</span> <span class="hljs-keyword">or</span> RTOS. Embedded systems are mostly used <span class="hljs-keyword">as</span> <span class="hljs-type">Real</span>-<span class="hljs-type">time</span> operating systems.<br><br><span class="hljs-keyword">All</span> embedded systems contain a processor <span class="hljs-keyword">and</span> software. There must be a place <span class="hljs-keyword">for</span> embedded software <span class="hljs-keyword">to</span> store the executable code <span class="hljs-keyword">and</span> <span class="hljs-keyword">temporary</span> <span class="hljs-keyword">storage</span> <span class="hljs-keyword">for</span> run-<span class="hljs-type">time</span> data manipulations. These take the form <span class="hljs-keyword">of</span> ROM <span class="hljs-keyword">and</span> RAM, respectively. <span class="hljs-keyword">All</span> embedded systems must <span class="hljs-keyword">also</span> contain <span class="hljs-keyword">some</span> form <span class="hljs-keyword">of</span> inputs <span class="hljs-keyword">and</span> outputs <span class="hljs-keyword">to</span> <span class="hljs-keyword">function</span>. <span class="hljs-keyword">Within</span> the <span class="hljs-keyword">exception</span> <span class="hljs-keyword">of</span> these few common features, the rest <span class="hljs-keyword">of</span> the embedded hardware <span class="hljs-keyword">is</span> usually <span class="hljs-keyword">unique</span> <span class="hljs-keyword">and</span> varies <span class="hljs-keyword">from</span> application <span class="hljs-keyword">to</span> application.[<span class="hljs-number">2</span>] The hardware running an embedded operating <span class="hljs-keyword">system</span> can be very limited <span class="hljs-keyword">in</span> resources; therefore the embedded design <span class="hljs-keyword">of</span> these operating systems may have a narrow scope tailored <span class="hljs-keyword">to</span> a specific application <span class="hljs-keyword">to</span> achieve the desired operation under these constraints. The embedded operating <span class="hljs-keyword">system</span> that organizes <span class="hljs-keyword">and</span> controls the hardware usually determines the rest <span class="hljs-keyword">of</span> the embedded hardware needed.<br><br><span class="hljs-keyword">To</span> take better advantage <span class="hljs-keyword">of</span> the processing power <span class="hljs-keyword">of</span> the CPU, software developers may <span class="hljs-keyword">write</span> critical code directly <span class="hljs-keyword">in</span> assembly. This machine efficient <span class="hljs-keyword">language</span> can potentially result <span class="hljs-keyword">in</span> gains <span class="hljs-keyword">in</span> speed <span class="hljs-keyword">and</span> determinism at the <span class="hljs-keyword">cost</span> <span class="hljs-keyword">of</span> portability <span class="hljs-keyword">and</span> maintainability. Often, embedded operating systems are written entirely <span class="hljs-keyword">in</span> more portable languages, <span class="hljs-keyword">like</span> C, however.<br><br>An important difference <span class="hljs-keyword">between</span> most embedded operating systems <span class="hljs-keyword">and</span> desktop operating systems <span class="hljs-keyword">is</span> that the application, including the operating <span class="hljs-keyword">system</span>, <span class="hljs-keyword">is</span> usually statically linked <span class="hljs-keyword">into</span> a single executable image. Unlike a desktop operating <span class="hljs-keyword">system</span>, the embedded operating <span class="hljs-keyword">system</span> does <span class="hljs-keyword">not</span> <span class="hljs-keyword">load</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">execute</span> many applications.[<span class="hljs-number">3</span>] This means that the <span class="hljs-keyword">system</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">only</span> able <span class="hljs-keyword">to</span> run a few application(s).<br></code></pre></td></tr></table></figure><p><strong>种类，构成，应用</strong></p><h1 id=""><a href="#" class="headerlink" title=" "></a> </h1>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>用 Python 读取&amp;解析 json</title>
    <link href="/2023/04/08/2023%E5%B9%B44%E6%9C%888%E6%97%A5/"/>
    <url>/2023/04/08/2023%E5%B9%B44%E6%9C%888%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="用-Python-读取-amp-解析-json"><a href="#用-Python-读取-amp-解析-json" class="headerlink" title="用 Python 读取&amp;解析 json"></a>用 Python 读取&amp;解析 json</h1><p>json 范例：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>   <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;United States&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;population&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">331002651</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;capital&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Washington D.C.&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-attr">&quot;languages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>  <span class="hljs-string">&quot;English&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-string">&quot;Spanish&quot;</span><br>   <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br>JSON以键值对的形式传递数据，类似XML，XML示例：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">country</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>United States<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">population</span>&gt;</span>331002651<span class="hljs-tag">&lt;/<span class="hljs-name">population</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">capital</span>&gt;</span>Washington D.C.<span class="hljs-tag">&lt;/<span class="hljs-name">capital</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">languages</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">language</span>&gt;</span>English<span class="hljs-tag">&lt;/<span class="hljs-name">language</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">language</span>&gt;</span>Spanish<span class="hljs-tag">&lt;/<span class="hljs-name">language</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">languages</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">country</span>&gt;</span><br></code></pre></td></tr></table></figure><br>众所周知，Python原生支持JSON数据，json模块是标准库的一部分，无序手动解析。</p><p>可以将JSON数据从JSON格式转换到等效的Python对象，例如dictionary和list。JSON模块还可以将Python对象转换为JSON格式。</p><h2 id="具体使用："><a href="#具体使用：" class="headerlink" title="具体使用："></a>具体使用：</h2><h3 id="将json字符串转化为字典"><a href="#将json字符串转化为字典" class="headerlink" title="将json字符串转化为字典"></a>将json字符串转化为字典</h3><p>传入：字符串格式的 json 数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-comment"># 导入json包</span><br>country = <span class="hljs-string">&#x27;&#123;&quot;name&quot;: &quot;United States&quot;, &quot;population&quot;: 331002651&#125;&#x27;</span><br><span class="hljs-comment"># 定义字符串，json，country</span><br>country_dict = json.loads(country)<br><span class="hljs-comment"># 使用json.loads()方法处理country</span><br></code></pre></td></tr></table></figure><p>结果country_dict是字典。</p><p>注意，json内数据类型和Python内有一一对应的关系。</p><div class="table-container"><table><thead><tr><th>JSON</th><th>Python</th></tr></thead><tbody><tr><td>object</td><td>dict</td></tr><tr><td>array</td><td>list</td></tr><tr><td>string</td><td>str</td></tr><tr><td>number (integer)</td><td>int</td></tr><tr><td>number (real)</td><td>float</td></tr><tr><td>true</td><td>True</td></tr><tr><td>false</td><td>False</td></tr><tr><td>null</td><td>None</td></tr></tbody></table></div><h3 id="将json文件转化为字典"><a href="#将json文件转化为字典" class="headerlink" title="将json文件转化为字典"></a>将json文件转化为字典</h3><p>使用open()方法导入文件，然后使用json.loads()处理读入的字符串。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;united_states.json&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>  data = json.load(f)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(data))<br></code></pre></td></tr></table></figure><br>测试结果：</p><p>python 字典单向读取，打印时呈现json格式。</p><h1 id="用-Python-调用-api"><a href="#用-Python-调用-api" class="headerlink" title="用 Python 调用 api"></a>用 Python 调用 api</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">request_data</span>(<span class="hljs-params">url</span>): <br>   req = requests.get(url, timeout=<span class="hljs-number">30</span>) <span class="hljs-comment"># 请求连接</span><br>   req_jason = req.json() <span class="hljs-comment"># 获取数据</span><br>   <span class="hljs-keyword">return</span> req_jason <br></code></pre></td></tr></table></figure><p>也就是通过requests包里的<code>requests.get(url,timeout)</code>进行获取内容，这个方法会返回一个字符串。</p><h1 id="Python-正则模块-re"><a href="#Python-正则模块-re" class="headerlink" title="Python 正则模块 re"></a>Python 正则模块 re</h1><p>Q：如何将非标准json数据（例如nga的api）掐头去尾？</p><p>A：使用re的findall()模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 处理形如ashdasbdh(</span><br><span class="hljs-comment"># 中间是json</span><br><span class="hljs-comment"># );</span><br><span class="hljs-keyword">import</span> re<br>dt = re.findall(<span class="hljs-string">r&#x27;[(](.*?)[)]&#x27;</span>, text)<br>data_json = json.loads(dt[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(dt)<br><span class="hljs-built_in">print</span>(data_json)<br></code></pre></td></tr></table></figure><h1 id="vscode-json-自动排版"><a href="#vscode-json-自动排版" class="headerlink" title="vscode json 自动排版"></a>vscode json 自动排版</h1><p>使用<code>json tools</code>工具内的 <code>ctrl+alt+M</code>快捷键</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>专业认知与探索期末作业</title>
    <link href="/2023/03/16/%E4%B8%93%E4%B8%9A%E8%AE%A4%E7%9F%A5%E4%B8%8E%E6%8E%A2%E7%B4%A2%E6%9C%9F%E6%9C%AB%E4%BD%9C%E4%B8%9A/"/>
    <url>/2023/03/16/%E4%B8%93%E4%B8%9A%E8%AE%A4%E7%9F%A5%E4%B8%8E%E6%8E%A2%E7%B4%A2%E6%9C%9F%E6%9C%AB%E4%BD%9C%E4%B8%9A/</url>
    
    <content type="html"><![CDATA[<p><strong>截止时间：周五，也就是明天晚上</strong></p><hr><p><strong>要求：</strong></p><p>期末题目：用TX-1C学习板实现下列题目中的一个，每人独立完成。</p><p>必须完成基本要求，其它功能可以自行添加。</p><ol><li><p>用学习板和超声模块实现超声测距，并用点阵或液晶显示。<br>基本要求：使用超声测距模块进行距离测试，用点阵显示超声波测试的距离，距离越近，点阵中亮的点越少；距离越远，点阵中亮的点越多。（超声测距模块需要大家自己购买，参考型号是HC-SR04）</p></li><li><p>用学习板和超声模块实现超声测距，并用数码管显示距离。<br>基本要求：使用超声测距模块进行距离测试，并用数码管显示测距结果。（超声测距模块需要大家自己购买，参考型号是HC-SR04）</p></li><li><p>利用键盘和1602液晶显示器实现简易计算器<br>基本要求：利用矩阵键盘和独立键盘实现一个计算器，计算器必须具备加减乘除功能，并利用1602液晶显示输入的数据和计算结果。计算器的其它功能根据个人能力添加。</p></li><li><p>利用键盘和数码管实现简易计算器<br>基本要求：利用矩阵键盘和独立键盘实现一个计算器，计算器必须具备加减乘除功能，并利用数码管显示输入的数据和计算结果。计算器的其它功能根据个人能力添加。</p></li><li><p>利用键盘、发光二极管和数码管实现一个交通信号灯<br>基本要求：指定发光二极管代表红黄绿灯，绿灯亮20s后，黄灯闪烁3s，然后红灯再亮20s，交替变化。当红灯只剩5s时长时，数码管按秒显示倒计时；当绿灯只剩5s时长时，数码管按秒显示倒计时；黄灯工作的3s期间，指定某个发光二极管以500ms为间隔闪烁。根据个人能力实现单向或十字路口交通灯。</p></li><li><p>基于课程所学内容，自己拟定实验项目和内容，完成实验，并提交报告。</p></li></ol><p>注意：期末项目电子版实验报告提交给助教，报告以“学号+姓名+期末题目”形式命名，时间可以放宽到下学期开学第三周之前。是否安排现场验收，视疫情情况而定。</p><hr><p>没有超声模块，排除1、2</p><p>选择4：数码管、键盘、计算器</p><p>1602液晶显示屏不熟悉，排除</p><p>交通灯：考虑</p><hr><p><strong>计算器：</strong></p><ol><li>计算：加减乘除</li><li>需要指定按键：keyscan()，使用所有键盘<ol><li>十个数字：0~9</li><li>加减乘除，四个以上</li><li>清零</li><li>其他功能</li></ol></li><li>显示屏：display()，显示加减乘除的符号、数字</li><li>应该没了？</li></ol><p><strong>交通灯：</strong></p><pre><code class="hljs">指定发光二极管代表红黄绿灯绿灯亮20s后，黄灯闪烁3s，然后红灯再亮20s，交替变化。当红灯只剩5s时长时，数码管按秒显示倒计时；当绿灯只剩5s时长时，数码管按秒显示倒计时；黄灯工作的3s期间，指定某个发光二极管以500ms为间隔闪烁。根据个人能力实现单向或十字路口交通灯。</code></pre><p>单向：</p><ol><li>四个灯，绿灯红灯黄灯和500ms闪烁灯</li><li>计时：<ol><li>绿灯20s，黄灯3s和闪烁灯500ms爆闪，红灯20s</li><li>数码管5s倒计时：红灯、绿灯；3s倒计时：黄灯</li></ol></li><li>没了？</li></ol><p>十字路口：</p><ol><li>两个单向？</li></ol><hr><p>计算器：</p><p>数字表</p><ul><li>有小数点</li><li>无小数点</li></ul><p>运算</p><p>display()</p><ul><li>实时显示数字，不显示符号</li></ul><p>keyscan()</p><ul><li></li></ul><p><strong>计算器</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;reg52.h&gt;</span></span><br><span class="hljs-comment">//定义行引脚</span><br>sbit hang[]=&#123;P3^<span class="hljs-number">7</span>,P3^<span class="hljs-number">6</span>,P3^<span class="hljs-number">5</span>,P3^<span class="hljs-number">4</span>&#125;;<br> <br><span class="hljs-comment">//定义列引脚</span><br>sbit lie[]=&#123;P3^<span class="hljs-number">3</span>,P3^<span class="hljs-number">2</span>,P3^<span class="hljs-number">1</span>,P3^<span class="hljs-number">0</span>&#125;;<br><br><span class="hljs-type">char</span> key[<span class="hljs-number">4</span>][<span class="hljs-number">4</span>]=&#123;<br>&#123;<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>&#125;,<br>&#123;<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;k&#x27;</span>&#125;,<br>&#123;<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;=&#x27;</span>&#125;,<br>&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>&#125;&#125;;<span class="hljs-comment">// 加减乘除</span><br><span class="hljs-type">int</span> num[<span class="hljs-number">7</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br><span class="hljs-type">int</span> cal_num[<span class="hljs-number">2</span>]=&#123;<span class="hljs-number">0</span>&#125;;<br><span class="hljs-type">char</span> fuhao=<span class="hljs-number">0</span>;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code num1[]=   <span class="hljs-comment">//没有小数点的0-9对应编码</span><br>&#123;<br><span class="hljs-number">0x3f</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x4f</span>,<br><span class="hljs-number">0x66</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x07</span>,<br><span class="hljs-number">0x7f</span>,<span class="hljs-number">0x6f</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code num2[]=  <br>&#123;<br><span class="hljs-number">0xbf</span>,<span class="hljs-number">0x86</span>,<span class="hljs-number">0xdb</span>,<span class="hljs-number">0xcf</span>,<br><span class="hljs-number">0xe6</span>,<span class="hljs-number">0xed</span>,<span class="hljs-number">0xfd</span>,<span class="hljs-number">0x87</span>,<br><span class="hljs-number">0xff</span>,<span class="hljs-number">0xef</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code place[]=<br>&#123;<br><span class="hljs-number">0xfe</span>,<span class="hljs-number">0xfd</span>,<span class="hljs-number">0xfb</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0xf5</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0xf1</span>&#125;;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">delay</span><span class="hljs-params">(<span class="hljs-type">int</span> z)</span><br>&#123;<br>    <span class="hljs-type">int</span> i,j;<br>  <span class="hljs-keyword">for</span>(i=z;i&gt;<span class="hljs-number">0</span>;i--);<br>   <span class="hljs-keyword">for</span>(j=<span class="hljs-number">110</span>;j&gt;<span class="hljs-number">0</span>;j--);<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> temp = cal_num[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">7</span>&amp;&amp;temp&gt;<span class="hljs-number">0</span>;i++)&#123;<br>num[i]=temp%<span class="hljs-number">10</span>;<br>temp/=<span class="hljs-number">10</span>;<br>&#125;<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">7</span>;i++)&#123;<br>wela=<span class="hljs-number">1</span>;<br>P0=place[i];<br>wela=<span class="hljs-number">0</span>;<br><br>P0=<span class="hljs-number">0x00</span>;<br><br>dula=<span class="hljs-number">1</span>;<br><span class="hljs-comment">//P0=(i==1?num2[num[i]]:num1[num[i]]);</span><br>P0 = cal_num[<span class="hljs-number">1</span>];<br>delay(<span class="hljs-number">10</span>);<br>dula=<span class="hljs-number">0</span>;<br>P0=<span class="hljs-number">0xff</span>;<br>&#125;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><br><br><span class="hljs-type">char</span> <span class="hljs-title function_">keyscan</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">char</span> input;<br><span class="hljs-type">int</span> i=<span class="hljs-number">0</span>,j=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">4</span>;j++)&#123;<br>P3=<span class="hljs-number">0xff</span>;<br>hang[j]=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++)&#123;<br><span class="hljs-keyword">if</span>(lie[i]==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie[i]==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie[i]==<span class="hljs-number">0</span>);<br>input=key[i][j];<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> input;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">char</span> input)</span>&#123;<br><span class="hljs-type">int</span> temp=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">switch</span>(input)&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;8&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;9&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;0&#x27;</span>:<br>cal_num[<span class="hljs-number">1</span>] = cal_num[<span class="hljs-number">1</span>]*<span class="hljs-number">10</span> + ((<span class="hljs-type">int</span>)input - <span class="hljs-string">&#x27;0&#x27;</span>)<br><span class="hljs-keyword">break</span>;<br><br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;=&#x27;</span>:<br><span class="hljs-keyword">switch</span>(fuhao)&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br>cal_num[<span class="hljs-number">0</span>]+=cal_num[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br>cal_num[<span class="hljs-number">0</span>]-=cal_num[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br>cal_num[<span class="hljs-number">0</span>]*=cal_num[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:<br>cal_num[<span class="hljs-number">0</span>]/=cal_num[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;=&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-keyword">default</span>:<br><span class="hljs-keyword">break</span>;<br>&#125;<br>cal_num[<span class="hljs-number">1</span>]=<span class="hljs-number">0</span>;<br>fuhao = input;<br><span class="hljs-keyword">break</span>;<br><br><span class="hljs-keyword">case</span> <span class="hljs-keyword">default</span>:<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-comment">//init</span><br><span class="hljs-type">char</span> input=<span class="hljs-number">0</span>;<br><span class="hljs-comment">//begin</span><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>display();<br>input = keyscan();<br>calculate(input);<br>&#125;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p><strong>修改后</strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;reg52.h&gt;</span></span><br>sbit dula=P2^<span class="hljs-number">6</span>;  <span class="hljs-comment">//dula与wela为两个使能端</span><br>sbit wela=P2^<span class="hljs-number">7</span>;<br><span class="hljs-comment">////定义行引脚</span><br>sbit lie1=P3^<span class="hljs-number">7</span>;<br>sbit lie2=P3^<span class="hljs-number">6</span>;<br>sbit lie3=P3^<span class="hljs-number">5</span>;<br>sbit lie4=P3^<span class="hljs-number">4</span>;<br><span class="hljs-comment">// </span><br><span class="hljs-comment">////定义列引脚</span><br>sbit hang1=P3^<span class="hljs-number">3</span>;<br>sbit hang2=P3^<span class="hljs-number">2</span>;<br>sbit hang3=P3^<span class="hljs-number">1</span>;<br>sbit hang4=P3^<span class="hljs-number">0</span>;<br><br><span class="hljs-type">char</span> key[<span class="hljs-number">4</span>][<span class="hljs-number">4</span>]=&#123;<br>&#123;<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>&#125;,<br>&#123;<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;k&#x27;</span>&#125;,<br>&#123;<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;=&#x27;</span>&#125;,<br>&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>&#125;&#125;;<span class="hljs-comment">// 加减乘除</span><br><span class="hljs-type">long</span> <span class="hljs-type">int</span> cal_num[<span class="hljs-number">3</span>]=&#123;<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>&#125;;<br><span class="hljs-type">char</span> fuhao=<span class="hljs-number">0</span>;<br><span class="hljs-type">char</span> input=<span class="hljs-number">0</span>;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code num1[]=   <span class="hljs-comment">//没有小数点的0-9对应编码</span><br>&#123;<br><span class="hljs-number">0x3f</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x4f</span>,<br><span class="hljs-number">0x66</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x07</span>,<br><span class="hljs-number">0x7f</span>,<span class="hljs-number">0x6f</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code num2[]=  <br>&#123;<br><span class="hljs-number">0xbf</span>,<span class="hljs-number">0x86</span>,<span class="hljs-number">0xdb</span>,<span class="hljs-number">0xcf</span>,<br><span class="hljs-number">0xe6</span>,<span class="hljs-number">0xed</span>,<span class="hljs-number">0xfd</span>,<span class="hljs-number">0x87</span>,<br><span class="hljs-number">0xff</span>,<span class="hljs-number">0xef</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code place[]=<br>&#123;<br><span class="hljs-comment">//0111_1111 7f</span><br><span class="hljs-comment">//1011_1111 bf</span><br><span class="hljs-comment">//1101_1111 df</span><br><span class="hljs-comment">//1110_1111 ef</span><br><span class="hljs-comment">//1111_0111 f7</span><br><span class="hljs-comment">//1111_1011 fb</span><br><span class="hljs-comment">//1111_1101 fd</span><br><span class="hljs-comment">//1111_1110 fe</span><br><span class="hljs-number">0xfe</span>,<span class="hljs-number">0xfd</span>,<span class="hljs-number">0xfb</span>,<span class="hljs-number">0xf7</span>,<span class="hljs-number">0xef</span>,<span class="hljs-number">0xdf</span>,<span class="hljs-number">0xbf</span>,<span class="hljs-number">0x7f</span>&#125;;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">delay</span><span class="hljs-params">(<span class="hljs-type">int</span> z)</span><br>&#123;<br>    <span class="hljs-type">int</span> i,j;<br>  <span class="hljs-keyword">for</span>(i=z;i&gt;<span class="hljs-number">0</span>;i--);<br>   <span class="hljs-keyword">for</span>(j=<span class="hljs-number">110</span>;j&gt;<span class="hljs-number">0</span>;j--);<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> temp = cal_num[<span class="hljs-number">2</span>];<br><span class="hljs-comment">//for(i=0;i&lt;7&amp;&amp;temp&gt;0;i++)&#123;</span><br><span class="hljs-comment">//num[i]=temp%10;</span><br><span class="hljs-comment">//temp/=10;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">5</span>;i&gt;<span class="hljs-number">0</span><span class="hljs-comment">/*&amp;&amp;temp&gt;0*/</span>;i--)&#123;<br>wela=<span class="hljs-number">1</span>;<br>P0=place[i];<br>wela=<span class="hljs-number">0</span>;<br><br>P0=<span class="hljs-number">0x00</span>;<br><br>dula=<span class="hljs-number">1</span>;<br>P0 = num1[temp%<span class="hljs-number">10</span>];<br>temp/=<span class="hljs-number">10</span>;<br>delay(<span class="hljs-number">10</span>);<br>dula=<span class="hljs-number">0</span>;<br>P0=<span class="hljs-number">0xff</span>;<br>&#125;<br>delay(<span class="hljs-number">100</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><br><br><span class="hljs-comment">//char keyscan()</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//char input;</span><br><span class="hljs-comment">//int i=0,j=0;</span><br><span class="hljs-comment">//for(j=0;j&lt;4;j++)&#123;</span><br><span class="hljs-comment">//P3=0xff;</span><br><span class="hljs-comment">//hang[j]=0;</span><br><span class="hljs-comment">//for(i=0;i&lt;4;i++)&#123;</span><br><span class="hljs-comment">//if(lie[i]==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie[i]==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie[i]==0);</span><br><span class="hljs-comment">//input=key[i][j];</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//return input;</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-comment">//char keyscan()&#123;</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//char input=0;</span><br><span class="hljs-comment">//P3|=0xff;</span><br><span class="hljs-comment">//hang1=0;</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie1==0);</span><br><span class="hljs-comment">//input=key[0][0];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie2==0);</span><br><span class="hljs-comment">//input=key[0][1];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie3==0);</span><br><span class="hljs-comment">//input=key[0][2];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie4==0);</span><br><span class="hljs-comment">//input=key[0][3];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//P3|=0xff;</span><br><span class="hljs-comment">//hang2=0;</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie1==0);</span><br><span class="hljs-comment">//input=key[1][0];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie2==0);</span><br><span class="hljs-comment">//input=key[1][1];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie3==0);</span><br><span class="hljs-comment">//input=key[1][2];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie4==0);</span><br><span class="hljs-comment">//input=key[1][3];</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//P3|=0xff;</span><br><span class="hljs-comment">//hang3=0;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie1==0);</span><br><span class="hljs-comment">//input=key[2][0];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie2==0);</span><br><span class="hljs-comment">//input=key[2][1];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie3==0);</span><br><span class="hljs-comment">//input=key[2][2];</span><br><span class="hljs-comment">//cal_num[1] = cal_num[1]*10 + ((int)input - &#x27;0&#x27;);</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie4==0);</span><br><span class="hljs-comment">//input=key[2][3];</span><br><span class="hljs-comment">//cal_num[1]=0;</span><br><span class="hljs-comment">//fuhao = input;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">// </span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//P3|=0xff;</span><br><span class="hljs-comment">//hang4=0;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie1==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie1==0);</span><br><span class="hljs-comment">//input=key[3][0];</span><br><span class="hljs-comment">//cal_num[0]+=cal_num[1];</span><br><span class="hljs-comment">//cal_num[1]=0;</span><br><span class="hljs-comment">//fuhao = input;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie2==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie2==0);</span><br><span class="hljs-comment">//input=key[3][1];</span><br><span class="hljs-comment">//cal_num[0]-=cal_num[1];</span><br><span class="hljs-comment">//cal_num[1]=0;</span><br><span class="hljs-comment">//fuhao = input;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie3==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie3==0);</span><br><span class="hljs-comment">//input=key[3][2];</span><br><span class="hljs-comment">//cal_num[0]*=cal_num[1];</span><br><span class="hljs-comment">//cal_num[1]=0;</span><br><span class="hljs-comment">//fuhao = input;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//delay(10);</span><br><span class="hljs-comment">//if(lie4==0)</span><br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//while(lie4==0);</span><br><span class="hljs-comment">//input=key[3][3];</span><br><span class="hljs-comment">//cal_num[0]/=cal_num[1];</span><br><span class="hljs-comment">//cal_num[1]=0;</span><br><span class="hljs-comment">//fuhao = input;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//return input;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-type">char</span> <span class="hljs-title function_">keyscan</span><span class="hljs-params">()</span>&#123;<br>&#123;<br><span class="hljs-type">char</span> input=<span class="hljs-number">0</span>;<br>P3|=<span class="hljs-number">0xff</span>;<br>hang1=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie1==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie2==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br>&#125;<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie3==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie4==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">0</span>][<span class="hljs-number">3</span>];<br>&#125;<br>&#125;<br><br><br>P3|=<span class="hljs-number">0xff</span>;<br>hang2=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie1==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie2==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];<br>&#125;<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie3==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie4==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>];<br>&#125;<br>&#125;<br><br>P3|=<span class="hljs-number">0xff</span>;<br>hang3=<span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie1==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie2==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>];<br>&#125;<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie3==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie4==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>];<br>&#125;<br>&#125;<br> <br><br>P3|=<span class="hljs-number">0xff</span>;<br>hang4=<span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie1==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie1==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">3</span>][<span class="hljs-number">0</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie2==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie2==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">3</span>][<span class="hljs-number">1</span>];<br>&#125;<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie3==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie3==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">3</span>][<span class="hljs-number">2</span>];<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">if</span>(lie4==<span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">while</span>(lie4==<span class="hljs-number">0</span>);<br>input=key[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>];<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> input;<br>&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">char</span> input)</span>&#123;<br><span class="hljs-keyword">switch</span>(input)&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;8&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;9&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;0&#x27;</span>:<br>cal_num[<span class="hljs-number">1</span>] = cal_num[<span class="hljs-number">1</span>]*<span class="hljs-number">10</span> + ((<span class="hljs-type">int</span>)input - <span class="hljs-string">&#x27;0&#x27;</span>);<br>cal_num[<span class="hljs-number">2</span>] = cal_num[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">break</span>;<br><br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;=&#x27;</span>:<br><span class="hljs-keyword">switch</span>(fuhao)&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br>cal_num[<span class="hljs-number">1</span>]+=cal_num[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br>cal_num[<span class="hljs-number">1</span>]=cal_num[<span class="hljs-number">0</span>]-cal_num[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br>cal_num[<span class="hljs-number">1</span>]*=cal_num[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:<br>cal_num[<span class="hljs-number">1</span>]=cal_num[<span class="hljs-number">0</span>]/cal_num[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;=&#x27;</span>:<br><span class="hljs-keyword">default</span>:<br><span class="hljs-keyword">break</span>;<br>&#125;<br>cal_num[<span class="hljs-number">2</span>]=cal_num[<span class="hljs-number">1</span>];<br>cal_num[<span class="hljs-number">0</span>]=cal_num[<span class="hljs-number">1</span>];<br>cal_num[<span class="hljs-number">1</span>]=<span class="hljs-number">0</span>;<br>fuhao = input;<br><span class="hljs-keyword">break</span>;<br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;k&#x27;</span>:<br>cal_num[<span class="hljs-number">0</span>]=cal_num[<span class="hljs-number">1</span>]=cal_num[<span class="hljs-number">2</span>]=cal_num[<span class="hljs-number">3</span>]=<span class="hljs-number">0</span>;<br>delay(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br><span class="hljs-keyword">break</span>;<br>&#125;<br>input = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-comment">//init</span><br>input = <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">//cal_num[1]=123456;</span><br><span class="hljs-comment">//display();</span><br><span class="hljs-comment">//begin</span><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br><span class="hljs-comment">//cal_num[1]=12345;</span><br>display();<br>delay(<span class="hljs-number">10</span>);<br>  input = keyscan();<br><span class="hljs-keyword">if</span>(input!=<span class="hljs-number">0</span>)<br>calculate(input);<br><br>&#125;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2023年3月6日</title>
    <link href="/2023/03/06/2023%E5%B9%B43%E6%9C%886%E6%97%A5/"/>
    <url>/2023/03/06/2023%E5%B9%B43%E6%9C%886%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h1><p>可以通过<code>alias</code>设置别名，但不能永久保存，下一次启动<code>shell</code>时会重置。</p><p><code>PATH</code>即是一个环境变量。<code>Ubuntu</code>中，有<strong>系统环境变量和用户环境变量</strong>，区别在于对所有用户生效还是仅对当前用户生效。</p><p><strong>环境变量的储存文件</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/.profile<br><span class="hljs-comment"># 无论是通过控制台还是图形界面启动程序时，都会自动执行该文件。</span><br><br>~/.bashrc, ~/.bash_profile, ~/.bash_login<br><span class="hljs-comment"># 当通过shell启动程序时，它们也会被加载；但当通过图形界面环境启动程序时，这些文件中的环境变量设置便不可用了。</span><br></code></pre></td></tr></table></figure><br><strong>环境变量的储存文件夹</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/profile<br><br>/etc/profile.d<br><br>/etc/bash.bashrc<br></code></pre></td></tr></table></figure><br><code>/etc/profile.d</code>文件夹来源于<code>/etc/profile</code>，目录下的<code>*.sh</code>，即以<code>sh</code>为后缀的文件都会被加载。</p><p>在图形界面环境下启动程序时，不会加载<code>/ect/bash.bashrc</code>里边的环境变量设置。</p><h2 id="设置永久环境变量实例"><a href="#设置永久环境变量实例" class="headerlink" title="设置永久环境变量实例"></a>设置永久环境变量实例</h2><ul><li>编辑<code>/etc/profile</code></li><li><code>export 别名=&#39;指令&#39;</code></li></ul><p>加载环境变量：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure></p><h1 id="cat-命令"><a href="#cat-命令" class="headerlink" title="cat 命令"></a>cat 命令</h1><p>cat（英文全拼：concatenate）命令用于连接文件并打印到标准输出设备上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> [-AbeEnstTuv] [--<span class="hljs-built_in">help</span>] [--version] fileName<br></code></pre></td></tr></table></figure><ul><li><p>-n 或 —number：由 1 开始对所有输出的行数编号。</p></li><li><p>-b 或 —number-nonblank：和 -n 相似，只不过对于空白行不编号。</p></li><li><p>-s 或 —squeeze-blank：当遇到有连续两行以上的空白行，就代换为一行的空白行。</p></li><li><p>-v 或 —show-nonprinting：使用 ^ 和 M- 符号，除了 LFD 和 TAB 之外。</p></li><li><p>-E 或 —show-ends : 在每行结束处显示 $。</p></li><li><p>-T 或 —show-tabs: 将 TAB 字符显示为 ^I。</p></li><li><p>-A, —show-all：等价于 -vET。</p></li><li><p>-e：等价于”-vE”选项；</p></li><li><p>-t：等价于”-vT”选项；</p></li></ul><p><strong>用法</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> A B &gt; C<br><span class="hljs-comment"># 将文件B中的内容加上A，写入C中</span><br><br><span class="hljs-built_in">cat</span> A B C &gt;&gt; D<br><span class="hljs-comment"># 将B与C之间加上A，写入D中</span><br><br><span class="hljs-built_in">cat</span> /dev/null &gt;&gt; A<br><span class="hljs-comment"># 清空A</span><br><br></code></pre></td></tr></table></figure><br>将语句写入环境变量：</p><pre><code class="hljs">echo &#39;PATH=&quot;$PATH:./node_modules/.bin&quot;&#39; &gt;&gt; ~/.profile</code></pre><h1 id="如何将文件夹变为-git-版本库"><a href="#如何将文件夹变为-git-版本库" class="headerlink" title="如何将文件夹变为 git 版本库"></a>如何将文件夹变为 git 版本库</h1><ul><li>进入文件夹</li><li><code>git init</code></li><li>将文件添加到本地仓库：<code>git add</code><ul><li>可以同时添加多个文件，用空格隔开</li></ul></li><li>提交：<code>git commit -m &quot;对于本次提交的说明&quot;</code></li><li></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>日志</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023年3月5日</title>
    <link href="/2023/03/05/2023%E5%B9%B43%E6%9C%885%E6%97%A5/"/>
    <url>/2023/03/05/2023%E5%B9%B43%E6%9C%885%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>买的小音箱给送到其他地方去了，憨憨本色。</p><p>然后，列一下截至目前已经买的东西：</p><div class="table-container"><table><thead><tr><th>物件</th><th>价格</th><th>购买平台</th><th>备注</th></tr></thead><tbody><tr><td>orange pi zero 2 本体 + 扩展板</td><td>158.90</td><td>淘宝</td><td>12元运费，总计170.90</td></tr><tr><td>闪迪64G内存卡 套餐</td><td>41.90</td><td>淘宝</td><td>-</td></tr></tbody></table></div><p>0.5m hdmi线|0.99|淘宝|特惠买的，没啥用<br>usb 转 ttl 刷机板|4.00|淘宝|-<br>5v xh2.54 风扇|2.00|淘宝|-<br>5v3a 电源|7.00|淘宝|卖家未发货，退款<br>蓝牙音箱|11.9|拼多多|送到南京去了<br>总计|238.69|-|-</p><h1 id="orange-pi-zero-2-进展"><a href="#orange-pi-zero-2-进展" class="headerlink" title="orange pi zero 2 进展"></a>orange pi zero 2 进展</h1><p>我的香橙派连接的是寝室网络，一直在纠结要如何在寝室外使用。</p><p>刚刚意识到可以直接通过 ttl 串口登录香橙派，不一定需要 ssh 或远程桌面或显示屏。这样只需要带上电脑和 ttl 转接头和杜邦线就行了。</p><p>下一步计划是 GUI 制作。</p><ul><li>Microwindows </li><li>MiniGui</li><li>QT</li><li>Gtk+</li><li>OpenGUI</li><li>FLTK</li><li>LingLongGUI</li><li>LearningGUI</li><li></li></ul><h1 id="今天做了什么"><a href="#今天做了什么" class="headerlink" title="今天做了什么"></a>今天做了什么</h1><p>买了大物实验II的实验书、买了数字系统实验II的书和报告册。</p><p>然后上午摸鱼摸了一上午。</p><h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ul><li>周一<ul><li>电磁场与波</li><li>信号与系统<ul><li>需要作业本</li></ul></li><li>IT英语<ul><li>暂时没有作业，潜在项目</li></ul></li><li>神经网络导论</li></ul></li><li>周二<ul><li>美术鉴赏</li><li>微处理器与嵌入式系统<ul><li>可能有</li></ul></li><li>人工智能基础</li><li>大物实验II<ul><li>预习实验？</li></ul></li></ul></li><li>周三<ul><li>python语言程序设计及其应用<ul><li>似乎有作业</li></ul></li></ul></li><li>周四<ul><li>数字系统实验<ul><li>asd</li></ul></li><li>学术规范与论文写作</li></ul></li><li>周五<ul><li>唐球</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>日志</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023年3月4日</title>
    <link href="/2023/03/04/2023%E5%B9%B43%E6%9C%884%E6%97%A5/"/>
    <url>/2023/03/04/2023%E5%B9%B43%E6%9C%884%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>买了<code>香橙派 zero 2</code>，租了阿里云服务器。</p><h1 id="阿里云服务器"><a href="#阿里云服务器" class="headerlink" title="阿里云服务器"></a>阿里云服务器</h1><p>已经实现的：</p><ul><li>ftp 服务器安装</li><li>wordpress 服务器安装</li><li>远程桌面 vnc 安装</li><li>MySql 数据库</li><li></li></ul><h1 id="香橙派-zero-2"><a href="#香橙派-zero-2" class="headerlink" title="香橙派 zero 2"></a>香橙派 zero 2</h1><p><strong>最近一直在摆弄。安装过程中，碰上的问题：</strong></p><ul><li>烧录错误镜像</li><li><code>Paragon ExtFS for Windows</code>无法读取 sd 卡内容</li></ul><p>成功配置了 wi-fi，ssh，音乐播放，安装桌面</p><p><strong>烧录镜像完成后，遇到的问题有：</strong></p><ul><li>端口设置开放：<ul><li>先用<code>iptables -I INPUT -p tcp --dport 端口号 -j ACCEPT</code> 设置需要开放端口号、权限、协议</li><li><code>iptables-save</code>保存</li><li><code>sudo netfilter-persistent save</code>永久保存</li><li>下一次使用需要<code>sudo netfilter-persistent reload</code> </li></ul></li><li>ftp 搭建失败<ul><li>未解决</li></ul></li><li>aplay 调节音量：差点把自己弄聋（开玩笑）<ul><li><code>man aplay</code>查看帮助</li><li><code>aplay -D plughw:0,0 xxx.wav</code>指定播放设备</li><li><code>alsamixer</code>设置音量</li></ul></li><li>broot 安装失败<ul><li>直接下载安装包，未解决</li></ul></li><li>git 无法提交<ul><li>重新设置 putty</li><li>push 的时候卡在最后：添加参数<code>sendpack.sideband</code><ul><li><code>git config --global sendpack.sideband false</code></li><li><code>git config --local sendpack.sideband false</code></li></ul></li><li>网络更换手机热点</li></ul></li><li>conda 很慢很卡<ul><li>安装mamba</li></ul></li><li>安装 vnc 失败<ul><li>未解决</li></ul></li><li>解压 rar<ul><li>需要 <code>unrar e 包名</code>（直接解压）或 <code>unrar x 包名</code>（创建新目录）</li></ul></li><li></li><li></li></ul><p>买了风扇、蓝牙音箱等等配件。</p><p><strong>清单：</strong><br>|物件|价格|购买平台|备注|<br>|—-|—-|—-|—-|<br>|orange pi zero 2 本体 + 扩展板|158.90|淘宝|12元运费|<br>|闪迪64G内存卡 套餐|41.90|淘宝||<br>0.5m hdmi线|0.99|淘宝|特惠买的，没啥用<br>usb 转 ttl 刷机板|4.00|淘宝|<br>5v xh2.54 风扇|2.00|淘宝|<br>5v3a 电源|7.00|淘宝|卖家未发货，退款<br>蓝牙音箱|11.9|拼多多|本来打算买有线喇叭，脑子一热就买了</p><h1 id="vist"><a href="#vist" class="headerlink" title="vist"></a>vist</h1><p><strong>借龚的电脑跑出了模型。遇到的问题有：</strong></p><ul><li>安装包需要 anaconda</li><li>pip 换源<ul><li>临时：<code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package</code></li><li>永久：<code>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></li></ul></li><li>numpy 和 python 版本不匹配<ul><li>卸载重装</li></ul></li><li>安装 cuda<ul><li>官网下载安装</li><li>占用储存巨大</li></ul></li><li>requirements.txt 依赖没写完整<ul><li>手动安装依赖</li></ul></li><li>pip、conda 无法卸载 python<ul><li>用 conda 直接安装 另一个版本的 python</li><li>或者用 anaconda 创建一个全新环境，创建时配置默认 python<ul><li>但是储存占用……好吧、必要的牺牲</li></ul></li></ul></li></ul><p><strong>我自己电脑配置环境，遇到的问题：</strong></p><ul><li>最大问题：显存过小，至少需要 4.3G 而我只有 4G</li><li>conda 无法更换 python 版本</li><li>同龚</li></ul><p>但是龚的电脑可以随便折腾，不用担心储存不够。真的爽！</p><h1 id="stable-diffusion-绘图"><a href="#stable-diffusion-绘图" class="headerlink" title="stable-diffusion 绘图"></a>stable-diffusion 绘图</h1><p>时间太久了，想不起来，下次再写</p>]]></content>
    
    
    
    <tags>
      
      <tag>日志</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023年2月5日</title>
    <link href="/2023/02/05/2023%E5%B9%B42%E6%9C%885%E6%97%A5/"/>
    <url>/2023/02/05/2023%E5%B9%B42%E6%9C%885%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>测试网易云音乐的插件</p><h3 id="原版"><a href="#原版" class="headerlink" title="原版"></a>原版</h3><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=415086030&auto=0&height=66"></iframe><h3 id="测试增大高度"><a href="#测试增大高度" class="headerlink" title="测试增大高度"></a>测试增大高度</h3><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=700 src="//music.163.com/outchain/player?type=2&id=415086030&auto=0&height=300"></iframe><h3 id="测试自动播放"><a href="#测试自动播放" class="headerlink" title="测试自动播放"></a>测试自动播放</h3><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=415086030&auto=1&height=66"></iframe><h3 id="测试边框"><a href="#测试边框" class="headerlink" title="测试边框"></a>测试边框</h3><iframe frameborder="no" border="ffffff" marginwidth="10" marginheight="10" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=415086030&auto=0&height=66"></iframe>]]></content>
    
    
    
    <tags>
      
      <tag>Test</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023年1月21日</title>
    <link href="/2023/01/21/2023%E5%B9%B41%E6%9C%8821%E6%97%A5/"/>
    <url>/2023/01/21/2023%E5%B9%B41%E6%9C%8821%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="http-server"><a href="#http-server" class="headerlink" title="http-server"></a>http-server</h2><p><code>http-server</code>可以通过在本地文件夹内运行来实现预览网站的功能。或者说，让任意一个目录成为服务器的目录。<br>默认打开<code>index.html</code>，如果没有，会生成一个默认网页，里面有文件夹内所有内容。  </p><p>一般默认的网址为<code>192.168.1.2:8081</code>和<code>127.0.0.1:8081</code>，前者可以通过在同一路由下的其他设备访问，后者只能在本设备内查看。</p><h2 id="“程序员游戏”"><a href="#“程序员游戏”" class="headerlink" title="“程序员游戏”"></a>“程序员游戏”</h2><ul><li><p>网页游戏：  </p><p>  <a href="https://screeps.com/">https://screeps.com/</a><br>  <a href="https://codecombat.cn/play">https://codecombat.cn/play</a><br>  <a href="https://www.codingame.com/start">https://www.codingame.com/start</a><br>  <a href="https://www.binancemag.com/?id=23707">https://www.binancemag.com/?id=23707</a>  </p></li><li>steam 游戏：</li></ul><pre><code class="hljs">SHENZHEN I/O  SpaceChem  TIS - 100  Human Source Machine  A = B  </code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>日志</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSS 入门</title>
    <link href="/2023/01/20/%E8%AF%95%E5%9B%BE%E5%AD%A6%E4%B9%A0CSS/"/>
    <url>/2023/01/20/%E8%AF%95%E5%9B%BE%E5%AD%A6%E4%B9%A0CSS/</url>
    
    <content type="html"><![CDATA[<h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><p>CSS = 选择器 + 声明块</p><p>例：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">color</span>: red;<br><span class="hljs-attribute">text-align</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure><br>p 为选择器，指向<code>&lt;p&gt;</code>标签。<br>属性 - 冒号 - 属性值 - 分号。</p><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>同 C ，<code>/*注释*/</code>。</p><h2 id="CSS的使用"><a href="#CSS的使用" class="headerlink" title="CSS的使用"></a>CSS的使用</h2><ul><li>外部CSS</li></ul><p>例如，html内的一句<code>&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;mystyle.css&quot;&gt;</code>，指向<code>mystyle.css</code>：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: lightblue;<br>&#125;<br><br><span class="hljs-selector-tag">h1</span> &#123;<br>  <span class="hljs-attribute">color</span>: navy;<br>  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">20px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><ul><li>内部css</li></ul><p>html文件中，head部分的<code>&lt;style&gt;</code>元素中进行定义。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">  <span class="hljs-attribute">background-color</span>: linen;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">h1</span> &#123;</span><br><span class="language-css">  <span class="hljs-attribute">color</span>: maroon;</span><br><span class="language-css">  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">40px</span>;</span><br><span class="language-css">&#125; </span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>This is a heading<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This is a paragraph.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><ul><li>行内css（内联样式）</li></ul><p>将style属性赋予某个元素。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:blue;text-align:center;&quot;</span>&gt;</span>This is a heading<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:red;&quot;</span>&gt;</span>This is a paragraph.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h2 id="层叠顺序"><a href="#层叠顺序" class="headerlink" title="层叠顺序"></a>层叠顺序</h2><p>当为某个 HTML 元素指定了多个样式时，会使用哪种样式呢？</p><p>页面中的所有样式将按照以下规则“层叠”为新的“虚拟”样式表，其中第一优先级最高：  </p><pre><code class="hljs">1.行内样式（在 HTML 元素中）  2.外部和内部样式表（在 head 部分）  3.浏览器默认样式  </code></pre><p>因此，行内样式具有最高优先级，并且将覆盖外部和内部样式以及浏览器默认样式。</p><h1 id="css内容"><a href="#css内容" class="headerlink" title="css内容"></a>css内容</h1><h2 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h2><ul><li>颜色名</li></ul><p>赋颜色的一种方式</p><ul><li>背景色</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">background-color</span>:DodgerBlue;&quot;&gt;China&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span> style=&quot;<span class="hljs-attribute">background-color</span>:Tomato;&quot;&gt;China is <span class="hljs-selector-tag">a</span> great country!&lt;/<span class="hljs-selector-tag">p</span>&gt;<br></code></pre></td></tr></table></figure><ul><li>文本颜色</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">color</span>:Tomato;&quot;&gt;China&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span> style=&quot;<span class="hljs-attribute">color</span>:DodgerBlue;&quot;&gt;China is <span class="hljs-selector-tag">a</span> great country!&lt;/<span class="hljs-selector-tag">p</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span> style=&quot;<span class="hljs-attribute">color</span>:MediumSeaGreen;&quot;&gt;China, officially the People&#x27;s Republic of China...&lt;/<span class="hljs-selector-tag">p</span>&gt;<br></code></pre></td></tr></table></figure><ul><li>边框颜色</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">border</span>:<span class="hljs-number">2px</span> solid Tomato;&quot;&gt;Hello World&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">border</span>:<span class="hljs-number">2px</span> solid DodgerBlue;&quot;&gt;Hello World&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">border</span>:<span class="hljs-number">2px</span> solid Violet;&quot;&gt;Hello World&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br></code></pre></td></tr></table></figure><ul><li>颜色值</li></ul><p>使用RGB值、HEX值、HSL值、RGBA值或者HSLA值来指定颜色。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">background-color</span>:<span class="hljs-built_in">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">99</span>, <span class="hljs-number">71</span>);&quot;&gt;...&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">background-color</span>:<span class="hljs-number">#ff6347</span>;&quot;&gt;...&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">background-color</span>:<span class="hljs-built_in">hsl</span>(<span class="hljs-number">9</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">64%</span>);&quot;&gt;...&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br><br>&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">background-color</span>:<span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">99</span>, <span class="hljs-number">71</span>, <span class="hljs-number">0.5</span>);&quot;&gt;...&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">h1</span> style=&quot;<span class="hljs-attribute">background-color</span>:<span class="hljs-built_in">hsla</span>(<span class="hljs-number">9</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">64%</span>, <span class="hljs-number">0.5</span>);&quot;&gt;...&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br></code></pre></td></tr></table></figure><br>直接使用RGB：rgb(red, green, blue)</p><p>使用RGBA：有不透明度的RGB</p><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: lightblue;<span class="hljs-comment">/* 背景色 */</span><br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.3</span>;<span class="hljs-comment">/* 不透明度 */</span><br>  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&quot;paper.gif&quot;</span>);<span class="hljs-comment">/* 背景图像 */</span><br><br>&#125;<br><span class="hljs-comment">/* 以及 */</span><br><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&quot;tree.png&quot;</span>);<br>  <span class="hljs-attribute">background-repeat</span>: no-repeat;<br>  <span class="hljs-attribute">background-position</span>: right top;<br>  <span class="hljs-attribute">background-attachment</span>: fixed;<br>&#125;<br></code></pre></td></tr></table></figure><p>简写：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ffffff</span> <span class="hljs-built_in">url</span>(<span class="hljs-string">&quot;tree.png&quot;</span>) no-repeat right top;<br>&#125;<br></code></pre></td></tr></table></figure><br>在使用简写属性时，属性值的顺序为：</p><pre><code class="hljs">background-color  background-image  background-repeat  background-attachment  background-position  </code></pre><h2 id="轮廓（不同于边框）"><a href="#轮廓（不同于边框）" class="headerlink" title="轮廓（不同于边框）"></a>轮廓（不同于边框）</h2><p>CSS 拥有如下轮廓属性：</p><pre><code class="hljs">outline-style  outline-color  outline-width  outline-offset  outline  </code></pre><h2 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h2><ul><li>文本对齐</li><li>文本方向</li><li>垂直对齐</li><li>文字装饰</li><li>大小写自动转换</li><li>缩进</li><li>字符间距</li><li>行高</li><li>字间距</li><li>文字阴影</li><li>斜体</li><li>粗细</li><li>大小</li></ul><h1 id="CSS-盒子模型"><a href="#CSS-盒子模型" class="headerlink" title="CSS 盒子模型"></a>CSS 盒子模型</h1><h1 id="CSS-选择器"><a href="#CSS-选择器" class="headerlink" title="CSS 选择器"></a>CSS 选择器</h1><h1 id="布局方式"><a href="#布局方式" class="headerlink" title="布局方式"></a>布局方式</h1><h1 id="CSS3"><a href="#CSS3" class="headerlink" title="CSS3"></a>CSS3</h1>]]></content>
    
    
    
    <tags>
      
      <tag>笔记</tag>
      
      <tag>未完待续</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023年1月20日</title>
    <link href="/2023/01/20/2023%E5%B9%B41%E6%9C%8820%E6%97%A5/"/>
    <url>/2023/01/20/2023%E5%B9%B41%E6%9C%8820%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="关于阿里云ESC的应用"><a href="#关于阿里云ESC的应用" class="headerlink" title="关于阿里云ESC的应用"></a>关于阿里云ESC的应用</h2><p>本质是一个可租赁服务器。<br>要用于搭建博客，需要安装<code>Apache</code>（服务器软件）、<code>MariaDB数据库</code>（或者MySql）、<code>PHP</code>，然后通过<code>WordPress</code>完成博客的搭建。</p><p><a href="/2023/01/20/试图学习CSS/">CSS的学习笔记</a></p><h2 id="测试html元素的插入"><a href="#测试html元素的插入" class="headerlink" title="测试html元素的插入"></a>测试html元素的插入</h2><p><b>hhhhh</b></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>hhhhh<br><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>日志</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>总结一下hexo-theme-fluid的使用方法</title>
    <link href="/2023/01/17/%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8Bhexo-theme-fluid%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <url>/2023/01/17/%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8Bhexo-theme-fluid%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="全局"><a href="#全局" class="headerlink" title="全局"></a>全局</h2><hr><ul><li>设置文章默认封面：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">post:<br>  default_index_img: /img/example.jpg<br></code></pre></td></tr></table></figure></li><li>代码块设置：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml">code:<br>  copy_btn: true<br>  highlight:<br>    enable: true<br>    line_number: true<br>    lib: &quot;highlightjs&quot;<br>    highlightjs:<br>      style: &#x27;Github Gist&#x27;<br>      bg_color: false<br>    prismjs:<br>      style: &quot;default&quot;<br>      preprocess: true<br></code></pre></td></tr></table></figure><blockquote><p>copy_btn: 是否开启复制代码的按钮</p><p>line_number: 是否开启行号</p><p>highlight: 是否开启代码高亮</p><p>lib: 选择生成高亮的库，可选项: highlightjs、prismjs，对应下面两组配置，高亮的配置说明具体见主题配置中的注释</p></blockquote></li></ul><h2 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h2><hr><ul><li>大标题：Slogan(打字机)，配置方法是<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">index:<br>  slogan:<br>    enable: true<br>    text: 这是一条 Slogan<br></code></pre></td></tr></table></figure></li></ul><h2 id="每篇文章"><a href="#每篇文章" class="headerlink" title="每篇文章"></a>每篇文章</h2><hr><ul><li>指定摘要：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 在文章开头加上：<br>excerpt: 这是摘要<br></code></pre></td></tr></table></figure></li><li>隐藏文章：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 在文章开头加上：<br>hide: true<br></code></pre></td></tr></table></figure></li><li>手动置顶：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 在文章开头加上：<br>sticky: 100<br></code></pre></td></tr></table></figure></li><li>在首页的封面：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 在文章开头加上：<br>index_img: /img/example.jpg<br></code></pre></td></tr></table></figure></li><li>文章头图：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 在文章开头加上：<br>banner_img: /img/post_banner.jpg<br></code></pre></td></tr></table></figure></li><li>手动置顶：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 在文章开头加上：<br>sticky: 100<br></code></pre></td></tr></table></figure></li><li>勾选框：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&#123;% cb 文字, 是否已勾选, 是否内联 %&#125;<br></code></pre></td></tr></table></figure>            <input type="checkbox" disabled checked="checked">这是一个勾选框          </li><li>按钮：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&#123;% btn 链接, text, title %&#125;<br></code></pre></td></tr></table></figure><a class="btn" href="url"  title="title" target="_blank">text</a></li><li>组图：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml">&#123;% gi total n1-n2-... %&#125;<br>  ![](url)<br>  ![](url)<br>  ![](url)<br>  ![](url)<br>  ![](url)<br>&#123;% endgi %&#125;<br></code></pre></td></tr></table></figure><h2 id="特殊页面"><a href="#特殊页面" class="headerlink" title="特殊页面"></a>特殊页面</h2></li></ul><hr><ul><li>About 页</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>日志</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World？Peter Tan！！</title>
    <link href="/2023/01/16/hello-world/"/>
    <url>/2023/01/16/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>我超，原</title>
    <link href="/2023/01/16/%E5%9B%BE%E7%89%87%E6%B5%8B%E8%AF%95/"/>
    <url>/2023/01/16/%E5%9B%BE%E7%89%87%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<h2 id="图片测试……？"><a href="#图片测试……？" class="headerlink" title="图片测试……？"></a>图片测试……？</h2><p>能看见吗？<br><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/2023/01/16/图片测试/83-2.jpg" alt="完整链接"></div><div class="group-image-wrap"><img src="83-2.jpg" alt="不完全链接"></div><div class="group-image-wrap"><img src="/img/80-3.jpg" alt="完整链接"></div><div class="group-image-wrap"><img src="80-3.jpg" alt="不完全链接"></div></div></div><br><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/2023/01/16/图片测试/83-2.jpg" alt="完整链接"></div><div class="group-image-wrap"><img src="/img/80-3.jpg" alt="完整链接"></div><div class="group-image-wrap"><img src="/img/83-2.jpg" alt="完整链接"></div><div class="group-image-wrap"><img src="/img/80-3.jpg" alt="完整链接"></div></div></div></p><p>实际操作时，hexo 会给文件夹套进一串文件夹嵌套，比如说今天是2023年1月16日，套完前面会多一个2023/01/16/</p><blockquote><p>操作方法：</p><p>安装插件 hexo-asset-image<br>config 里的 post_asset_folder 改为 ture<br>然后新生成的 md 就有了伴生图片文件夹，把图片放进去<br>要使用的话，日期 + 文件夹 + 文件名<br>例如：<code>![图片](2023/01/16/图片测试/83-2.jpg &quot;&quot;)</code></p><p>有了插件 hexo-renderer-marked 的话，可以直接用图片名字，不需要日期和文件夹。</p></blockquote><hr><h2 id="官方方法"><a href="#官方方法" class="headerlink" title="官方方法"></a>官方方法</h2><p>不使用中括号小括号的 md 语法，而是使用官方的 <code>&#123;% asset_img example.jpg This is an example image %&#125;</code>  </p><hr><h2 id="现在使用了fluid主题"><a href="#现在使用了fluid主题" class="headerlink" title="现在使用了fluid主题"></a>现在使用了fluid主题</h2><p>放在source底下的img文件夹会被一并导出，使用img内图片：/img/asdasd.jpg</p><p>然后，事实证明，现在不能直接用图片名字了。</p><p>综上，要使用图片，就放在 source/img/ 下，使用的时候引用 <code>![](img/图片 &quot;&quot;)</code>，要想并排显示需要套一个 <code>&#123;% gi 4 4 %&#125;` 和 `&#123;% endgi %&#125;</code>。<br><code>&#123;% asset_img example.jpg This is an example image %&#125;</code>  似乎不能用了。</p><p><img src="/img/80-3.jpg" alt=""></p><hr><h2 id="这是按钮"><a href="#这是按钮" class="headerlink" title="这是按钮"></a>这是按钮</h2><a class="btn" href="https://nga.178.com"  title="点击前往" target="_blank">NGA!!</a><!-- flag of hidden posts -->]]></content>
    
    
    
    <tags>
      
      <tag>test</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023年1月16日</title>
    <link href="/2023/01/16/2023%E5%B9%B41%E6%9C%8816%E6%97%A5/"/>
    <url>/2023/01/16/2023%E5%B9%B41%E6%9C%8816%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>hexo 使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> myblog<br>//首先进入myblog文件夹<br>$ hexo clear<br>//然后清理之前残留的网页<br>$ hexo g<br>//然后生成网页<br>$ hexo d <br>//然后推送到GitHub上<br></code></pre></td></tr></table></figure><p>markdown 本身使用</p><ul><li><p>标题：井号，或 “ === ” ， 或 “ —- ”</p></li><li><p>段落：一行空白行，不应使用 tab 或者空格。</p></li><li><p>换行：段尾加两个空格，并换行。或者使用 <br> 标签。</p></li><li><p>粗体：两个星号或者两个下划线。</p></li><li><p>斜体：一个星号或一个下划线。</p></li><li><p>引用：在段落前添加 &gt; 符号。要引用多个段落，应给空白行也添加 &gt; 符号。</p></li><li><p>嵌套引用：额外加一个 &gt; 符号。</p></li><li><p>列表：数字和英文句号。  </p><blockquote><p>例如：  </p><ol><li>阿三大苏打  </li><li>阿三大苏打</li><li>阿三大苏打  </li></ol></blockquote></li><li><p>无序列表：段前加 - 或 * 或 + 。要保持缩进，需要添加四个空格，或一个 tab 。</p></li><li><p>代码块：四个空格或一个 tab 。</p></li><li><p>短单词表示为代码：用 ‘ 包裹。<br>一段代码包含单引号：这段代码应用 `` 包裹。<br>围栏代码块：加入 ``` 包裹。</p></li><li><p>分割线： 三个星号、三个 - 、三个下划线，并在此之后添加空白行。</p></li><li><p>链接：中括号包含文本，小括号包含链接。<br>所谓 title ， 即是鼠标悬浮在链接上的时候显示的东西，可以用双引号写在小括号结尾。<br><a href="&quot;哈哈哈哈&quot;">hhh</a><br>对于一般的链接，用尖括号框起来即可。<br><a href="https://nga.178.com">https://nga.178.com</a></p></li><li><p>图片：<br><code>![这是图片](/assets/img/philly-magic-garden.jpg &quot;Magic Gardens&quot;)</code><br>  或者有链接的图片：<br><code>[![沙漠中的岩石图片](/assets/img/shiprock.jpg &quot;Shi prock&quot;)](https://markdown.com.cn)</code></p></li></ul><h2 id="如何将-Windows-下文件导入-wsl"><a href="#如何将-Windows-下文件导入-wsl" class="headerlink" title="如何将 Windows 下文件导入 wsl"></a>如何将 Windows 下文件导入 wsl</h2><blockquote><p>wsl 中的 /mnt 文件夹，对应 Windows 的计算机。<br>例如，想要引用 D:\桌面\临时 里面的 103041518_p0.jpg，对应过来就是 /mnt/d/桌面/临时/103041518_p0.jpg<br>然后复制到 wsl：cp /mnt/d/桌面/临时/103041518_p0.jpg  ~/myblog/source/_posts/图片测试</p><p>看看效果？ <img src="https://github.com/Petertan303/blogtest/blob/main/103041518_p0.jpg" alt="图片"></p><p>2023年4月23日更新：<br>  其实可以直接通过<code>Windows资源管理器</code>访问<code>linux</code>文件夹。</p></blockquote><h2 id="Git-的使用"><a href="#Git-的使用" class="headerlink" title="Git 的使用"></a>Git 的使用</h2><ol><li>git commit &lt;文件&gt; （然后需要写提交日志）</li><li>git pull</li><li>git push</li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
